import{q as fe,r as v,p as z,T as P,d as pe,c as E,o as ge,a as p,b as d,e as l,u as K,m as ve,w as n,f as s,g as Z,h as ee,s as ce,i as f,F as h,j as D,t as g,P as me,x as ye,k as te,l as j,v as q}from"./app-cNF66rvG.js";import{_ as _e}from"./AppLayout.vue_vue_type_script_setup_true_lang-c3ekNZcC.js";import{u as xe}from"./FeedTypeStore-DBPZVWPx.js";import{u as be,S as V}from"./sweetalert2.esm.all-C5Dkr4pP.js";import{_ as c}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DhAhIzZw.js";import{_ as R}from"./Input.vue_vue_type_script_setup_true_lang-Dy719ZJG.js";import{_ as Y,a as H,b as J,c as Q,d as G}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BIUgyYKl.js";import{_ as O}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BJe3iFxh.js";import"./useForwardExpose-eL8-binu.js";import"./RovingFocusGroup-B2hP9Xy7.js";const we=fe("cage",()=>{const x=v(null),y=v(!1),r=v(null),w=v({search:"",page:1});return{cages:x,loading:y,error:r,filters:w,fetchCages:async()=>{y.value=!0,r.value=null;try{const i=await z.get(P("cages.list"),{params:w.value});x.value=i.data.cages}catch(i){r.value=i.message}finally{y.value=!1}},createCage:async i=>{y.value=!0,r.value=null;try{return(await z.post(P("cages.store"),i)).data}catch(o){throw r.value=o.message,o}finally{y.value=!1}},updateCage:async(i,o)=>{y.value=!0,r.value=null;try{const _=await z.put(P("cages.update",i),o);if(x.value&&x.value.data&&Array.isArray(x.value.data)){const C=x.value.data.findIndex(I=>I.id===i);C!==-1&&(x.value.data[C]=_.data)}return _.data}catch(_){throw r.value=_.message,_}finally{y.value=!1}},deleteCage:async i=>{y.value=!0,r.value=null;try{return(await z.delete(P("cages.destroy",i))).data}catch(o){throw r.value=o.message,o}finally{y.value=!1}},setFilters:i=>{w.value={...w.value,...i}}}}),Ce={class:"flex flex-col gap-4 p-4"},he={class:"flex items-center justify-between gap-2"},ke={class:"flex gap-2 items-center"},Se={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},$e={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},De={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},Ve={key:0,class:"animate-pulse"},Fe={key:1},Te={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"px-6 py-4 whitespace-nowrap text-right"},Ue={class:"flex gap-1"},ze={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Pe={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},je={class:"flex items-center space-x-2"},qe={class:"flex items-center space-x-1"},Me={class:"flex flex-col gap-1"},We=["value"],Le={class:"flex flex-col gap-1"},Be={class:"flex flex-col gap-1"},Ae=["value"],Ke={class:"flex flex-col gap-1"},Re={class:"flex items-center gap-2"},Ye={class:"text-2xl"},He={class:"text-lg"},Je={class:"text-sm text-gray-500"},Qe={class:"flex items-center gap-2 mt-1"},Ge={class:"text-xs text-gray-400"},Oe=["value"],Xe=["value"],dt=pe({__name:"Index",setup(x){const y=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"}],r=we(),w=xe(),M=be(),k=v(""),S=v(!1),$=v(!1),F=v(null),i=v(!1),o=v(null),_=E(()=>{const a=w.feedTypes;return(a==null?void 0:a.data)||[]}),C=E(()=>M.investorsSelect),I=E(()=>{var a;return((a=r.cages)==null?void 0:a.data)||[]}),m=E(()=>{const a=r.cages;return a!=null&&a.current_page?{current_page:a.current_page,last_page:a.last_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to}:null}),b=v({number_of_fingerlings:0,feed_types_id:0,investor_id:0}),W=v("ðŸŒ¡ï¸"),L=v("--"),B=v("Loading..."),N=v("Loading..."),ae=a=>({Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Snow:"â„ï¸",Thunderstorm:"â›ˆï¸",Drizzle:"ðŸŒ¦ï¸",Mist:"ðŸŒ«ï¸"})[a]||"ðŸŒ¡ï¸",se=async(a,e)=>{try{N.value="Davao City, Philippines"}catch{N.value="Davao City, Philippines"}};(async()=>{try{const e=125.684569,t=await fetch(`https://api.tomorrow.io/v4/weather/realtime?location=${7.305191},${e}&apikey=mcJYe6rycCpzd19wEcIRQgB9ks13EgTY&units=metric`);if(!t.ok)throw new Error(`Weather API responded with status: ${t.status}`);const u=await t.json();if(u.data&&u.data.values)W.value=ae(u.data.values.weatherCode),L.value=String(Math.round(u.data.values.temperature)),B.value=u.data.values.weatherCode;else throw new Error("Invalid weather data format");se(7.305191,e)}catch(a){console.warn("Weather data unavailable:",a),W.value="ðŸŒ¡ï¸",L.value="--",B.value="Weather data unavailable",N.value="Davao City, Philippines"}})(),E(()=>{var a,e;return k.value?(((e=r.cages)==null?void 0:e.data)||[]).filter(t=>String(t.number_of_fingerlings).includes(k.value.toLowerCase())):((a=r.cages)==null?void 0:a.data)||[]});function X(){r.setFilters({search:k.value,page:1}),r.fetchCages()}function A(a){r.setFilters({...r.filters,page:a}),r.fetchCages()}function le(){if(!m.value)return[];const a=m.value.current_page,e=m.value.last_page,t=[];t.push(1);for(let u=Math.max(2,a-1);u<=Math.min(e-1,a+1);u++)u>1&&u<e&&t.push(u);return e>1&&t.push(e),[...new Set(t)].sort((u,U)=>u-U)}function ne(){var a,e;b.value={number_of_fingerlings:0,feed_types_id:((a=_.value[0])==null?void 0:a.id)||0,investor_id:((e=C.value[0])==null?void 0:e.id)||0},S.value=!0}async function re(){try{await r.createCage(b.value),await r.fetchCages(),S.value=!1,V.fire({icon:"success",title:"Cage created successfully!"})}catch(a){V.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to create cage."})}}function oe(a){F.value=a,$.value=!0}async function ie(){if(F.value!==null)try{await r.deleteCage(F.value),await r.fetchCages(),$.value=!1,F.value=null,V.fire({icon:"success",title:"Cage deleted successfully!"})}catch(a){V.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to delete cage."})}}function ue(a){o.value={...a},i.value=!0}async function de(){if(o.value&&o.value.id)try{await r.updateCage(o.value.id,{number_of_fingerlings:o.value.number_of_fingerlings,feed_types_id:o.value.feed_types_id,investor_id:o.value.investor_id}),await r.fetchCages(),i.value=!1,o.value=null,V.fire({icon:"success",title:"Cage updated successfully!"})}catch(a){V.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to update cage."})}}return ge(()=>{r.fetchCages(),w.fetchFeedTypes(),M.fetchInvestorsSelect()}),(a,e)=>(d(),p(h,null,[l(K(ve),{title:"Cages"}),l(_e,{breadcrumbs:y},{default:n(()=>[s("div",Ce,[s("div",he,[s("div",ke,[l(R,{modelValue:k.value,"onUpdate:modelValue":e[0]||(e[0]=t=>k.value=t),placeholder:"Search cages...",onKeyup:ce(X,["enter"]),class:"w-64"},null,8,["modelValue"]),l(c,{onClick:X,variant:"default"},{default:n(()=>e[15]||(e[15]=[f("Search")])),_:1})]),l(c,{onClick:ne,variant:"secondary"},{default:n(()=>e[16]||(e[16]=[f("Create Cage")])),_:1})]),s("div",Se,[s("table",$e,[e[22]||(e[22]=s("thead",{class:"bg-gray-50 dark:bg-gray-800"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Number of Fingerlings"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Feed Type"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),s("th",{class:"px-6 py-3"})])],-1)),s("tbody",De,[K(r).loading?(d(),p("tr",Ve,e[17]||(e[17]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):I.value.length===0?(d(),p("tr",Fe,e[18]||(e[18]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"},"No cages found.",-1)]))):(d(!0),p(h,{key:2},D(I.value,t=>{var u,U;return d(),p("tr",{key:t==null?void 0:t.id},[s("td",Te,g(t==null?void 0:t.number_of_fingerlings),1),s("td",Ee,g(((u=_.value.find(T=>T.id===(t==null?void 0:t.feed_types_id)))==null?void 0:u.feed_type)||(t==null?void 0:t.feed_types_id)),1),s("td",Ie,g(((U=C.value.find(T=>T.id===(t==null?void 0:t.investor_id)))==null?void 0:U.name)||(t==null?void 0:t.investor_id)),1),s("td",Ne,[s("div",Ue,[l(K(me),{href:`/cages/${t.id}/view`},{default:n(()=>[l(c,{variant:"outline",size:"sm",title:"View",class:"w-8 h-8 p-0"},{default:n(()=>e[19]||(e[19]=[f(" ðŸ‘ï¸ ")])),_:1})]),_:2},1032,["href"]),l(c,{variant:"secondary",size:"sm",onClick:T=>ue(t),disabled:!(t!=null&&t.id),title:"Update",class:"w-8 h-8 p-0"},{default:n(()=>e[20]||(e[20]=[f(" âœï¸ ")])),_:2},1032,["onClick","disabled"]),l(c,{variant:"destructive",size:"sm",onClick:T=>oe(t==null?void 0:t.id),disabled:!(t!=null&&t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:n(()=>e[21]||(e[21]=[f(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"])])])])}),128))])])]),m.value?(d(),p("div",ze,[s("div",Pe,[s("span",null,"Showing "+g(m.value.from)+" to "+g(m.value.to)+" of "+g(m.value.total)+" results",1)]),s("div",je,[l(c,{variant:"outline",size:"sm",disabled:m.value.current_page===1,onClick:e[1]||(e[1]=t=>A(m.value.current_page-1))},{default:n(()=>e[23]||(e[23]=[f(" Previous ")])),_:1},8,["disabled"]),s("div",qe,[(d(!0),p(h,null,D(le(),t=>(d(),Z(c,{key:t,variant:"outline",size:"sm",class:ye(t===m.value.current_page?"bg-primary text-primary-foreground":""),onClick:u=>A(t)},{default:n(()=>[f(g(t),1)]),_:2},1032,["class","onClick"]))),128))]),l(c,{variant:"outline",size:"sm",disabled:m.value.current_page===m.value.last_page,onClick:e[2]||(e[2]=t=>A(m.value.current_page+1))},{default:n(()=>e[24]||(e[24]=[f(" Next ")])),_:1},8,["disabled"])])])):ee("",!0)]),l(Y,{open:S.value,"onUpdate:open":e[7]||(e[7]=t=>S.value=t)},{default:n(()=>[l(O,{"as-child":""}),l(H,null,{default:n(()=>[l(J,null,{default:n(()=>[l(Q,null,{default:n(()=>e[25]||(e[25]=[f("Create Cage")])),_:1})]),_:1}),s("form",{onSubmit:te(re,["prevent"]),class:"flex flex-col gap-4 mt-2"},[s("div",Me,[e[26]||(e[26]=s("label",{for:"investor",class:"text-sm font-medium"},"Investor",-1)),j(s("select",{id:"investor","onUpdate:modelValue":e[3]||(e[3]=t=>b.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(d(!0),p(h,null,D(C.value,t=>(d(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},g(t.name),9,We))),128))],512),[[q,b.value.investor_id]])]),s("div",Le,[e[27]||(e[27]=s("label",{for:"fingerlings",class:"text-sm font-medium"},"Number of Fingerlings",-1)),l(R,{id:"fingerlings",modelValue:b.value.number_of_fingerlings,"onUpdate:modelValue":e[4]||(e[4]=t=>b.value.number_of_fingerlings=t),type:"number",placeholder:"Enter number of fingerlings",required:""},null,8,["modelValue"])]),s("div",Be,[e[28]||(e[28]=s("label",{for:"feedType",class:"text-sm font-medium"},"Feed Type",-1)),j(s("select",{id:"feedType","onUpdate:modelValue":e[5]||(e[5]=t=>b.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(d(!0),p(h,null,D(_.value,t=>(d(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},g(t.feed_type),9,Ae))),128))],512),[[q,b.value.feed_types_id]])]),s("div",Ke,[e[29]||(e[29]=s("label",{class:"text-sm font-medium"},"Weather Condition",-1)),s("div",Re,[s("span",Ye,g(W.value),1),s("span",He,g(L.value)+"Â°C",1),s("span",Je,g(B.value),1)]),s("div",Qe,[s("span",Ge,g(N.value),1)])]),l(G,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(c,{type:"button",variant:"secondary",onClick:e[6]||(e[6]=t=>S.value=!1)},{default:n(()=>e[30]||(e[30]=[f("Cancel")])),_:1}),l(c,{type:"submit",variant:"default"},{default:n(()=>e[31]||(e[31]=[f("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(Y,{open:$.value,"onUpdate:open":e[9]||(e[9]=t=>$.value=t)},{default:n(()=>[l(O,{"as-child":""}),l(H,null,{default:n(()=>[l(J,null,{default:n(()=>[l(Q,null,{default:n(()=>e[32]||(e[32]=[f("Delete Cage")])),_:1})]),_:1}),e[35]||(e[35]=s("div",{class:"mt-2"},"Are you sure you want to delete this cage?",-1)),l(G,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(c,{type:"button",variant:"secondary",onClick:e[8]||(e[8]=t=>$.value=!1)},{default:n(()=>e[33]||(e[33]=[f("Cancel")])),_:1}),l(c,{type:"button",variant:"destructive",onClick:ie},{default:n(()=>e[34]||(e[34]=[f("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),o.value?(d(),Z(Y,{key:0,open:i.value,"onUpdate:open":e[14]||(e[14]=t=>i.value=t)},{default:n(()=>[l(O,{"as-child":""}),l(H,null,{default:n(()=>[l(J,null,{default:n(()=>[l(Q,null,{default:n(()=>e[36]||(e[36]=[f("Edit Cage")])),_:1})]),_:1}),s("form",{onSubmit:te(de,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l(R,{modelValue:o.value.number_of_fingerlings,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.number_of_fingerlings=t),type:"number",placeholder:"Number of Fingerlings",required:""},null,8,["modelValue"]),j(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(d(!0),p(h,null,D(_.value,t=>(d(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},g(t.feed_type),9,Oe))),128))],512),[[q,o.value.feed_types_id]]),j(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(d(!0),p(h,null,D(C.value,t=>(d(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},g(t.name),9,Xe))),128))],512),[[q,o.value.investor_id]]),l(G,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(c,{type:"button",variant:"secondary",onClick:e[13]||(e[13]=t=>i.value=!1)},{default:n(()=>e[37]||(e[37]=[f("Cancel")])),_:1}),l(c,{type:"submit",variant:"default"},{default:n(()=>e[38]||(e[38]=[f("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):ee("",!0)]),_:1})],64))}});export{dt as default};
