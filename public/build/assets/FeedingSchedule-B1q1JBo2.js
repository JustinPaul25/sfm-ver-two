import{d as te,r as p,c as W,o as le,a as g,b as f,e as o,u as H,m as ne,w as i,f as t,g as V,h as k,t as d,W as w,i as u,F as b,j as F,k as ae,l as I,v as se,n as oe,p as C}from"./app-CzhniAMT.js";import{_ as ie}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cfv7ZBw5.js";import{_ as D}from"./Card.vue_vue_type_script_setup_true_lang-aC5pJkwP.js";import{_ as m}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-1iHGJxcY.js";import{_ as T}from"./Input.vue_vue_type_script_setup_true_lang-DoOMrtD2.js";import{_ as $}from"./Label.vue_vue_type_script_setup_true_lang-BKKMizY2.js";import"./useForwardExpose-DEh402Yc.js";import"./RovingFocusGroup-Daz5GHfr.js";const de={class:"flex flex-col gap-6 p-4 max-w-6xl mx-auto"},ue={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},re={class:"text-sm text-muted-foreground"},fe={class:"text-sm text-muted-foreground"},me={class:"flex gap-2"},_e={class:"flex items-start justify-between mb-4"},ge={class:"text-xl font-semibold mb-1"},ce={class:"flex gap-2"},ve={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},pe={class:"space-y-2"},ye={class:"text-muted-foreground"},be={class:"font-mono font-medium"},xe={class:"space-y-2"},he={class:"text-muted-foreground"},Se={class:"font-medium"},ke={class:"border-t pt-2 mt-2"},we={class:"flex justify-between font-semibold"},Fe={key:0,class:"mt-4 p-3 bg-gray-50 rounded-lg"},Ce={class:"text-sm text-muted-foreground"},$e={class:"flex items-center justify-between mb-6"},Ve={class:"text-xl font-semibold"},De={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},Ae=["value"],Te={class:"space-y-4"},je={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},qe={class:"p-4 bg-blue-50 rounded-lg"},Ne={class:"flex justify-between items-center"},Ue={class:"text-xl font-bold text-blue-600"},Ee={class:"flex gap-2 justify-end"},Be={class:"space-y-3"},Me={class:"font-medium"},ze={class:"text-sm text-muted-foreground"},Le={class:"flex gap-2"},Qe=te({__name:"FeedingSchedule",props:{cage:{},schedules:{},activeSchedule:{}},setup(J){var E,B;const A=J,v=p(A.cage),j=p(A.schedules||[]),c=p(A.activeSchedule),_=p(!1),x=p(!1),y=p(null),n=p({schedule_name:"",feeding_time_1:"",feeding_time_2:"",feeding_time_3:"",feeding_time_4:"",feeding_amount_1:"",feeding_amount_2:"",feeding_amount_3:"",feeding_amount_4:"",frequency:"daily",notes:""}),K=[{value:"daily",label:"Once Daily"},{value:"twice_daily",label:"Twice Daily"},{value:"thrice_daily",label:"Three Times Daily"},{value:"four_times_daily",label:"Four Times Daily"}],P=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"},{title:"Feeding Schedules",href:"/cages/feeding-schedules"},{title:((B=(E=v.value)==null?void 0:E.investor)==null?void 0:B.name)||"Cage Schedule",href:"#"}],Q=W(()=>[parseFloat(n.value.feeding_amount_1)||0,parseFloat(n.value.feeding_amount_2)||0,parseFloat(n.value.feeding_amount_3)||0,parseFloat(n.value.feeding_amount_4)||0].reduce((e,r)=>e+r,0).toFixed(2)),q=W(()=>n.value.schedule_name.trim()!==""&&(n.value.feeding_time_1||n.value.feeding_time_2||n.value.feeding_time_3||n.value.feeding_time_4)),N=()=>{n.value={schedule_name:"",feeding_time_1:"",feeding_time_2:"",feeding_time_3:"",feeding_time_4:"",feeding_amount_1:"",feeding_amount_2:"",feeding_amount_3:"",feeding_amount_4:"",frequency:"daily",notes:""},y.value=null},h=(a=null)=>{var e,r,S,l;a?(y.value=a,n.value={schedule_name:a.schedule_name,feeding_time_1:a.feeding_time_1||"",feeding_time_2:a.feeding_time_2||"",feeding_time_3:a.feeding_time_3||"",feeding_time_4:a.feeding_time_4||"",feeding_amount_1:((e=a.feeding_amount_1)==null?void 0:e.toString())||"",feeding_amount_2:((r=a.feeding_amount_2)==null?void 0:r.toString())||"",feeding_amount_3:((S=a.feeding_amount_3)==null?void 0:S.toString())||"",feeding_amount_4:((l=a.feeding_amount_4)==null?void 0:l.toString())||"",frequency:a.frequency,notes:a.notes||""}):N(),x.value=!0},U=()=>{x.value=!1,N()},R=async()=>{if(q.value){_.value=!0;try{const a={cage_id:v.value.id,...n.value,feeding_amount_1:parseFloat(n.value.feeding_amount_1)||0,feeding_amount_2:parseFloat(n.value.feeding_amount_2)||0,feeding_amount_3:parseFloat(n.value.feeding_amount_3)||0,feeding_amount_4:parseFloat(n.value.feeding_amount_4)||0};y.value?await C.put(`/cages/feeding-schedules/${y.value.id}`,a):await C.post("/cages/feeding-schedules",a),w.reload()}catch(a){console.error("Error saving schedule:",a)}finally{_.value=!1}}},X=async a=>{if(confirm("Are you sure you want to delete this schedule?")){_.value=!0;try{await C.delete(`/cages/feeding-schedules/${a}`),w.reload()}catch(e){console.error("Error deleting schedule:",e)}finally{_.value=!1}}},Y=async a=>{_.value=!0;try{await C.post(`/cages/feeding-schedules/${a}/activate`),w.reload()}catch(e){console.error("Error activating schedule:",e)}finally{_.value=!1}},Z=async()=>{var a,e;if(confirm("This will replace the current schedule with an auto-generated one. Continue?")){_.value=!0;try{const r=await C.post("/cages/feeding-schedules/auto-generate",{cage_ids:[v.id],overwrite_existing:!0});r.data.generated_schedules.length>0?(alert("Schedule auto-generated successfully!"),w.reload()):alert("Failed to generate schedule: "+r.data.errors.join(", "))}catch(r){console.error("Auto-generation failed:",r),alert("Failed to auto-generate schedule: "+(((e=(a=r.response)==null?void 0:a.data)==null?void 0:e.message)||r.message))}finally{_.value=!1}}};return le(()=>{c.value||h()}),(a,e)=>{var r,S;return f(),g(b,null,[o(H(ne),{title:`Feeding Schedule - ${((S=(r=v.value)==null?void 0:r.investor)==null?void 0:S.name)||"Cage"}`},null,8,["title"]),o(ie,{breadcrumbs:P},{default:i(()=>[t("div",de,[o(D,{class:"p-6"},{default:i(()=>{var l,s,M,z,L,G,O;return[t("div",ue,[t("div",null,[e[7]||(e[7]=t("h2",{class:"text-2xl font-bold mb-1"},"Feeding Schedule",-1)),t("div",re,d((s=(l=v.value)==null?void 0:l.investor)==null?void 0:s.name)+" - Cage #"+d((M=v.value)==null?void 0:M.id),1),t("div",fe,d((L=(z=v.value)==null?void 0:z.number_of_fingerlings)==null?void 0:L.toLocaleString())+" fish â€¢ "+d((O=(G=v.value)==null?void 0:G.feedType)==null?void 0:O.feed_type),1)]),t("div",me,[o(m,{variant:"outline",onClick:e[0]||(e[0]=ee=>H(w).visit("/cages/feeding-schedules"))},{default:i(()=>e[8]||(e[8]=[u(" â† Back to All Schedules ")])),_:1}),x.value?k("",!0):(f(),V(m,{key:0,onClick:e[1]||(e[1]=ee=>h())},{default:i(()=>e[9]||(e[9]=[u(" âž• New Schedule ")])),_:1}))])])]}),_:1}),c.value&&!x.value?(f(),V(D,{key:0,class:"p-6"},{default:i(()=>[t("div",_e,[t("div",null,[t("h3",ge,d(c.value.schedule_name),1),e[10]||(e[10]=t("span",{class:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium"}," Active Schedule ",-1))]),t("div",ce,[o(m,{variant:"outline",onClick:e[2]||(e[2]=l=>h(c.value))},{default:i(()=>e[11]||(e[11]=[u(" âœï¸ Edit ")])),_:1}),o(m,{variant:"outline",onClick:e[3]||(e[3]=l=>h())},{default:i(()=>e[12]||(e[12]=[u(" âž• New Schedule ")])),_:1}),o(m,{variant:"outline",onClick:Z,class:"bg-blue-50 text-blue-700 hover:bg-blue-100"},{default:i(()=>e[13]||(e[13]=[u(" ðŸš€ Auto-Generate ")])),_:1})])]),t("div",ve,[t("div",null,[e[14]||(e[14]=t("h4",{class:"font-medium mb-3"},"Feeding Times",-1)),t("div",pe,[(f(!0),g(b,null,F(c.value.feeding_times,(l,s)=>(f(),g("div",{key:s,class:"flex justify-between"},[t("span",ye,"Feeding "+d(s+1)+":",1),t("span",be,d(l),1)]))),128))])]),t("div",null,[e[16]||(e[16]=t("h4",{class:"font-medium mb-3"},"Feeding Amounts",-1)),t("div",xe,[(f(!0),g(b,null,F(c.value.feeding_amounts,(l,s)=>(f(),g("div",{key:s,class:"flex justify-between"},[t("span",he,"Amount "+d(s+1)+":",1),t("span",Se,d(l)+" kg",1)]))),128)),t("div",ke,[t("div",we,[e[15]||(e[15]=t("span",null,"Total Daily:",-1)),t("span",null,d(c.value.total_daily_amount)+" kg",1)])])])])]),c.value.notes?(f(),g("div",Fe,[e[17]||(e[17]=t("h4",{class:"font-medium mb-1"},"Notes",-1)),t("p",Ce,d(c.value.notes),1)])):k("",!0)]),_:1})):k("",!0),x.value?(f(),V(D,{key:1,class:"p-6"},{default:i(()=>[t("div",$e,[t("h3",Ve,d(y.value?"Edit Schedule":"Create New Schedule"),1),o(m,{variant:"outline",onClick:U},{default:i(()=>e[18]||(e[18]=[u("âœ• Cancel")])),_:1})]),t("form",{onSubmit:ae(R,["prevent"]),class:"space-y-6"},[t("div",De,[t("div",null,[o($,{for:"schedule_name"},{default:i(()=>e[19]||(e[19]=[u("Schedule Name")])),_:1}),o(T,{id:"schedule_name",modelValue:n.value.schedule_name,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.schedule_name=l),placeholder:"e.g., Morning Schedule",required:""},null,8,["modelValue"])]),t("div",null,[o($,{for:"frequency"},{default:i(()=>e[20]||(e[20]=[u("Frequency")])),_:1}),I(t("select",{id:"frequency","onUpdate:modelValue":e[5]||(e[5]=l=>n.value.frequency=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[(f(),g(b,null,F(K,l=>t("option",{key:l.value,value:l.value},d(l.label),9,Ae)),64))],512),[[se,n.value.frequency]])])]),t("div",Te,[e[22]||(e[22]=t("h4",{class:"font-medium"},"Feeding Schedule",-1)),t("div",je,[(f(),g(b,null,F(4,l=>t("div",{key:l,class:"space-y-2"},[o($,{for:`feeding_time_${l}`},{default:i(()=>[u("Feeding "+d(l)+" Time",1)]),_:2},1032,["for"]),o(T,{id:`feeding_time_${l}`,"model-value":l===1?n.value.feeding_time_1:l===2?n.value.feeding_time_2:l===3?n.value.feeding_time_3:n.value.feeding_time_4,"onUpdate:modelValue":s=>{l===1?n.value.feeding_time_1=s:l===2?n.value.feeding_time_2=s:l===3?n.value.feeding_time_3=s:n.value.feeding_time_4=s},type:"time",placeholder:`${8+(l-1)*4}:00`},null,8,["id","model-value","onUpdate:modelValue","placeholder"]),o($,{for:`feeding_amount_${l}`},{default:i(()=>e[21]||(e[21]=[u("Amount (kg)")])),_:2},1032,["for"]),o(T,{id:`feeding_amount_${l}`,"model-value":l===1?n.value.feeding_amount_1:l===2?n.value.feeding_amount_2:l===3?n.value.feeding_amount_3:n.value.feeding_amount_4,"onUpdate:modelValue":s=>{l===1?n.value.feeding_amount_1=s:l===2?n.value.feeding_amount_2=s:l===3?n.value.feeding_amount_3=s:n.value.feeding_amount_4=s},type:"number",step:"0.01",min:"0",placeholder:"0.00"},null,8,["id","model-value","onUpdate:modelValue"])])),64))])]),t("div",qe,[t("div",Ne,[e[23]||(e[23]=t("span",{class:"font-medium"},"Total Daily Amount:",-1)),t("span",Ue,d(Q.value)+" kg",1)])]),t("div",null,[o($,{for:"notes"},{default:i(()=>e[24]||(e[24]=[u("Notes")])),_:1}),I(t("textarea",{id:"notes","onUpdate:modelValue":e[6]||(e[6]=l=>n.value.notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes about this feeding schedule..."},null,512),[[oe,n.value.notes]])]),t("div",Ee,[o(m,{type:"button",variant:"outline",onClick:U},{default:i(()=>e[25]||(e[25]=[u(" Cancel ")])),_:1}),o(m,{type:"submit",disabled:!q.value||_.value},{default:i(()=>[u(d(_.value?"Saving...":y.value?"Update Schedule":"Create Schedule"),1)]),_:1},8,["disabled"])])],32)]),_:1})):k("",!0),j.value.length>1?(f(),V(D,{key:2,class:"p-6"},{default:i(()=>[e[29]||(e[29]=t("h3",{class:"text-xl font-semibold mb-4"},"Schedule History",-1)),t("div",Be,[(f(!0),g(b,null,F(j.value.filter(l=>!l.is_active),l=>(f(),g("div",{key:l.id,class:"flex items-center justify-between p-4 border rounded-lg"},[t("div",null,[t("h4",Me,d(l.schedule_name),1),t("p",ze," Created "+d(new Date(l.created_at).toLocaleDateString()),1)]),t("div",Le,[o(m,{variant:"outline",size:"sm",onClick:s=>Y(l.id)},{default:i(()=>e[26]||(e[26]=[u(" Activate ")])),_:2},1032,["onClick"]),o(m,{variant:"outline",size:"sm",onClick:s=>h(l)},{default:i(()=>e[27]||(e[27]=[u(" Edit ")])),_:2},1032,["onClick"]),o(m,{variant:"outline",size:"sm",onClick:s=>X(l.id)},{default:i(()=>e[28]||(e[28]=[u(" Delete ")])),_:2},1032,["onClick"])])]))),128))])]),_:1})):k("",!0)])]),_:1})],64)}}});export{Qe as default};
