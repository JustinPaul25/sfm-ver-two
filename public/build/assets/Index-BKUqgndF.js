import{d as ve,B as ce,c as M,r as m,o as ge,a as _,b as g,e as s,u as xe,m as ye,w as l,f as a,g as W,h as R,i as n,t as i,l as P,C as _e,v as h,F as T,j as X,A as L,k as Y,p as w}from"./app-cXB0WXeG.js";import{_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-BqJlz97b.js";import{_ as u}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzgCzate.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-Cu7ak-py.js";import{_ as K,a as G,b as H,c as J}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6qZcBAmY.js";import{_ as O}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DL_Cg_zE.js";import{_ as Q}from"./DialogFooter.vue_vue_type_script_setup_true_lang-D7RWneW6.js";import{_ as C}from"./Card.vue_vue_type_script_setup_true_lang-DjVIjL4h.js";import{_ as U,a as V,b as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-CUjEnbf9.js";import{S as c}from"./sweetalert2.esm.all-odB5D8k1.js";import"./useForwardExpose-CPJbi8KW.js";import"./RovingFocusGroup-B5r2yRVB.js";const we={class:"flex flex-col gap-4 p-4"},ke={key:0,class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4"},Ce={class:"text-2xl font-bold"},Ue={class:"text-2xl font-bold text-green-600"},Ve={class:"text-2xl font-bold text-red-600"},$e={class:"text-2xl font-bold text-green-600"},Ee={class:"text-2xl font-bold text-blue-600"},Se={class:"text-2xl font-bold text-red-600"},De={class:"flex items-center justify-between gap-2 flex-wrap"},Fe={class:"flex gap-2 items-center flex-wrap"},Ae={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},Ne={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ie={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},je={key:0,class:"animate-pulse"},qe={key:1},ze={class:"px-6 py-4 whitespace-nowrap font-medium"},Be={class:"px-6 py-4 whitespace-nowrap"},Me={class:"px-6 py-4 whitespace-nowrap"},Re=["value","onChange"],Pe={class:"px-6 py-4 whitespace-nowrap"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Te={class:"px-6 py-4 whitespace-nowrap text-right"},Le={class:"flex gap-1 justify-end"},Ke={key:1,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Ge={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},He={class:"flex items-center space-x-2"},Je={class:"flex items-center space-x-1"},Oe={class:"flex flex-col gap-1"},Qe={class:"flex flex-col gap-1"},We={class:"flex flex-col gap-1"},Xe={class:"flex flex-col gap-1"},Ye={class:"flex flex-col gap-1"},Ze={class:"flex flex-col gap-1"},et={class:"flex flex-col gap-1"},vt=ve({__name:"Index",setup(tt){const Z=ce(),ee=M(()=>{var r,e;return((e=(r=Z.props.auth)==null?void 0:r.user)==null?void 0:e.role)||"farmer"});M(()=>ee.value==="admin");const te=[{title:"Dashboard",href:"/dashboard"},{title:"User Management",href:"/users"}],f=m({data:[],current_page:1,last_page:1,per_page:10,total:0,from:null,to:null}),x=m(null),z=m(!1),A=m(""),N=m(""),I=m(""),E=m(!1),S=m(!1),D=m(!1),j=m(null),v=m(null),p=m({name:"",email:"",password:"",password_confirmation:"",role:"farmer"}),d=M(()=>f.value?{current_page:f.value.current_page,last_page:f.value.last_page,per_page:f.value.per_page,total:f.value.total,from:f.value.from,to:f.value.to}:null),ae=r=>{switch(r){case"admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case"investor":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"farmer":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}},se=r=>r?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";async function y(){z.value=!0;try{const r=new URLSearchParams;A.value&&r.append("search",A.value),N.value&&r.append("role",N.value),I.value&&r.append("status",I.value),r.append("page",f.value.current_page.toString());const e=await w.get(`/users/list?${r.toString()}`);f.value=e.data.users}catch(r){console.error("Error fetching users:",r),c.fire({icon:"error",title:"Error",text:"Failed to load users."})}finally{z.value=!1}}async function F(){try{const r=await w.get("/users/statistics");x.value=r.data.statistics}catch(r){console.error("Error fetching statistics:",r)}}function q(){f.value.current_page=1,y()}function B(r){f.value.current_page=r,y()}function le(){if(!d.value)return[];const r=d.value.current_page,e=d.value.last_page,t=[];t.push(1);for(let o=Math.max(2,r-1);o<=Math.min(e-1,r+1);o++)o>1&&o<e&&t.push(o);return e>1&&t.push(e),[...new Set(t)].sort((o,b)=>o-b)}function re(){p.value={name:"",email:"",password:"",password_confirmation:"",role:"farmer"},E.value=!0}async function oe(){var r,e;try{await w.post("/users",p.value),await y(),await F(),E.value=!1,c.fire({icon:"success",title:"User created successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to create user.";c.fire({icon:"error",title:"Error",text:o})}}function ne(r){v.value={...r},S.value=!0}async function ie(){var r,e;if(v.value)try{await w.put(`/users/${v.value.id}`,{name:v.value.name,email:v.value.email}),await y(),S.value=!1,v.value=null,c.fire({icon:"success",title:"User updated successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to update user.";c.fire({icon:"error",title:"Error",text:o})}}async function de(r,e){var t,o;try{await w.put(`/users/${r.id}/role`,{role:e}),await y(),await F(),c.fire({icon:"success",title:"User role updated successfully!"})}catch(b){const me=((o=(t=b==null?void 0:b.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to update user role.";c.fire({icon:"error",title:"Error",text:me})}}async function ue(r){var e,t;try{await w.post(`/users/${r.id}/toggle-status`),await y(),await F();const o=r.is_active?"deactivated":"activated";c.fire({icon:"success",title:`User ${o} successfully!`})}catch(o){const b=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to toggle user status.";c.fire({icon:"error",title:"Error",text:b})}}function fe(r){j.value=r,D.value=!0}async function pe(){var r,e;if(j.value!==null)try{await w.delete(`/users/${j.value}`),await y(),await F(),D.value=!1,j.value=null,c.fire({icon:"success",title:"User deleted successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to delete user.";c.fire({icon:"error",title:"Error",text:o})}}return ge(()=>{y(),F()}),(r,e)=>(g(),_(T,null,[s(xe(ye),{title:"User Management"}),s(be,{breadcrumbs:te},{default:l(()=>[a("div",we,[x.value?(g(),_("div",ke,[s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[18]||(e[18]=[n("Total Users")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",Ce,i(x.value.total_users),1)]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[19]||(e[19]=[n("Active")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",Ue,i(x.value.active_users),1)]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[20]||(e[20]=[n("Inactive")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",Ve,i(x.value.inactive_users),1)]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[21]||(e[21]=[n("Farmers")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",$e,i(x.value.farmers),1)]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[22]||(e[22]=[n("Investors")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",Ee,i(x.value.investors),1)]),_:1})]),_:1}),s(C,null,{default:l(()=>[s(U,{class:"pb-2"},{default:l(()=>[s(V,{class:"text-sm font-medium text-muted-foreground"},{default:l(()=>e[23]||(e[23]=[n("Admins")])),_:1})]),_:1}),s($,null,{default:l(()=>[a("div",Se,i(x.value.admins),1)]),_:1})]),_:1})])):R("",!0),a("div",De,[a("div",Fe,[s(k,{modelValue:A.value,"onUpdate:modelValue":e[0]||(e[0]=t=>A.value=t),placeholder:"Search users...",onKeyup:_e(q,["enter"]),class:"w-64"},null,8,["modelValue"]),P(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>N.value=t),onChange:q,class:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm"},e[24]||(e[24]=[a("option",{value:""},"All Roles",-1),a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),544),[[h,N.value]]),P(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>I.value=t),onChange:q,class:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm"},e[25]||(e[25]=[a("option",{value:""},"All Status",-1),a("option",{value:"active"},"Active",-1),a("option",{value:"inactive"},"Inactive",-1)]),544),[[h,I.value]]),s(u,{onClick:q,variant:"default"},{default:l(()=>e[26]||(e[26]=[n("Search")])),_:1})]),s(u,{onClick:re,variant:"secondary"},{default:l(()=>e[27]||(e[27]=[n("Create User")])),_:1})]),a("div",Ae,[a("table",Ne,[e[33]||(e[33]=a("thead",{class:"bg-gray-50 dark:bg-gray-800"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Role"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Created"),a("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),a("tbody",Ie,[z.value?(g(),_("tr",je,e[28]||(e[28]=[a("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):f.value.data.length===0?(g(),_("tr",qe,e[29]||(e[29]=[a("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"No users found.",-1)]))):(g(!0),_(T,{key:2},X(f.value.data,t=>(g(),_("tr",{key:t.id},[a("td",ze,i(t.name),1),a("td",Be,i(t.email),1),a("td",Me,[a("select",{value:t.role,onChange:o=>de(t,o.target.value),class:L(["px-2 py-1 text-xs rounded-full font-semibold",ae(t.role)])},e[30]||(e[30]=[a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),42,Re)]),a("td",Pe,[a("span",{class:L(["px-2 py-1 text-xs rounded-full font-semibold",se(t.is_active)])},i(t.is_active?"Active":"Inactive"),3)]),a("td",he,i(new Date(t.created_at).toLocaleDateString()),1),a("td",Te,[a("div",Le,[s(u,{variant:"outline",size:"sm",onClick:o=>ne(t),title:"Edit",class:"w-8 h-8 p-0"},{default:l(()=>e[31]||(e[31]=[n(" âœï¸ ")])),_:2},1032,["onClick"]),s(u,{variant:t.is_active?"secondary":"default",size:"sm",onClick:o=>ue(t),title:t.is_active?"Deactivate":"Activate",class:"w-8 h-8 p-0"},{default:l(()=>[n(i(t.is_active?"ðŸ”’":"ðŸ”“"),1)]),_:2},1032,["variant","onClick","title"]),s(u,{variant:"destructive",size:"sm",onClick:o=>fe(t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:l(()=>e[32]||(e[32]=[n(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick"])])])]))),128))])])]),d.value&&d.value.total>0?(g(),_("div",Ke,[a("div",Ge,[a("span",null,"Showing "+i(d.value.from)+" to "+i(d.value.to)+" of "+i(d.value.total)+" results",1)]),a("div",He,[s(u,{variant:"outline",size:"sm",disabled:d.value.current_page===1,onClick:e[3]||(e[3]=t=>B(d.value.current_page-1))},{default:l(()=>e[34]||(e[34]=[n(" Previous ")])),_:1},8,["disabled"]),a("div",Je,[(g(!0),_(T,null,X(le(),t=>(g(),W(u,{key:t,variant:"outline",size:"sm",class:L(t===d.value.current_page?"bg-primary text-primary-foreground":""),onClick:o=>B(t)},{default:l(()=>[n(i(t),1)]),_:2},1032,["class","onClick"]))),128))]),s(u,{variant:"outline",size:"sm",disabled:d.value.current_page===d.value.last_page,onClick:e[4]||(e[4]=t=>B(d.value.current_page+1))},{default:l(()=>e[35]||(e[35]=[n(" Next ")])),_:1},8,["disabled"])])])):R("",!0)]),s(K,{open:E.value,"onUpdate:open":e[11]||(e[11]=t=>E.value=t)},{default:l(()=>[s(O,{"as-child":""}),s(G,null,{default:l(()=>[s(H,null,{default:l(()=>[s(J,null,{default:l(()=>e[36]||(e[36]=[n("Create User")])),_:1})]),_:1}),a("form",{onSubmit:Y(oe,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",Oe,[e[37]||(e[37]=a("label",{for:"name",class:"text-sm font-medium"},"Name",-1)),s(k,{id:"name",modelValue:p.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>p.value.name=t),type:"text",placeholder:"Enter name",required:""},null,8,["modelValue"])]),a("div",Qe,[e[38]||(e[38]=a("label",{for:"email",class:"text-sm font-medium"},"Email",-1)),s(k,{id:"email",modelValue:p.value.email,"onUpdate:modelValue":e[6]||(e[6]=t=>p.value.email=t),type:"email",placeholder:"Enter email",required:""},null,8,["modelValue"])]),a("div",We,[e[40]||(e[40]=a("label",{for:"role",class:"text-sm font-medium"},"Role",-1)),P(a("select",{id:"role","onUpdate:modelValue":e[7]||(e[7]=t=>p.value.role=t),class:"input w-full rounded border p-2",required:""},e[39]||(e[39]=[a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),512),[[h,p.value.role]])]),a("div",Xe,[e[41]||(e[41]=a("label",{for:"password",class:"text-sm font-medium"},"Password",-1)),s(k,{id:"password",modelValue:p.value.password,"onUpdate:modelValue":e[8]||(e[8]=t=>p.value.password=t),type:"password",placeholder:"Enter password",required:""},null,8,["modelValue"])]),a("div",Ye,[e[42]||(e[42]=a("label",{for:"password_confirmation",class:"text-sm font-medium"},"Confirm Password",-1)),s(k,{id:"password_confirmation",modelValue:p.value.password_confirmation,"onUpdate:modelValue":e[9]||(e[9]=t=>p.value.password_confirmation=t),type:"password",placeholder:"Confirm password",required:""},null,8,["modelValue"])]),s(Q,{class:"flex justify-end gap-2 mt-4"},{default:l(()=>[s(u,{type:"button",variant:"secondary",onClick:e[10]||(e[10]=t=>E.value=!1)},{default:l(()=>e[43]||(e[43]=[n("Cancel")])),_:1}),s(u,{type:"submit",variant:"default"},{default:l(()=>e[44]||(e[44]=[n("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),v.value?(g(),W(K,{key:0,open:S.value,"onUpdate:open":e[15]||(e[15]=t=>S.value=t)},{default:l(()=>[s(O,{"as-child":""}),s(G,null,{default:l(()=>[s(H,null,{default:l(()=>[s(J,null,{default:l(()=>e[45]||(e[45]=[n("Edit User")])),_:1})]),_:1}),a("form",{onSubmit:Y(ie,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",Ze,[e[46]||(e[46]=a("label",{for:"edit_name",class:"text-sm font-medium"},"Name",-1)),s(k,{id:"edit_name",modelValue:v.value.name,"onUpdate:modelValue":e[12]||(e[12]=t=>v.value.name=t),type:"text",placeholder:"Enter name",required:""},null,8,["modelValue"])]),a("div",et,[e[47]||(e[47]=a("label",{for:"edit_email",class:"text-sm font-medium"},"Email",-1)),s(k,{id:"edit_email",modelValue:v.value.email,"onUpdate:modelValue":e[13]||(e[13]=t=>v.value.email=t),type:"email",placeholder:"Enter email",required:""},null,8,["modelValue"])]),s(Q,{class:"flex justify-end gap-2 mt-4"},{default:l(()=>[s(u,{type:"button",variant:"secondary",onClick:e[14]||(e[14]=t=>S.value=!1)},{default:l(()=>e[48]||(e[48]=[n("Cancel")])),_:1}),s(u,{type:"submit",variant:"default"},{default:l(()=>e[49]||(e[49]=[n("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):R("",!0),s(K,{open:D.value,"onUpdate:open":e[17]||(e[17]=t=>D.value=t)},{default:l(()=>[s(O,{"as-child":""}),s(G,null,{default:l(()=>[s(H,null,{default:l(()=>[s(J,null,{default:l(()=>e[50]||(e[50]=[n("Delete User")])),_:1})]),_:1}),e[53]||(e[53]=a("div",{class:"mt-2"},"Are you sure you want to delete this user? This action cannot be undone.",-1)),s(Q,{class:"flex justify-end gap-2 mt-4"},{default:l(()=>[s(u,{type:"button",variant:"secondary",onClick:e[16]||(e[16]=t=>D.value=!1)},{default:l(()=>e[51]||(e[51]=[n("Cancel")])),_:1}),s(u,{type:"button",variant:"destructive",onClick:pe},{default:l(()=>e[52]||(e[52]=[n("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{vt as default};
