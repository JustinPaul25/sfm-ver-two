import{d as oe,r as m,c as S,o as de,a as f,b as o,e as l,u as j,m as ue,w as n,f as s,g as Q,h as G,q as fe,i as d,F as _,j as y,t as p,P as pe,s as ge,k as O,l as E,v as N}from"./app-CBk11mag.js";import{_ as ve}from"./AppLayout.vue_vue_type_script_setup_true_lang-D12r0hmV.js";import{u as me}from"./CageStore-Bb3R4VDl.js";import{u as ce}from"./FeedTypeStore-DR4Yo1CV.js";import{u as _e,S as x}from"./sweetalert2.esm.all-B1y4sHGz.js";import{_ as g}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dq1VqWqp.js";import{_ as q}from"./Input.vue_vue_type_script_setup_true_lang-BJ61T-m5.js";import{_ as M,a as W,b as L,c as B,d as A}from"./DialogTitle.vue_vue_type_script_setup_true_lang-S02Kz3jF.js";import{_ as K}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-6aYthWHk.js";import"./useForwardExpose-DBlRa9Z3.js";import"./RovingFocusGroup-2FDYX2yh.js";const ye={class:"flex flex-col gap-4 p-4"},xe={class:"flex items-center justify-between gap-2"},be={class:"flex gap-2 items-center"},we={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},Ce={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},ke={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},he={key:0,class:"animate-pulse"},Se={key:1},$e={class:"px-6 py-4 whitespace-nowrap"},De={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"px-6 py-4 whitespace-nowrap text-right"},Te={class:"flex gap-1"},Ee={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Ne={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Ue={class:"flex items-center space-x-2"},Ie={class:"flex items-center space-x-1"},ze={class:"flex flex-col gap-1"},Pe=["value"],je={class:"flex flex-col gap-1"},qe={class:"flex flex-col gap-1"},Me=["value"],We={class:"flex flex-col gap-1"},Le={class:"flex items-center gap-2"},Be={class:"text-2xl"},Ae={class:"text-lg"},Ke={class:"text-sm text-gray-500"},Re={class:"flex items-center gap-2 mt-1"},Ye={class:"text-xs text-gray-400"},He=["value"],Je=["value"],ot=oe({__name:"Index",setup(Qe){const X=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"}],r=me(),R=ce(),Y=_e(),b=m(""),w=m(!1),C=m(!1),$=m(null),k=m(!1),u=m(null),D=S(()=>{const a=R.feedTypes;return(a==null?void 0:a.data)||[]}),V=S(()=>Y.investorsSelect),H=S(()=>{var a;return((a=r.cages)==null?void 0:a.data)||[]}),v=S(()=>{const a=r.cages;return a!=null&&a.current_page?{current_page:a.current_page,last_page:a.last_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to}:null}),c=m({number_of_fingerlings:0,feed_types_id:0,investor_id:0}),U=m("ðŸŒ¡ï¸"),I=m("--"),z=m("Loading..."),F=m("Loading..."),Z=a=>({Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Snow:"â„ï¸",Thunderstorm:"â›ˆï¸",Drizzle:"ðŸŒ¦ï¸",Mist:"ðŸŒ«ï¸"})[a]||"ðŸŒ¡ï¸",ee=async(a,e)=>{try{F.value="Davao City, Philippines"}catch{F.value="Davao City, Philippines"}};(async()=>{try{const e=125.684569,t=await fetch(`https://api.tomorrow.io/v4/weather/realtime?location=${7.305191},${e}&apikey=mcJYe6rycCpzd19wEcIRQgB9ks13EgTY&units=metric`);if(!t.ok)throw new Error(`Weather API responded with status: ${t.status}`);const i=await t.json();if(i.data&&i.data.values)U.value=Z(i.data.values.weatherCode),I.value=String(Math.round(i.data.values.temperature)),z.value=i.data.values.weatherCode;else throw new Error("Invalid weather data format");ee(7.305191,e)}catch(a){console.warn("Weather data unavailable:",a),U.value="ðŸŒ¡ï¸",I.value="--",z.value="Weather data unavailable",F.value="Davao City, Philippines"}})(),S(()=>{var a,e;return b.value?(((e=r.cages)==null?void 0:e.data)||[]).filter(t=>String(t.number_of_fingerlings).includes(b.value.toLowerCase())):((a=r.cages)==null?void 0:a.data)||[]});function J(){r.setFilters({search:b.value,page:1}),r.fetchCages()}function P(a){r.setFilters({...r.filters,page:a}),r.fetchCages()}function te(){if(!v.value)return[];const a=v.value.current_page,e=v.value.last_page,t=[];t.push(1);for(let i=Math.max(2,a-1);i<=Math.min(e-1,a+1);i++)i>1&&i<e&&t.push(i);return e>1&&t.push(e),[...new Set(t)].sort((i,T)=>i-T)}function ae(){var a,e;c.value={number_of_fingerlings:0,feed_types_id:((a=D.value[0])==null?void 0:a.id)||0,investor_id:((e=V.value[0])==null?void 0:e.id)||0},w.value=!0}async function se(){try{await r.createCage(c.value),await r.fetchCages(),w.value=!1,x.fire({icon:"success",title:"Cage created successfully!"})}catch(a){x.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to create cage."})}}function le(a){$.value=a,C.value=!0}async function ne(){if($.value!==null)try{await r.deleteCage($.value),await r.fetchCages(),C.value=!1,$.value=null,x.fire({icon:"success",title:"Cage deleted successfully!"})}catch(a){x.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to delete cage."})}}function re(a){u.value={...a},k.value=!0}async function ie(){if(u.value&&u.value.id)try{await r.updateCage(u.value.id,{number_of_fingerlings:u.value.number_of_fingerlings,feed_types_id:u.value.feed_types_id,investor_id:u.value.investor_id}),await r.fetchCages(),k.value=!1,u.value=null,x.fire({icon:"success",title:"Cage updated successfully!"})}catch(a){x.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to update cage."})}}return de(()=>{r.fetchCages(),R.fetchFeedTypes(),Y.fetchInvestorsSelect()}),(a,e)=>(o(),f(_,null,[l(j(ue),{title:"Cages"}),l(ve,{breadcrumbs:X},{default:n(()=>[s("div",ye,[s("div",xe,[s("div",be,[l(q,{modelValue:b.value,"onUpdate:modelValue":e[0]||(e[0]=t=>b.value=t),placeholder:"Search cages...",onKeyup:fe(J,["enter"]),class:"w-64"},null,8,["modelValue"]),l(g,{onClick:J,variant:"default"},{default:n(()=>e[15]||(e[15]=[d("Search")])),_:1})]),l(g,{onClick:ae,variant:"secondary"},{default:n(()=>e[16]||(e[16]=[d("Create Cage")])),_:1})]),s("div",we,[s("table",Ce,[e[22]||(e[22]=s("thead",{class:"bg-gray-50 dark:bg-gray-800"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Number of Fingerlings"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Feed Type"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),s("th",{class:"px-6 py-3"})])],-1)),s("tbody",ke,[j(r).loading?(o(),f("tr",he,e[17]||(e[17]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):H.value.length===0?(o(),f("tr",Se,e[18]||(e[18]=[s("td",{colspan:"4",class:"px-6 py-4 text-center text-gray-500"},"No cages found.",-1)]))):(o(!0),f(_,{key:2},y(H.value,t=>{var i,T;return o(),f("tr",{key:t==null?void 0:t.id},[s("td",$e,p(t==null?void 0:t.number_of_fingerlings),1),s("td",De,p(((i=D.value.find(h=>h.id===(t==null?void 0:t.feed_types_id)))==null?void 0:i.feed_type)||(t==null?void 0:t.feed_types_id)),1),s("td",Ve,p(((T=V.value.find(h=>h.id===(t==null?void 0:t.investor_id)))==null?void 0:T.name)||(t==null?void 0:t.investor_id)),1),s("td",Fe,[s("div",Te,[l(j(pe),{href:`/cages/${t.id}/view`},{default:n(()=>[l(g,{variant:"outline",size:"sm",title:"View",class:"w-8 h-8 p-0"},{default:n(()=>e[19]||(e[19]=[d(" ðŸ‘ï¸ ")])),_:1})]),_:2},1032,["href"]),l(g,{variant:"secondary",size:"sm",onClick:h=>re(t),disabled:!(t!=null&&t.id),title:"Update",class:"w-8 h-8 p-0"},{default:n(()=>e[20]||(e[20]=[d(" âœï¸ ")])),_:2},1032,["onClick","disabled"]),l(g,{variant:"destructive",size:"sm",onClick:h=>le(t==null?void 0:t.id),disabled:!(t!=null&&t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:n(()=>e[21]||(e[21]=[d(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"])])])])}),128))])])]),v.value?(o(),f("div",Ee,[s("div",Ne,[s("span",null,"Showing "+p(v.value.from)+" to "+p(v.value.to)+" of "+p(v.value.total)+" results",1)]),s("div",Ue,[l(g,{variant:"outline",size:"sm",disabled:v.value.current_page===1,onClick:e[1]||(e[1]=t=>P(v.value.current_page-1))},{default:n(()=>e[23]||(e[23]=[d(" Previous ")])),_:1},8,["disabled"]),s("div",Ie,[(o(!0),f(_,null,y(te(),t=>(o(),Q(g,{key:t,variant:"outline",size:"sm",class:ge(t===v.value.current_page?"bg-primary text-primary-foreground":""),onClick:i=>P(t)},{default:n(()=>[d(p(t),1)]),_:2},1032,["class","onClick"]))),128))]),l(g,{variant:"outline",size:"sm",disabled:v.value.current_page===v.value.last_page,onClick:e[2]||(e[2]=t=>P(v.value.current_page+1))},{default:n(()=>e[24]||(e[24]=[d(" Next ")])),_:1},8,["disabled"])])])):G("",!0)]),l(M,{open:w.value,"onUpdate:open":e[7]||(e[7]=t=>w.value=t)},{default:n(()=>[l(K,{"as-child":""}),l(W,null,{default:n(()=>[l(L,null,{default:n(()=>[l(B,null,{default:n(()=>e[25]||(e[25]=[d("Create Cage")])),_:1})]),_:1}),s("form",{onSubmit:O(se,["prevent"]),class:"flex flex-col gap-4 mt-2"},[s("div",ze,[e[26]||(e[26]=s("label",{for:"investor",class:"text-sm font-medium"},"Investor",-1)),E(s("select",{id:"investor","onUpdate:modelValue":e[3]||(e[3]=t=>c.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(o(!0),f(_,null,y(V.value,t=>(o(),f("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},p(t.name),9,Pe))),128))],512),[[N,c.value.investor_id]])]),s("div",je,[e[27]||(e[27]=s("label",{for:"fingerlings",class:"text-sm font-medium"},"Number of Fingerlings",-1)),l(q,{id:"fingerlings",modelValue:c.value.number_of_fingerlings,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.number_of_fingerlings=t),type:"number",placeholder:"Enter number of fingerlings",required:""},null,8,["modelValue"])]),s("div",qe,[e[28]||(e[28]=s("label",{for:"feedType",class:"text-sm font-medium"},"Feed Type",-1)),E(s("select",{id:"feedType","onUpdate:modelValue":e[5]||(e[5]=t=>c.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(o(!0),f(_,null,y(D.value,t=>(o(),f("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},p(t.feed_type),9,Me))),128))],512),[[N,c.value.feed_types_id]])]),s("div",We,[e[29]||(e[29]=s("label",{class:"text-sm font-medium"},"Weather Condition",-1)),s("div",Le,[s("span",Be,p(U.value),1),s("span",Ae,p(I.value)+"Â°C",1),s("span",Ke,p(z.value),1)]),s("div",Re,[s("span",Ye,p(F.value),1)])]),l(A,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(g,{type:"button",variant:"secondary",onClick:e[6]||(e[6]=t=>w.value=!1)},{default:n(()=>e[30]||(e[30]=[d("Cancel")])),_:1}),l(g,{type:"submit",variant:"default"},{default:n(()=>e[31]||(e[31]=[d("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(M,{open:C.value,"onUpdate:open":e[9]||(e[9]=t=>C.value=t)},{default:n(()=>[l(K,{"as-child":""}),l(W,null,{default:n(()=>[l(L,null,{default:n(()=>[l(B,null,{default:n(()=>e[32]||(e[32]=[d("Delete Cage")])),_:1})]),_:1}),e[35]||(e[35]=s("div",{class:"mt-2"},"Are you sure you want to delete this cage?",-1)),l(A,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(g,{type:"button",variant:"secondary",onClick:e[8]||(e[8]=t=>C.value=!1)},{default:n(()=>e[33]||(e[33]=[d("Cancel")])),_:1}),l(g,{type:"button",variant:"destructive",onClick:ne},{default:n(()=>e[34]||(e[34]=[d("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),u.value?(o(),Q(M,{key:0,open:k.value,"onUpdate:open":e[14]||(e[14]=t=>k.value=t)},{default:n(()=>[l(K,{"as-child":""}),l(W,null,{default:n(()=>[l(L,null,{default:n(()=>[l(B,null,{default:n(()=>e[36]||(e[36]=[d("Edit Cage")])),_:1})]),_:1}),s("form",{onSubmit:O(ie,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l(q,{modelValue:u.value.number_of_fingerlings,"onUpdate:modelValue":e[10]||(e[10]=t=>u.value.number_of_fingerlings=t),type:"number",placeholder:"Number of Fingerlings",required:""},null,8,["modelValue"]),E(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>u.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(o(!0),f(_,null,y(D.value,t=>(o(),f("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},p(t.feed_type),9,He))),128))],512),[[N,u.value.feed_types_id]]),E(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>u.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(o(!0),f(_,null,y(V.value,t=>(o(),f("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},p(t.name),9,Je))),128))],512),[[N,u.value.investor_id]]),l(A,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[l(g,{type:"button",variant:"secondary",onClick:e[13]||(e[13]=t=>k.value=!1)},{default:n(()=>e[37]||(e[37]=[d("Cancel")])),_:1}),l(g,{type:"submit",variant:"default"},{default:n(()=>e[38]||(e[38]=[d("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):G("",!0)]),_:1})],64))}});export{ot as default};
