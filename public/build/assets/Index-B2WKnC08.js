import{d as pe,B as ge,c as _,r as m,o as ve,a as p,b as n,e as l,u as I,m as me,w as r,f as s,g as $,h as V,C as ce,i as o,P as X,F as y,j as x,t as u,A as _e,k as Z,l as U,v as z}from"./app-cXB0WXeG.js";import{_ as ye}from"./AppLayout.vue_vue_type_script_setup_true_lang-BqJlz97b.js";import{u as xe}from"./CageStore-BGLmOpWJ.js";import{u as be}from"./FeedTypeStore-DTaJ2Uzw.js";import{u as we}from"./InvestorStore-BCpYQa4t.js";import{_ as g}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-BzgCzate.js";import{_ as B}from"./Input.vue_vue_type_script_setup_true_lang-Cu7ak-py.js";import{_ as L,a as A,b as R,c as K}from"./DialogTitle.vue_vue_type_script_setup_true_lang-6qZcBAmY.js";import{_ as Y}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-DL_Cg_zE.js";import{_ as H}from"./DialogFooter.vue_vue_type_script_setup_true_lang-D7RWneW6.js";import{S as b}from"./sweetalert2.esm.all-odB5D8k1.js";import"./useForwardExpose-CPJbi8KW.js";import"./RovingFocusGroup-B5r2yRVB.js";const Ce={class:"flex flex-col gap-4 p-4"},ke={class:"flex items-center justify-between gap-2"},he={class:"flex gap-2 items-center"},Se={class:"flex gap-2"},$e={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},Ve={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},De={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},Fe={key:0,class:"animate-pulse"},Te={key:1},Ne={class:"px-6 py-4 whitespace-nowrap font-medium"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ie={class:"px-6 py-4 whitespace-nowrap"},Ue={class:"px-6 py-4 whitespace-nowrap"},ze={class:"px-6 py-4 whitespace-nowrap text-right"},Pe={class:"flex gap-1"},je={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Me={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},We={class:"flex items-center space-x-2"},qe={class:"flex items-center space-x-1"},Be={class:"flex flex-col gap-1"},Le=["value"],Ae={class:"flex flex-col gap-1"},Re={class:"flex flex-col gap-1"},Ke=["value"],Ye={class:"flex flex-col gap-1"},He={class:"flex items-center gap-2"},Je={class:"text-2xl"},Qe={class:"text-lg"},Ge={class:"text-sm text-gray-500"},Oe={class:"flex items-center gap-2 mt-1"},Xe={class:"text-xs text-gray-400"},Ze=["value"],et=["value"],ct=pe({__name:"Index",setup(tt){const ee=ge(),te=_(()=>{var a,e;return((e=(a=ee.props.auth)==null?void 0:a.user)==null?void 0:e.role)||"farmer"}),P=_(()=>te.value==="investor"),ae=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"}],i=xe(),J=be(),Q=we(),w=m(""),C=m(!1),k=m(!1),D=m(null),h=m(!1),f=m(null),F=_(()=>{const a=J.feedTypes;return(a==null?void 0:a.data)||[]}),T=_(()=>Q.investorsSelect),G=_(()=>{var a;return((a=i.cages)==null?void 0:a.data)||[]}),v=_(()=>{const a=i.cages;return a!=null&&a.current_page?{current_page:a.current_page,last_page:a.last_page,per_page:a.per_page,total:a.total,from:a.from,to:a.to}:null}),c=m({number_of_fingerlings:0,feed_types_id:0,investor_id:0}),j=m("ðŸŒ¡ï¸"),M=m("--"),W=m("Loading..."),N=m("Loading..."),se=a=>({Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Snow:"â„ï¸",Thunderstorm:"â›ˆï¸",Drizzle:"ðŸŒ¦ï¸",Mist:"ðŸŒ«ï¸"})[a]||"ðŸŒ¡ï¸",le=async(a,e)=>{try{N.value="Davao City, Philippines"}catch{N.value="Davao City, Philippines"}};(async()=>{try{const e=125.684569,t=await fetch(`https://api.tomorrow.io/v4/weather/realtime?location=${7.305191},${e}&apikey=mcJYe6rycCpzd19wEcIRQgB9ks13EgTY&units=metric`);if(!t.ok)throw new Error(`Weather API responded with status: ${t.status}`);const d=await t.json();if(d.data&&d.data.values)j.value=se(d.data.values.weatherCode),M.value=String(Math.round(d.data.values.temperature)),W.value=d.data.values.weatherCode;else throw new Error("Invalid weather data format");le(7.305191,e)}catch(a){console.warn("Weather data unavailable:",a),j.value="ðŸŒ¡ï¸",M.value="--",W.value="Weather data unavailable",N.value="Davao City, Philippines"}})(),_(()=>{var a,e;return w.value?(((e=i.cages)==null?void 0:e.data)||[]).filter(t=>String(t.number_of_fingerlings).includes(w.value.toLowerCase())):((a=i.cages)==null?void 0:a.data)||[]});function O(){i.setFilters({search:w.value,page:1}),i.fetchCages()}function q(a){i.setFilters({...i.filters,page:a}),i.fetchCages()}function re(){if(!v.value)return[];const a=v.value.current_page,e=v.value.last_page,t=[];t.push(1);for(let d=Math.max(2,a-1);d<=Math.min(e-1,a+1);d++)d>1&&d<e&&t.push(d);return e>1&&t.push(e),[...new Set(t)].sort((d,E)=>d-E)}function ne(){var a,e;c.value={number_of_fingerlings:0,feed_types_id:((a=F.value[0])==null?void 0:a.id)||0,investor_id:((e=T.value[0])==null?void 0:e.id)||0},C.value=!0}async function oe(){try{await i.createCage(c.value),await i.fetchCages(),C.value=!1,b.fire({icon:"success",title:"Cage created successfully!"})}catch(a){b.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to create cage."})}}function ie(a){D.value=a,k.value=!0}async function de(){if(D.value!==null)try{await i.deleteCage(D.value),await i.fetchCages(),k.value=!1,D.value=null,b.fire({icon:"success",title:"Cage deleted successfully!"})}catch(a){b.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to delete cage."})}}function ue(a){f.value={...a},h.value=!0}async function fe(){if(f.value&&f.value.id)try{await i.updateCage(f.value.id,{number_of_fingerlings:f.value.number_of_fingerlings,feed_types_id:f.value.feed_types_id,investor_id:f.value.investor_id}),await i.fetchCages(),h.value=!1,f.value=null,b.fire({icon:"success",title:"Cage updated successfully!"})}catch(a){b.fire({icon:"error",title:"Error",text:(a==null?void 0:a.message)||"Failed to update cage."})}}return ve(()=>{i.fetchCages(),J.fetchFeedTypes(),Q.fetchInvestorsSelect()}),(a,e)=>(n(),p(y,null,[l(I(me),{title:"Cages"}),l(ye,{breadcrumbs:ae},{default:r(()=>[s("div",Ce,[s("div",ke,[s("div",he,[l(B,{modelValue:w.value,"onUpdate:modelValue":e[0]||(e[0]=t=>w.value=t),placeholder:"Search cages...",onKeyup:ce(O,["enter"]),class:"w-64"},null,8,["modelValue"]),l(g,{onClick:O,variant:"default"},{default:r(()=>e[15]||(e[15]=[o("Search")])),_:1})]),s("div",Se,[l(I(X),{href:a.route("cages.verification")},{default:r(()=>[l(g,{variant:"outline"},{default:r(()=>e[16]||(e[16]=[o("Per Cage Verification")])),_:1})]),_:1},8,["href"]),P.value?V("",!0):(n(),$(g,{key:0,onClick:ne,variant:"secondary"},{default:r(()=>e[17]||(e[17]=[o("Create Cage")])),_:1}))])]),s("div",$e,[s("table",Ve,[e[23]||(e[23]=s("thead",{class:"bg-gray-50 dark:bg-gray-800"},[s("tr",null,[s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage Number"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Number of Fingerlings"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Feed Type"),s("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),s("th",{class:"px-6 py-3"})])],-1)),s("tbody",De,[I(i).loading?(n(),p("tr",Fe,e[18]||(e[18]=[s("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):G.value.length===0?(n(),p("tr",Te,e[19]||(e[19]=[s("td",{colspan:"5",class:"px-6 py-4 text-center text-gray-500"},"No cages found.",-1)]))):(n(!0),p(y,{key:2},x(G.value,t=>{var d,E;return n(),p("tr",{key:t==null?void 0:t.id},[s("td",Ne,u(t==null?void 0:t.id),1),s("td",Ee,u(t==null?void 0:t.number_of_fingerlings),1),s("td",Ie,u(((d=F.value.find(S=>S.id===(t==null?void 0:t.feed_types_id)))==null?void 0:d.feed_type)||(t==null?void 0:t.feed_types_id)),1),s("td",Ue,u(((E=T.value.find(S=>S.id===(t==null?void 0:t.investor_id)))==null?void 0:E.name)||(t==null?void 0:t.investor_id)),1),s("td",ze,[s("div",Pe,[l(I(X),{href:`/cages/${t.id}/view`},{default:r(()=>[l(g,{variant:"outline",size:"sm",title:"View",class:"w-8 h-8 p-0"},{default:r(()=>e[20]||(e[20]=[o(" ðŸ‘ï¸ ")])),_:1})]),_:2},1032,["href"]),P.value?V("",!0):(n(),$(g,{key:0,variant:"secondary",size:"sm",onClick:S=>ue(t),disabled:!(t!=null&&t.id),title:"Update",class:"w-8 h-8 p-0"},{default:r(()=>e[21]||(e[21]=[o(" âœï¸ ")])),_:2},1032,["onClick","disabled"])),P.value?V("",!0):(n(),$(g,{key:1,variant:"destructive",size:"sm",onClick:S=>ie(t==null?void 0:t.id),disabled:!(t!=null&&t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:r(()=>e[22]||(e[22]=[o(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"]))])])])}),128))])])]),v.value?(n(),p("div",je,[s("div",Me,[s("span",null,"Showing "+u(v.value.from)+" to "+u(v.value.to)+" of "+u(v.value.total)+" results",1)]),s("div",We,[l(g,{variant:"outline",size:"sm",disabled:v.value.current_page===1,onClick:e[1]||(e[1]=t=>q(v.value.current_page-1))},{default:r(()=>e[24]||(e[24]=[o(" Previous ")])),_:1},8,["disabled"]),s("div",qe,[(n(!0),p(y,null,x(re(),t=>(n(),$(g,{key:t,variant:"outline",size:"sm",class:_e(t===v.value.current_page?"bg-primary text-primary-foreground":""),onClick:d=>q(t)},{default:r(()=>[o(u(t),1)]),_:2},1032,["class","onClick"]))),128))]),l(g,{variant:"outline",size:"sm",disabled:v.value.current_page===v.value.last_page,onClick:e[2]||(e[2]=t=>q(v.value.current_page+1))},{default:r(()=>e[25]||(e[25]=[o(" Next ")])),_:1},8,["disabled"])])])):V("",!0)]),l(L,{open:C.value,"onUpdate:open":e[7]||(e[7]=t=>C.value=t)},{default:r(()=>[l(Y,{"as-child":""}),l(A,null,{default:r(()=>[l(R,null,{default:r(()=>[l(K,null,{default:r(()=>e[26]||(e[26]=[o("Create Cage")])),_:1})]),_:1}),s("form",{onSubmit:Z(oe,["prevent"]),class:"flex flex-col gap-4 mt-2"},[s("div",Be,[e[27]||(e[27]=s("label",{for:"investor",class:"text-sm font-medium"},"Investor",-1)),U(s("select",{id:"investor","onUpdate:modelValue":e[3]||(e[3]=t=>c.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),p(y,null,x(T.value,t=>(n(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},u(t.name),9,Le))),128))],512),[[z,c.value.investor_id]])]),s("div",Ae,[e[28]||(e[28]=s("label",{for:"fingerlings",class:"text-sm font-medium"},"Number of Fingerlings",-1)),l(B,{id:"fingerlings",modelValue:c.value.number_of_fingerlings,"onUpdate:modelValue":e[4]||(e[4]=t=>c.value.number_of_fingerlings=t),type:"number",placeholder:"Enter number of fingerlings",required:""},null,8,["modelValue"])]),s("div",Re,[e[29]||(e[29]=s("label",{for:"feedType",class:"text-sm font-medium"},"Feed Type",-1)),U(s("select",{id:"feedType","onUpdate:modelValue":e[5]||(e[5]=t=>c.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),p(y,null,x(F.value,t=>(n(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},u(t.feed_type),9,Ke))),128))],512),[[z,c.value.feed_types_id]])]),s("div",Ye,[e[30]||(e[30]=s("label",{class:"text-sm font-medium"},"Weather Condition",-1)),s("div",He,[s("span",Je,u(j.value),1),s("span",Qe,u(M.value)+"Â°C",1),s("span",Ge,u(W.value),1)]),s("div",Oe,[s("span",Xe,u(N.value),1)])]),l(H,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(g,{type:"button",variant:"secondary",onClick:e[6]||(e[6]=t=>C.value=!1)},{default:r(()=>e[31]||(e[31]=[o("Cancel")])),_:1}),l(g,{type:"submit",variant:"default"},{default:r(()=>e[32]||(e[32]=[o("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(L,{open:k.value,"onUpdate:open":e[9]||(e[9]=t=>k.value=t)},{default:r(()=>[l(Y,{"as-child":""}),l(A,null,{default:r(()=>[l(R,null,{default:r(()=>[l(K,null,{default:r(()=>e[33]||(e[33]=[o("Delete Cage")])),_:1})]),_:1}),e[36]||(e[36]=s("div",{class:"mt-2"},"Are you sure you want to delete this cage?",-1)),l(H,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(g,{type:"button",variant:"secondary",onClick:e[8]||(e[8]=t=>k.value=!1)},{default:r(()=>e[34]||(e[34]=[o("Cancel")])),_:1}),l(g,{type:"button",variant:"destructive",onClick:de},{default:r(()=>e[35]||(e[35]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),f.value?(n(),$(L,{key:0,open:h.value,"onUpdate:open":e[14]||(e[14]=t=>h.value=t)},{default:r(()=>[l(Y,{"as-child":""}),l(A,null,{default:r(()=>[l(R,null,{default:r(()=>[l(K,null,{default:r(()=>e[37]||(e[37]=[o("Edit Cage")])),_:1})]),_:1}),s("form",{onSubmit:Z(fe,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l(B,{modelValue:f.value.number_of_fingerlings,"onUpdate:modelValue":e[10]||(e[10]=t=>f.value.number_of_fingerlings=t),type:"number",placeholder:"Number of Fingerlings",required:""},null,8,["modelValue"]),U(s("select",{"onUpdate:modelValue":e[11]||(e[11]=t=>f.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),p(y,null,x(F.value,t=>(n(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},u(t.feed_type),9,Ze))),128))],512),[[z,f.value.feed_types_id]]),U(s("select",{"onUpdate:modelValue":e[12]||(e[12]=t=>f.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),p(y,null,x(T.value,t=>(n(),p("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},u(t.name),9,et))),128))],512),[[z,f.value.investor_id]]),l(H,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(g,{type:"button",variant:"secondary",onClick:e[13]||(e[13]=t=>h.value=!1)},{default:r(()=>e[38]||(e[38]=[o("Cancel")])),_:1}),l(g,{type:"submit",variant:"default"},{default:r(()=>e[39]||(e[39]=[o("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):V("",!0)]),_:1})],64))}});export{ct as default};
