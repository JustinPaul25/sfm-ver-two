import{d as ce,B as xe,c,r as m,o as be,a as o,b as n,e as l,u as j,m as we,w as r,f as a,g as T,h as b,C as Ce,i as u,P as re,F as _,j as x,t as d,A as ke,k as ne,l as C,v as k}from"./app-CzhniAMT.js";import{_ as he}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cfv7ZBw5.js";import{u as $e}from"./CageStore-CN15d4Px.js";import{u as Fe}from"./FeedTypeStore-D90Ln-eR.js";import{u as Se}from"./InvestorStore-CnWGJkUt.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-1iHGJxcY.js";import{_ as L}from"./Input.vue_vue_type_script_setup_true_lang-DoOMrtD2.js";import{_ as O,a as R,b as K,c as Y}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BHnP_P35.js";import{_ as H}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CODCzXzO.js";import{_ as J}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DjHRfOq4.js";import{S as h}from"./sweetalert2.esm.all-odB5D8k1.js";import"./useForwardExpose-DEh402Yc.js";import"./RovingFocusGroup-Daz5GHfr.js";const Ve={class:"flex flex-col gap-4 p-4"},De={class:"flex items-center justify-between gap-2"},Te={class:"flex gap-2 items-center"},Ee={class:"flex gap-2"},Ne={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},Ue={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ie={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},ze={key:0,class:"animate-pulse"},Pe={key:1},je={class:"px-6 py-4 whitespace-nowrap font-medium"},Be={class:"px-6 py-4 whitespace-nowrap"},Me={class:"px-6 py-4 whitespace-nowrap"},We={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ae={class:"px-6 py-4 whitespace-nowrap text-right"},Le={class:"flex gap-1"},Oe={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Re={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Ke={class:"flex items-center space-x-2"},Ye={class:"flex items-center space-x-1"},He={class:"flex flex-col gap-1"},Je=["value"],Qe={class:"flex flex-col gap-1"},Ge={class:"flex flex-col gap-1"},Xe=["value"],Ze={key:0,class:"flex flex-col gap-1"},et=["value"],tt={class:"flex flex-col gap-1"},at={class:"flex items-center gap-2"},st={class:"text-2xl"},lt={class:"text-lg"},rt={class:"text-sm text-gray-500"},nt={class:"flex items-center gap-2 mt-1"},ot={class:"text-xs text-gray-400"},it={class:"flex flex-col gap-1"},dt=["value"],ut={class:"flex flex-col gap-1"},ft={class:"flex flex-col gap-1"},pt=["value"],vt={key:0,class:"flex flex-col gap-1"},gt=["value"],Tt=ce({__name:"Index",setup(mt){const oe=xe(),Q=c(()=>{var s,e;return((e=(s=oe.props.auth)==null?void 0:s.user)==null?void 0:e.role)||"farmer"}),B=c(()=>Q.value==="investor"),G=c(()=>Q.value==="admin"),ie=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"}],f=$e(),X=Fe(),Z=Se(),$=m(""),F=m(!1),S=m(!1),E=m(null),V=m(!1),i=m(null),N=c(()=>{const s=X.feedTypes;return(s==null?void 0:s.data)||[]}),w=c(()=>Z.investorsSelect),U=m([]),I=m([]),ee=c(()=>{var s;return((s=f.cages)==null?void 0:s.data)||[]}),g=c(()=>{const s=f.cages;return s!=null&&s.current_page?{current_page:s.current_page,last_page:s.last_page,per_page:s.per_page,total:s.total,from:s.from,to:s.to}:null}),y=m({number_of_fingerlings:0,feed_types_id:0,investor_id:0,farmer_id:null}),M=m("ðŸŒ¡ï¸"),W=m("--"),q=m("Loading..."),z=m("Loading..."),de=s=>({Clear:"â˜€ï¸",Clouds:"â˜ï¸",Rain:"ðŸŒ§ï¸",Snow:"â„ï¸",Thunderstorm:"â›ˆï¸",Drizzle:"ðŸŒ¦ï¸",Mist:"ðŸŒ«ï¸"})[s]||"ðŸŒ¡ï¸",ue=async(s,e)=>{try{z.value="Davao City, Philippines"}catch{z.value="Davao City, Philippines"}};(async()=>{try{const e=125.684569,t=await fetch(`https://api.tomorrow.io/v4/weather/realtime?location=${7.305191},${e}&apikey=mcJYe6rycCpzd19wEcIRQgB9ks13EgTY&units=metric`);if(!t.ok)throw new Error(`Weather API responded with status: ${t.status}`);const p=await t.json();if(p.data&&p.data.values)M.value=de(p.data.values.weatherCode),W.value=String(Math.round(p.data.values.temperature)),q.value=p.data.values.weatherCode;else throw new Error("Invalid weather data format");ue(7.305191,e)}catch(s){console.warn("Weather data unavailable:",s),M.value="ðŸŒ¡ï¸",W.value="--",q.value="Weather data unavailable",z.value="Davao City, Philippines"}})(),c(()=>{var s,e;return $.value?(((e=f.cages)==null?void 0:e.data)||[]).filter(t=>String(t.number_of_fingerlings).includes($.value.toLowerCase())):((s=f.cages)==null?void 0:s.data)||[]});function te(){f.setFilters({search:$.value,page:1}),f.fetchCages()}function A(s){f.setFilters({...f.filters,page:s}),f.fetchCages()}function fe(){if(!g.value)return[];const s=g.value.current_page,e=g.value.last_page,t=[];t.push(1);for(let p=Math.max(2,s-1);p<=Math.min(e-1,s+1);p++)p>1&&p<e&&t.push(p);return e>1&&t.push(e),[...new Set(t)].sort((p,P)=>p-P)}async function ae(s){if(!s){U.value=[];return}try{const e=await fetch(`/users/farmers-by-investor?investor_id=${s}`);e.ok&&(U.value=await e.json())}catch(e){console.error("Error fetching farmers:",e),U.value=[]}}async function se(s){if(!s){I.value=[];return}try{const e=await fetch(`/users/farmers-by-investor?investor_id=${s}`);e.ok&&(I.value=await e.json())}catch(e){console.error("Error fetching farmers:",e),I.value=[]}}function pe(){var s,e,t;y.value={number_of_fingerlings:0,feed_types_id:((s=N.value[0])==null?void 0:s.id)||0,investor_id:((e=w.value[0])==null?void 0:e.id)||0,farmer_id:null},(t=w.value[0])!=null&&t.id&&ae(w.value[0].id),F.value=!0}async function ve(){try{await f.createCage(y.value),await f.fetchCages(),F.value=!1,h.fire({icon:"success",title:"Cage created successfully!"})}catch(s){h.fire({icon:"error",title:"Error",text:(s==null?void 0:s.message)||"Failed to create cage."})}}function ge(s){E.value=s,S.value=!0}async function me(){if(E.value!==null)try{await f.deleteCage(E.value),await f.fetchCages(),S.value=!1,E.value=null,h.fire({icon:"success",title:"Cage deleted successfully!"})}catch(s){h.fire({icon:"error",title:"Error",text:(s==null?void 0:s.message)||"Failed to delete cage."})}}function ye(s){i.value={...s},s.investor_id&&se(s.investor_id),V.value=!0}async function _e(){if(i.value&&i.value.id)try{await f.updateCage(i.value.id,{number_of_fingerlings:i.value.number_of_fingerlings,feed_types_id:i.value.feed_types_id,investor_id:i.value.investor_id,farmer_id:i.value.farmer_id}),await f.fetchCages(),V.value=!1,i.value=null,h.fire({icon:"success",title:"Cage updated successfully!"})}catch(s){h.fire({icon:"error",title:"Error",text:(s==null?void 0:s.message)||"Failed to update cage."})}}return be(()=>{f.fetchCages(),X.fetchFeedTypes(),Z.fetchInvestorsSelect()}),(s,e)=>(n(),o(_,null,[l(j(we),{title:"Cages"}),l(he,{breadcrumbs:ie},{default:r(()=>[a("div",Ve,[a("div",De,[a("div",Te,[l(L,{modelValue:$.value,"onUpdate:modelValue":e[0]||(e[0]=t=>$.value=t),placeholder:"Search cages...",onKeyup:Ce(te,["enter"]),class:"w-64"},null,8,["modelValue"]),l(v,{onClick:te,variant:"default"},{default:r(()=>e[19]||(e[19]=[u("Search")])),_:1})]),a("div",Ee,[l(j(re),{href:s.route("cages.verification")},{default:r(()=>[l(v,{variant:"outline"},{default:r(()=>e[20]||(e[20]=[u("Per Cage Verification")])),_:1})]),_:1},8,["href"]),B.value?b("",!0):(n(),T(v,{key:0,onClick:pe,variant:"secondary"},{default:r(()=>e[21]||(e[21]=[u("Create Cage")])),_:1}))])]),a("div",Ne,[a("table",Ue,[e[27]||(e[27]=a("thead",{class:"bg-gray-50 dark:bg-gray-800"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage Number"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Number of Fingerlings"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Feed Type"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Farmer"),a("th",{class:"px-6 py-3"})])],-1)),a("tbody",Ie,[j(f).loading?(n(),o("tr",ze,e[22]||(e[22]=[a("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):ee.value.length===0?(n(),o("tr",Pe,e[23]||(e[23]=[a("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"No cages found.",-1)]))):(n(!0),o(_,{key:2},x(ee.value,t=>{var p,P,le;return n(),o("tr",{key:t==null?void 0:t.id},[a("td",je,d(t==null?void 0:t.id),1),a("td",Be,d(t==null?void 0:t.number_of_fingerlings),1),a("td",Me,d(((p=N.value.find(D=>D.id===(t==null?void 0:t.feed_types_id)))==null?void 0:p.feed_type)||(t==null?void 0:t.feed_types_id)),1),a("td",We,d(((P=w.value.find(D=>D.id===(t==null?void 0:t.investor_id)))==null?void 0:P.name)||(t==null?void 0:t.investor_id)),1),a("td",qe,d(((le=t==null?void 0:t.farmer)==null?void 0:le.name)||"-"),1),a("td",Ae,[a("div",Le,[l(j(re),{href:`/cages/${t.id}/view`},{default:r(()=>[l(v,{variant:"outline",size:"sm",title:"View",class:"w-8 h-8 p-0"},{default:r(()=>e[24]||(e[24]=[u(" ðŸ‘ï¸ ")])),_:1})]),_:2},1032,["href"]),B.value?b("",!0):(n(),T(v,{key:0,variant:"secondary",size:"sm",onClick:D=>ye(t),disabled:!(t!=null&&t.id),title:"Update",class:"w-8 h-8 p-0"},{default:r(()=>e[25]||(e[25]=[u(" âœï¸ ")])),_:2},1032,["onClick","disabled"])),B.value?b("",!0):(n(),T(v,{key:1,variant:"destructive",size:"sm",onClick:D=>ge(t==null?void 0:t.id),disabled:!(t!=null&&t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:r(()=>e[26]||(e[26]=[u(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"]))])])])}),128))])])]),g.value?(n(),o("div",Oe,[a("div",Re,[a("span",null,"Showing "+d(g.value.from)+" to "+d(g.value.to)+" of "+d(g.value.total)+" results",1)]),a("div",Ke,[l(v,{variant:"outline",size:"sm",disabled:g.value.current_page===1,onClick:e[1]||(e[1]=t=>A(g.value.current_page-1))},{default:r(()=>e[28]||(e[28]=[u(" Previous ")])),_:1},8,["disabled"]),a("div",Ye,[(n(!0),o(_,null,x(fe(),t=>(n(),T(v,{key:t,variant:"outline",size:"sm",class:ke(t===g.value.current_page?"bg-primary text-primary-foreground":""),onClick:p=>A(t)},{default:r(()=>[u(d(t),1)]),_:2},1032,["class","onClick"]))),128))]),l(v,{variant:"outline",size:"sm",disabled:g.value.current_page===g.value.last_page,onClick:e[2]||(e[2]=t=>A(g.value.current_page+1))},{default:r(()=>e[29]||(e[29]=[u(" Next ")])),_:1},8,["disabled"])])])):b("",!0)]),l(O,{open:F.value,"onUpdate:open":e[9]||(e[9]=t=>F.value=t)},{default:r(()=>[l(H,{"as-child":""}),l(R,null,{default:r(()=>[l(K,null,{default:r(()=>[l(Y,null,{default:r(()=>e[30]||(e[30]=[u("Create Cage")])),_:1})]),_:1}),a("form",{onSubmit:ne(ve,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",He,[e[31]||(e[31]=a("label",{for:"investor",class:"text-sm font-medium"},"Investor",-1)),C(a("select",{id:"investor","onUpdate:modelValue":e[3]||(e[3]=t=>y.value.investor_id=t),onChange:e[4]||(e[4]=t=>ae(y.value.investor_id)),class:"input w-full rounded border p-2",required:""},[(n(!0),o(_,null,x(w.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.name),9,Je))),128))],544),[[k,y.value.investor_id]])]),a("div",Qe,[e[32]||(e[32]=a("label",{for:"fingerlings",class:"text-sm font-medium"},"Number of Fingerlings",-1)),l(L,{id:"fingerlings",modelValue:y.value.number_of_fingerlings,"onUpdate:modelValue":e[5]||(e[5]=t=>y.value.number_of_fingerlings=t),type:"number",placeholder:"Enter number of fingerlings",required:""},null,8,["modelValue"])]),a("div",Ge,[e[33]||(e[33]=a("label",{for:"feedType",class:"text-sm font-medium"},"Feed Type",-1)),C(a("select",{id:"feedType","onUpdate:modelValue":e[6]||(e[6]=t=>y.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),o(_,null,x(N.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.feed_type),9,Xe))),128))],512),[[k,y.value.feed_types_id]])]),G.value?(n(),o("div",Ze,[e[35]||(e[35]=a("label",{for:"farmer",class:"text-sm font-medium"},"Assign Farmer (Optional)",-1)),C(a("select",{id:"farmer","onUpdate:modelValue":e[7]||(e[7]=t=>y.value.farmer_id=t),class:"input w-full rounded border p-2"},[e[34]||(e[34]=a("option",{value:null},"No farmer assigned",-1)),(n(!0),o(_,null,x(U.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.name),9,et))),128))],512),[[k,y.value.farmer_id]]),e[36]||(e[36]=a("p",{class:"text-xs text-gray-500 mt-1"},"Only farmers belonging to the selected investor are shown",-1))])):b("",!0),a("div",tt,[e[37]||(e[37]=a("label",{class:"text-sm font-medium"},"Weather Condition",-1)),a("div",at,[a("span",st,d(M.value),1),a("span",lt,d(W.value)+"Â°C",1),a("span",rt,d(q.value),1)]),a("div",nt,[a("span",ot,d(z.value),1)])]),l(J,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(v,{type:"button",variant:"secondary",onClick:e[8]||(e[8]=t=>F.value=!1)},{default:r(()=>e[38]||(e[38]=[u("Cancel")])),_:1}),l(v,{type:"submit",variant:"default"},{default:r(()=>e[39]||(e[39]=[u("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),l(O,{open:S.value,"onUpdate:open":e[11]||(e[11]=t=>S.value=t)},{default:r(()=>[l(H,{"as-child":""}),l(R,null,{default:r(()=>[l(K,null,{default:r(()=>[l(Y,null,{default:r(()=>e[40]||(e[40]=[u("Delete Cage")])),_:1})]),_:1}),e[43]||(e[43]=a("div",{class:"mt-2"},"Are you sure you want to delete this cage?",-1)),l(J,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(v,{type:"button",variant:"secondary",onClick:e[10]||(e[10]=t=>S.value=!1)},{default:r(()=>e[41]||(e[41]=[u("Cancel")])),_:1}),l(v,{type:"button",variant:"destructive",onClick:me},{default:r(()=>e[42]||(e[42]=[u("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),i.value?(n(),T(O,{key:0,open:V.value,"onUpdate:open":e[18]||(e[18]=t=>V.value=t)},{default:r(()=>[l(H,{"as-child":""}),l(R,null,{default:r(()=>[l(K,null,{default:r(()=>[l(Y,null,{default:r(()=>e[44]||(e[44]=[u("Edit Cage")])),_:1})]),_:1}),a("form",{onSubmit:ne(_e,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",it,[e[45]||(e[45]=a("label",{for:"edit_investor",class:"text-sm font-medium"},"Investor",-1)),C(a("select",{id:"edit_investor","onUpdate:modelValue":e[12]||(e[12]=t=>i.value.investor_id=t),onChange:e[13]||(e[13]=t=>se(i.value.investor_id)),class:"input w-full rounded border p-2",required:""},[(n(!0),o(_,null,x(w.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.name),9,dt))),128))],544),[[k,i.value.investor_id]])]),a("div",ut,[e[46]||(e[46]=a("label",{for:"edit_fingerlings",class:"text-sm font-medium"},"Number of Fingerlings",-1)),l(L,{id:"edit_fingerlings",modelValue:i.value.number_of_fingerlings,"onUpdate:modelValue":e[14]||(e[14]=t=>i.value.number_of_fingerlings=t),type:"number",placeholder:"Number of Fingerlings",required:""},null,8,["modelValue"])]),a("div",ft,[e[47]||(e[47]=a("label",{for:"edit_feedType",class:"text-sm font-medium"},"Feed Type",-1)),C(a("select",{id:"edit_feedType","onUpdate:modelValue":e[15]||(e[15]=t=>i.value.feed_types_id=t),class:"input w-full rounded border p-2",required:""},[(n(!0),o(_,null,x(N.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.feed_type),9,pt))),128))],512),[[k,i.value.feed_types_id]])]),G.value?(n(),o("div",vt,[e[49]||(e[49]=a("label",{for:"edit_farmer",class:"text-sm font-medium"},"Assign Farmer (Optional)",-1)),C(a("select",{id:"edit_farmer","onUpdate:modelValue":e[16]||(e[16]=t=>i.value.farmer_id=t),class:"input w-full rounded border p-2"},[e[48]||(e[48]=a("option",{value:null},"No farmer assigned",-1)),(n(!0),o(_,null,x(I.value,t=>(n(),o("option",{key:t.id,value:t.id,class:"bg-background text-foreground"},d(t.name),9,gt))),128))],512),[[k,i.value.farmer_id]]),e[50]||(e[50]=a("p",{class:"text-xs text-gray-500 mt-1"},"Only farmers belonging to the selected investor are shown",-1))])):b("",!0),l(J,{class:"flex justify-end gap-2 mt-4"},{default:r(()=>[l(v,{type:"button",variant:"secondary",onClick:e[17]||(e[17]=t=>V.value=!1)},{default:r(()=>e[51]||(e[51]=[u("Cancel")])),_:1}),l(v,{type:"submit",variant:"default"},{default:r(()=>e[52]||(e[52]=[u("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):b("",!0)]),_:1})],64))}});export{Tt as default};
