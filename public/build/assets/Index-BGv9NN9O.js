import{L as fe,r as x,p as I,d as ge,c as z,o as ve,a as m,b as p,e as a,u as ce,m as ye,w as i,f as l,g as X,h as P,i as o,t as g,F as S,j as U,A as xe,k as Z,l as A,v as q,W as _e}from"./app-Ce6-Ko34.js";import{_ as be}from"./AppLayout.vue_vue_type_script_setup_true_lang-DqDg9dOe.js";import{u as we,S as _}from"./sweetalert2.esm.all-KgwFWWKB.js";import{u as Se}from"./CageStore-D7UrGiMJ.js";import{_ as f}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-CPp0Lkx-.js";import{_ as V}from"./Input.vue_vue_type_script_setup_true_lang-CHwePdod.js";import{_ as b}from"./Label.vue_vue_type_script_setup_true_lang-D_LTZJ-v.js";import{_ as G,a as L,b as O,c as R,d as W}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CvRFGcOW.js";import{_ as H}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-C1TrrhhC.js";import"./useForwardExpose-RCeQWXU4.js";import"./RovingFocusGroup-Cx0dFY1W.js";const ke=fe("sampling",()=>{const w=x([]),v=x(!1),r=x(null),k=x({search:"",page:1});return{samplings:w,loading:v,error:r,filters:k,fetchSamplings:async()=>{v.value=!0,r.value=null;try{const u=await I.get(route("samplings.list"),{params:k.value});w.value=u.data.samplings}catch(u){r.value=u.message}finally{v.value=!1}},createSampling:async u=>{v.value=!0,r.value=null;try{return(await I.post(route("samplings.store"),u)).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},updateSampling:async(u,s)=>{v.value=!0,r.value=null;try{const y=await I.put(route("samplings.update",u),s);if(w.value&&w.value.data&&Array.isArray(w.value.data)){const $=w.value.data.findIndex(c=>c.id===u);$!==-1&&(w.value.data[$]=y.data.sampling)}return y.data}catch(y){throw r.value=y.message,y}finally{v.value=!1}},deleteSampling:async u=>{v.value=!0,r.value=null;try{return(await I.delete(route("samplings.destroy",u))).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},generateSamples:async u=>{v.value=!0,r.value=null;try{return(await I.post(route("samplings.generate-samples",u))).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},setFilters:u=>{k.value={...k.value,...u}}}}),Ce={class:"flex flex-col gap-4 p-4"},Ve={class:"flex items-center justify-between gap-2"},he={class:"flex gap-2 items-center"},De={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},$e={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ue={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},Ee={key:0},Ie={key:1},ze={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"px-6 py-4 whitespace-nowrap"},Me={class:"px-6 py-4 whitespace-nowrap"},Te={class:"px-6 py-4 whitespace-nowrap"},Ae={class:"px-6 py-4 whitespace-nowrap"},qe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Be={class:"px-6 py-4 whitespace-nowrap text-right"},Ne={class:"flex gap-1"},je={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Pe={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Ge={class:"flex items-center space-x-2"},Le={class:"flex items-center space-x-1"},Oe={key:1,class:"px-2"},Re={class:"flex flex-col gap-2"},We=["value"],He={class:"flex flex-col gap-2"},Ye={class:"flex flex-col gap-2"},Je={class:"flex flex-col gap-2"},Ke=["value"],Qe={class:"flex flex-col gap-2"},Xe={class:"flex flex-col gap-2"},Ze=["value"],et={class:"flex flex-col gap-2"},tt={class:"flex flex-col gap-2"},at={class:"flex flex-col gap-2"},lt=["value"],nt={class:"flex flex-col gap-2"},ct=ge({__name:"Index",setup(w){var K;const v=[{title:"Dashboard",href:"/dashboard"},{title:"Samplings",href:"/samplings"}],r=ke(),k=we(),B=Se(),F=x(""),M=z(()=>r.loading),h=x(!1),D=x(!1),E=x(null),u=x(!1),s=x(null),y=z(()=>k.investorsSelect),$=z(()=>{const n=B.cages;return(n==null?void 0:n.data)||[]}),c=x({investor_id:((K=y.value[0])==null?void 0:K.id)||3,date_sampling:"",doc:"",cage_no:0,mortality:0}),T=z(()=>{const n=r.samplings;return(n==null?void 0:n.data)||[]}),d=z(()=>{const n=r.samplings;return n!=null&&n.current_page?{current_page:n.current_page,last_page:n.last_page,per_page:n.per_page,total:n.total,from:n.from,to:n.to}:null});function Y(){r.setFilters({search:F.value,page:1}),r.fetchSamplings()}let J;function ee(){clearTimeout(J),J=setTimeout(()=>{Y()},300)}function N(n){r.setFilters({...r.filters,page:n}),r.fetchSamplings()}function te(){d.value&&d.value.current_page<d.value.last_page&&N(d.value.current_page+1)}function ae(){d.value&&d.value.current_page>1&&N(d.value.current_page-1)}function le(){var t,e;const n=((t=$.value[0])==null?void 0:t.id)??0;c.value={investor_id:((e=y.value[0])==null?void 0:e.id)||1,date_sampling:"",doc:"",cage_no:n,mortality:0},h.value=!0}async function ne(){try{await r.createSampling(c.value),await r.fetchSamplings(),h.value=!1,_.fire({icon:"success",title:"Sampling created successfully!"})}catch(n){_.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to create sampling."})}}function ie(n){E.value=n,D.value=!0}async function se(){if(E.value!==null)try{await r.deleteSampling(E.value),await r.fetchSamplings(),D.value=!1,E.value=null,_.fire({icon:"success",title:"Sampling deleted successfully!"})}catch(n){_.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to delete sampling."})}}function oe(n){s.value={...n},u.value=!0}async function re(){if(s.value&&s.value.id)try{await r.updateSampling(s.value.id,{investor_id:s.value.investor_id,date_sampling:s.value.date_sampling,cage_no:s.value.cage_no,mortality:s.value.mortality||0}),await r.fetchSamplings(),u.value=!1,s.value=null,_.fire({icon:"success",title:"Sampling updated successfully!"})}catch(n){_.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to update sampling."})}}async function de(n){var t;try{(await _.fire({title:"Generate Samples?",text:"This will create 30 sample records for this sampling. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Generate",cancelButtonText:"Cancel"})).isConfirmed&&(await r.generateSamples(n),await r.fetchSamplings(),_.fire({icon:"success",title:"Samples Generated!",text:"30 sample records have been created successfully."}))}catch(e){((t=e==null?void 0:e.response)==null?void 0:t.status)===400?_.fire({icon:"warning",title:"Samples Already Exist",text:e.response.data.message}):_.fire({icon:"error",title:"Error",text:(e==null?void 0:e.message)||"Failed to generate samples."})}}function ue(n){window.open(route("samplings.export-report",n),"_blank")}function pe(n){_e.visit(route("samplings.report",{sampling:n}))}function me(n){window.open(route("samplings.report",{sampling:n}),"_blank")}return ve(()=>{r.fetchSamplings(),k.fetchInvestorsSelect(),B.fetchCages()}),(n,t)=>(p(),m(S,null,[a(ce(ye),{title:"Samplings"}),a(be,{breadcrumbs:v},{default:i(()=>[l("div",Ce,[l("div",Ve,[l("div",he,[a(V,{modelValue:F.value,"onUpdate:modelValue":t[0]||(t[0]=e=>F.value=e),placeholder:"Search samplings...",onInput:ee,class:"w-64"},null,8,["modelValue"]),a(f,{onClick:Y,variant:"default",disabled:M.value},{default:i(()=>[o(g(M.value?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),a(f,{onClick:le,variant:"secondary"},{default:i(()=>t[16]||(t[16]=[o("Create Sampling")])),_:1})]),l("div",De,[l("table",$e,[t[25]||(t[25]=l("thead",{class:"bg-gray-50 dark:bg-gray-800"},[l("tr",null,[l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date Sampling"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"DOC"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage No"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Samples"),l("th",{class:"px-6 py-3"})])],-1)),l("tbody",Ue,[M.value?(p(),m("tr",Ee,t[17]||(t[17]=[l("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"Loading samplings...",-1)]))):!T.value||!Array.isArray(T.value)||T.value.length===0?(p(),m("tr",Ie,t[18]||(t[18]=[l("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"No samplings found.",-1)]))):(p(!0),m(S,{key:2},U(T.value,e=>{var j,Q;return p(),m("tr",{key:e==null?void 0:e.id},[l("td",ze,g(((j=e==null?void 0:e.investor)==null?void 0:j.name)||((Q=y.value.find(C=>C.id===(e==null?void 0:e.investor_id)))==null?void 0:Q.name)||(e==null?void 0:e.investor_id)),1),l("td",Fe,g(e==null?void 0:e.date_sampling),1),l("td",Me,g(e==null?void 0:e.doc),1),l("td",Te,g(e==null?void 0:e.cage_no),1),l("td",Ae,[l("span",qe,g((e==null?void 0:e.samples_count)||0)+" samples ",1)]),l("td",Be,[l("div",Ne,[a(f,{variant:"outline",size:"sm",onClick:C=>pe(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"View Sampling",class:"w-8 h-8 p-0"},{default:i(()=>t[19]||(t[19]=[o(" ðŸ‘ï¸ ")])),_:2},1032,["onClick","disabled"]),a(f,{variant:"outline",size:"sm",onClick:C=>de(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Generate Samples",class:"w-8 h-8 p-0"},{default:i(()=>t[20]||(t[20]=[o(" ðŸ“Š ")])),_:2},1032,["onClick","disabled"]),a(f,{variant:"outline",size:"sm",onClick:C=>me(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Print Report",class:"w-8 h-8 p-0"},{default:i(()=>t[21]||(t[21]=[o(" ðŸ–¨ï¸ ")])),_:2},1032,["onClick","disabled"]),a(f,{variant:"outline",size:"sm",onClick:C=>ue(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Export to Excel",class:"w-8 h-8 p-0"},{default:i(()=>t[22]||(t[22]=[o(" ðŸ“„ ")])),_:2},1032,["onClick","disabled"]),a(f,{variant:"secondary",size:"sm",onClick:C=>oe(e),disabled:!(e!=null&&e.id),title:"Update",class:"w-8 h-8 p-0"},{default:i(()=>t[23]||(t[23]=[o(" âœï¸ ")])),_:2},1032,["onClick","disabled"]),a(f,{variant:"destructive",size:"sm",onClick:C=>ie(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Delete",class:"w-8 h-8 p-0"},{default:i(()=>t[24]||(t[24]=[o(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"])])])])}),128))])])]),d.value?(p(),m("div",je,[l("div",Pe,[l("span",null,"Showing "+g(d.value.from)+" to "+g(d.value.to)+" of "+g(d.value.total)+" results",1)]),l("div",Ge,[a(f,{variant:"outline",size:"sm",onClick:ae,disabled:d.value.current_page===1},{default:i(()=>t[26]||(t[26]=[o(" Previous ")])),_:1},8,["disabled"]),l("div",Le,[(p(!0),m(S,null,U(Math.min(5,d.value.last_page),e=>(p(),m(S,{key:e},[e===1||e===d.value.last_page||e>=d.value.current_page-2&&e<=d.value.current_page+2?(p(),X(f,{key:0,variant:"outline",size:"sm",onClick:j=>N(e),class:xe(e===d.value.current_page?"bg-primary text-primary-foreground":"")},{default:i(()=>[o(g(e),1)]),_:2},1032,["onClick","class"])):e===d.value.current_page-3||e===d.value.current_page+3?(p(),m("span",Oe,"...")):P("",!0)],64))),128))]),a(f,{variant:"outline",size:"sm",onClick:te,disabled:d.value.current_page===d.value.last_page},{default:i(()=>t[27]||(t[27]=[o(" Next ")])),_:1},8,["disabled"])])])):P("",!0)]),a(G,{open:h.value,"onUpdate:open":t[6]||(t[6]=e=>h.value=e)},{default:i(()=>[a(H,{"as-child":""}),a(L,null,{default:i(()=>[a(O,null,{default:i(()=>[a(R,null,{default:i(()=>t[28]||(t[28]=[o("Create Sampling")])),_:1})]),_:1}),l("form",{onSubmit:Z(ne,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l("div",Re,[a(b,{for:"create-investor"},{default:i(()=>t[29]||(t[29]=[o("Investor")])),_:1}),A(l("select",{id:"create-investor","onUpdate:modelValue":t[1]||(t[1]=e=>c.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(p(!0),m(S,null,U(y.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},g(e.name),9,We))),128))],512),[[q,c.value.investor_id]])]),l("div",He,[a(b,{for:"create-date-sampling"},{default:i(()=>t[30]||(t[30]=[o("Date Sampling")])),_:1}),a(V,{id:"create-date-sampling",modelValue:c.value.date_sampling,"onUpdate:modelValue":t[2]||(t[2]=e=>c.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),l("div",Ye,[a(b,{for:"create-doc"},{default:i(()=>t[31]||(t[31]=[o("DOC")])),_:1}),a(V,{id:"create-doc",value:"Auto-generated on save",disabled:""})]),l("div",Je,[a(b,{for:"create-cage-no"},{default:i(()=>t[32]||(t[32]=[o("Cage")])),_:1}),A(l("select",{id:"create-cage-no","onUpdate:modelValue":t[3]||(t[3]=e=>c.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[33]||(t[33]=l("option",{value:"",disabled:""},"Select a cage",-1)),(p(!0),m(S,null,U($.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+g(e.id)+" â€” "+g(e.number_of_fingerlings)+" fingerlings ",9,Ke))),128))],512),[[q,c.value.cage_no,void 0,{number:!0}]])]),l("div",Qe,[a(b,{for:"create-mortality"},{default:i(()=>t[34]||(t[34]=[o("Mortality")])),_:1}),a(V,{id:"create-mortality",modelValue:c.value.mortality,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(W,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(f,{type:"button",variant:"secondary",onClick:t[5]||(t[5]=e=>h.value=!1)},{default:i(()=>t[35]||(t[35]=[o("Cancel")])),_:1}),a(f,{type:"submit",variant:"default"},{default:i(()=>t[36]||(t[36]=[o("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(G,{open:D.value,"onUpdate:open":t[8]||(t[8]=e=>D.value=e)},{default:i(()=>[a(H,{"as-child":""}),a(L,null,{default:i(()=>[a(O,null,{default:i(()=>[a(R,null,{default:i(()=>t[37]||(t[37]=[o("Delete Sampling")])),_:1})]),_:1}),t[40]||(t[40]=l("div",{class:"mt-2"},"Are you sure you want to delete this sampling?",-1)),a(W,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(f,{type:"button",variant:"secondary",onClick:t[7]||(t[7]=e=>D.value=!1)},{default:i(()=>t[38]||(t[38]=[o("Cancel")])),_:1}),a(f,{type:"button",variant:"destructive",onClick:se},{default:i(()=>t[39]||(t[39]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),s.value?(p(),X(G,{key:0,open:u.value,"onUpdate:open":t[15]||(t[15]=e=>u.value=e)},{default:i(()=>[a(H,{"as-child":""}),a(L,null,{default:i(()=>[a(O,null,{default:i(()=>[a(R,null,{default:i(()=>t[41]||(t[41]=[o("Edit Sampling")])),_:1})]),_:1}),l("form",{onSubmit:Z(re,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l("div",Xe,[a(b,{for:"edit-investor"},{default:i(()=>t[42]||(t[42]=[o("Investor")])),_:1}),A(l("select",{id:"edit-investor","onUpdate:modelValue":t[9]||(t[9]=e=>s.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(p(!0),m(S,null,U(y.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},g(e.name),9,Ze))),128))],512),[[q,s.value.investor_id]])]),l("div",et,[a(b,{for:"edit-date-sampling"},{default:i(()=>t[43]||(t[43]=[o("Date Sampling")])),_:1}),a(V,{id:"edit-date-sampling",modelValue:s.value.date_sampling,"onUpdate:modelValue":t[10]||(t[10]=e=>s.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),l("div",tt,[a(b,{for:"edit-doc"},{default:i(()=>t[44]||(t[44]=[o("DOC")])),_:1}),a(V,{id:"edit-doc",modelValue:s.value.doc,"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.doc=e),placeholder:"DOC",disabled:""},null,8,["modelValue"])]),l("div",at,[a(b,{for:"edit-cage-no"},{default:i(()=>t[45]||(t[45]=[o("Cage")])),_:1}),A(l("select",{id:"edit-cage-no","onUpdate:modelValue":t[12]||(t[12]=e=>s.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[46]||(t[46]=l("option",{value:"",disabled:""},"Select a cage",-1)),(p(!0),m(S,null,U($.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+g(e.id)+" â€” "+g(e.number_of_fingerlings)+" fingerlings ",9,lt))),128))],512),[[q,s.value.cage_no,void 0,{number:!0}]])]),l("div",nt,[a(b,{for:"edit-mortality"},{default:i(()=>t[47]||(t[47]=[o("Mortality")])),_:1}),a(V,{id:"edit-mortality",modelValue:s.value.mortality,"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(W,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(f,{type:"button",variant:"secondary",onClick:t[14]||(t[14]=e=>u.value=!1)},{default:i(()=>t[48]||(t[48]=[o("Cancel")])),_:1}),a(f,{type:"submit",variant:"default"},{default:i(()=>t[49]||(t[49]=[o("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):P("",!0)]),_:1})],64))}});export{ct as default};
