import{_ as dt}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cfv7ZBw5.js";import{r as A,d as it,c as U,x as ct,o as ut,N as gt,a as S,b as k,e as _,g as q,h as P,w as x,f as t,i as m,u as et,A as N,t as s,F as J,j as st,m as pt}from"./app-CzhniAMT.js";import{_ as K}from"./Card.vue_vue_type_script_setup_true_lang-aC5pJkwP.js";import{_ as V}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-1iHGJxcY.js";import{t as ot,l as mt,s as ht,d as Y,a as at,b as xt,f as vt,i as ft}from"./register_all_kernels-CQH9F6lb.js";import{_ as Q,a as Z,b as tt}from"./CardTitle.vue_vue_type_script_setup_true_lang-tScOHRnG.js";import{_ as nt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{_ as yt,a as bt,b as _t,c as wt}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BHnP_P35.js";import{_ as kt}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CODCzXzO.js";import"./useForwardExpose-DEh402Yc.js";import"./RovingFocusGroup-Daz5GHfr.js";let z={model:null,isLoaded:!1};async function Wt(){try{const l=await(await fetch("/models/yolo_labels.json")).json(),f=[];for(const[i,w]of Object.entries(l))if(Array.isArray(w)&&w.length>0){const u=w[0];u.width&&u.height&&f.push({width:u.width,height:u.height,x_center:u.x_center||.5,y_center:u.y_center||.5})}return console.log(`Loaded ${f.length} training samples`),f}catch(v){return console.error("Failed to load training data:",v),[]}}async function Ft(){const v=await Wt();if(v.length===0)throw new Error("No training data available");const l=v.map(p=>[p.width,p.height]),f=ot(l),i=v.map(p=>{const h=p.height*50,I=p.width*30;return[.015*Math.pow(h,2.5)*Math.pow(I,1.8)]}),w=ot(i),u=ht({layers:[Y({inputShape:[2],units:16,activation:"relu",kernelInitializer:"heNormal"}),at({rate:.2}),Y({units:32,activation:"relu",kernelInitializer:"heNormal"}),at({rate:.2}),Y({units:16,activation:"relu",kernelInitializer:"heNormal"}),Y({units:1,activation:"linear"})]});return u.compile({optimizer:xt.adam(.001),loss:"meanSquaredError",metrics:["mae"]}),console.log("Training weight prediction model..."),await u.fit(f,w,{epochs:50,batchSize:32,validationSplit:.2,shuffle:!0,callbacks:{onEpochEnd:(p,h)=>{p%10===0&&console.log(`Epoch ${p}: loss = ${h==null?void 0:h.loss.toFixed(4)}, mae = ${h==null?void 0:h.mae.toFixed(4)}`)}}}),console.log("Model training complete!"),f.dispose(),w.dispose(),u}async function rt(){if(z.model&&z.isLoaded)return z.model;try{const v=await mt("/models/weight_prediction/model.json");return z.model=v,z.isLoaded=!0,console.log("Loaded pre-trained weight prediction model"),v}catch{console.log("Creating new weight prediction model...");const l=await Ft();z.model=l,z.isLoaded=!0;try{await l.save("localstorage://weight_prediction_model"),console.log("Model saved to local storage")}catch(f){console.warn("Failed to save model:",f)}return l}}async function Dt(v,l){const f=await rt(),i=ot([[v,l]]),w=f.predict(i),u=(await w.data())[0];return i.dispose(),w.dispose(),Math.max(0,u)}function Ct(v,l,f,i){return{normalizedWidth:v/f,normalizedHeight:l/i}}function lt(v,l){const f=l/v,p=.018*Math.pow(v,2.9)*Math.pow(f,1.5);return Math.max(0,p)}const G={realLengthCm:2.54,realWidthCm:30,imageWidthPx:1200,imageLengthPx:127.13},St=3,$t=6;function At(){const v=A(!1),l=A(!1),f=A(null),i=A([]),w=async(r,D,g,$)=>{try{const n=D/G.realWidthCm*G.imageWidthPx,W=r/G.realLengthCm*G.imageLengthPx,{normalizedWidth:y,normalizedHeight:b}=Ct(n,W,g||G.imageWidthPx,$||720),C=await Dt(y,b),T=lt(r,D),R=(C+T)/2;return Math.max(0,R)}catch(n){return console.error("Weight prediction error:",n),lt(r,D)}},u=async(r,D,g,$)=>{try{const n=document.querySelector('meta[name="api-key"]'),W=(n==null?void 0:n.getAttribute("content"))||"",b=await(await fetch(`/api/weight?key=${W}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sampling_id:r,doc:D,width:g,height:$})})).json();return b.data&&b.data.weight?b.data.weight:0}catch(n){return console.error("Failed to predict weight from API:",n),0}},p=(r,D,g=G)=>{const $=D/g.imageLengthPx*g.realLengthCm,n=r/g.imageWidthPx*g.realWidthCm;return{lengthCm:$,widthCm:n}},h=r=>r<=St?"Starter":r<=$t?"Grower":"Finisher",I=async(r,D=G)=>{l.value=!0,f.value=null;try{await rt();const g=vt(r),$=ft.resizeBilinear(g,[640,640]),n=$.div(255),W=n.expandDims(0),y=r.width||r.videoWidth||1280,b=r.height||r.videoHeight||720,C=await E(r,D,y,b);return g.dispose(),$.dispose(),n.dispose(),W.dispose(),i.value=C,C}catch(g){return f.value=g instanceof Error?g.message:"Detection failed",console.error("Fish detection error:",g),[]}finally{l.value=!1}},E=async(r,D,g,$)=>{const n=document.createElement("canvas"),W=n.getContext("2d");if(!W)return[];n.width=r.width||r.videoWidth,n.height=r.height||r.videoHeight,W.drawImage(r,0,0);const b=W.getImageData(0,0,n.width,n.height).data,C=[],T=100;let R=n.width,j=n.height,o=0,e=0,a=0;for(let c=0;c<n.height;c++)for(let F=0;F<n.width;F++){const B=(c*n.width+F)*4,d=b[B],H=b[B+1],O=b[B+2];(d+H+O)/3<T&&(a++,R=Math.min(R,F),j=Math.min(j,c),o=Math.max(o,F),e=Math.max(e,c))}if(a>1e3){const c=o-R,F=e-j,{lengthCm:B,widthCm:d}=p(c,F,D),H=d/2.54,O=await w(B,d,n.width,n.height),M=h(H);C.push({boundingBox:{x:R,y:j,width:c,height:F,confidence:.85},length:B,width:d,weight:O,stage:M})}return C};return{isModelLoaded:v,isDetecting:l,error:f,detectionResults:i,detectFish:I,drawDetections:(r,D)=>{const g=r.getContext("2d");g&&D.forEach($=>{const{boundingBox:n,stage:W,length:y,width:b,weight:C}=$;let T="";switch(W){case"Starter":T="#00FF00";break;case"Grower":T="#FFFF00";break;case"Finisher":T="#FF0000";break}g.strokeStyle=T,g.lineWidth=2,g.strokeRect(n.x,n.y,n.width,n.height),g.fillStyle=T,g.font="16px Arial";const R=`Tilapia - ${W}`;g.fillText(R,n.x,n.y-10),g.font="12px Arial",g.fillText(`L: ${y.toFixed(1)}cm W: ${b.toFixed(1)}cm`,n.x,n.y+n.height+15),g.fillText(`Weight: ${C.toFixed(1)}g`,n.x,n.y+n.height+30)})},predictWeight:w,predictWeightFromAPI:u,pixelsToRealWorld:p,determineStage:h}}const Lt={class:"flex flex-col gap-4"},Tt={class:"flex gap-2"},Rt={class:"relative w-full aspect-video bg-gray-900 rounded-lg overflow-hidden"},Bt={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-900/80 text-white"},Nt={key:1,class:"absolute top-4 right-4 bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-medium animate-pulse"},It={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},Mt={class:"overflow-x-auto"},Pt={class:"min-w-full text-sm"},Et={class:"px-3 py-2"},jt={class:"px-3 py-2"},zt={class:"px-3 py-2"},Gt={class:"px-3 py-2"},Ht={class:"px-3 py-2"},Ot={class:"px-3 py-2"},Ut=it({__name:"FishDetectionCamera",props:{samplingId:{},doc:{},autoDetect:{type:Boolean}},emits:["detection","error"],setup(v,{expose:l,emit:f}){const i=v,w=f,u=A(null),p=A(null),h=A(null),I=A(!1),E=A(null),L=A(null),r=A([]),{isDetecting:D,error:g,detectFish:$,drawDetections:n}=At(),W={Starter:{bg:"bg-green-50 dark:bg-green-900/20",text:"text-green-700 dark:text-green-300",border:"border-green-300 dark:border-green-700"},Grower:{bg:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-700 dark:text-yellow-300",border:"border-yellow-300 dark:border-yellow-700"},Finisher:{bg:"bg-red-50 dark:bg-red-900/20",text:"text-red-700 dark:text-red-300",border:"border-red-300 dark:border-red-700"}},y=U(()=>L.value&&W[L.value.stage]||W.Starter),b=async()=>{try{const e={video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"}};h.value=await navigator.mediaDevices.getUserMedia(e),u.value&&(u.value.srcObject=h.value,u.value.play(),I.value=!0,await new Promise(a=>{u.value&&(u.value.onloadedmetadata=a)}),p.value&&u.value&&(p.value.width=u.value.videoWidth,p.value.height=u.value.videoHeight),i.autoDetect&&T())}catch(e){const a=e instanceof Error?e.message:"Failed to access camera";w("error",a),console.error("Camera error:",e)}},C=()=>{h.value&&(h.value.getTracks().forEach(e=>e.stop()),h.value=null),u.value&&(u.value.srcObject=null),R(),I.value=!1},T=()=>{E.value||(E.value=window.setInterval(()=>{j()},3e3))},R=()=>{E.value&&(clearInterval(E.value),E.value=null)},j=async()=>{if(!(!u.value||!p.value||D.value))try{const e=p.value.getContext("2d");e&&e.drawImage(u.value,0,0,p.value.width,p.value.height);const a=await $(u.value);if(a.length>0){const c=a[0],F={length:c.length,width:c.width,weight:c.weight,stage:c.stage,confidence:c.boundingBox.confidence,timestamp:new Date().toISOString()};L.value=F,r.value.unshift(F),r.value.length>10&&r.value.pop(),w("detection",F),n(p.value,a)}}catch(e){console.error("Detection error:",e)}},o=async()=>{await j()};return ct(g,e=>{e&&w("error",e)}),ut(()=>{i.autoDetect&&b()}),gt(()=>{C()}),l({startCamera:b,stopCamera:C,captureFrame:o,lastDetection:L,detectionHistory:r}),(e,a)=>(k(),S("div",Lt,[_(K,null,{default:x(()=>[_(Q,null,{default:x(()=>[_(Z,{class:"flex items-center justify-between"},{default:x(()=>[a[3]||(a[3]=t("span",null,"Fish Detection Camera",-1)),t("div",Tt,[I.value?(k(),q(V,{key:1,onClick:C,variant:"destructive",size:"sm"},{default:x(()=>a[1]||(a[1]=[m(" â¹ Stop Camera ")])),_:1})):(k(),q(V,{key:0,onClick:b,variant:"default",size:"sm"},{default:x(()=>a[0]||(a[0]=[m(" ðŸ“¹ Start Camera ")])),_:1})),I.value?(k(),q(V,{key:2,onClick:o,variant:"secondary",size:"sm",disabled:et(D)},{default:x(()=>a[2]||(a[2]=[m(" ðŸ“¸ Capture & Detect ")])),_:1},8,["disabled"])):P("",!0)])]),_:1})]),_:1}),_(tt,null,{default:x(()=>[t("div",Rt,[t("video",{ref_key:"videoRef",ref:u,class:"absolute inset-0 w-full h-full object-contain",autoplay:"",playsinline:"",muted:""},null,512),t("canvas",{ref_key:"canvasRef",ref:p,class:"absolute inset-0 w-full h-full object-contain pointer-events-none"},null,512),I.value?P("",!0):(k(),S("div",Bt,a[4]||(a[4]=[t("div",{class:"text-center"},[t("p",{class:"text-lg mb-2"},"ðŸ“¹ Camera is not active"),t("p",{class:"text-sm text-gray-400"},'Click "Start Camera" to begin detection')],-1)]))),et(D)?(k(),S("div",Nt," ðŸ” Detecting... ")):P("",!0)])]),_:1})]),_:1}),L.value?(k(),q(K,{key:0,class:N(y.value.bg)},{default:x(()=>[_(Q,null,{default:x(()=>[_(Z,{class:"flex items-center justify-between"},{default:x(()=>[t("span",{class:N(y.value.text)},"Latest Detection",2),t("span",{class:N(`${y.value.text} ${y.value.border} border px-3 py-1 rounded-full text-sm font-medium`)},s(L.value.stage),3)]),_:1})]),_:1}),_(tt,null,{default:x(()=>[t("div",It,[t("div",null,[t("div",{class:N(["text-sm",y.value.text])},"Length",2),t("div",{class:N(["text-2xl font-bold",y.value.text])},s(L.value.length.toFixed(1))+" cm ",3)]),t("div",null,[t("div",{class:N(["text-sm",y.value.text])},"Width",2),t("div",{class:N(["text-2xl font-bold",y.value.text])},s(L.value.width.toFixed(1))+" cm ",3)]),t("div",null,[t("div",{class:N(["text-sm",y.value.text])},"Weight",2),t("div",{class:N(["text-2xl font-bold",y.value.text])},s(L.value.weight.toFixed(1))+" g ",3)]),t("div",null,[t("div",{class:N(["text-sm",y.value.text])},"Confidence",2),t("div",{class:N(["text-2xl font-bold",y.value.text])},s((L.value.confidence*100).toFixed(0))+"% ",3)])]),t("div",{class:N(["mt-3 text-xs",y.value.text])}," Detected at: "+s(new Date(L.value.timestamp).toLocaleString()),3)]),_:1})]),_:1},8,["class"])):P("",!0),r.value.length>0?(k(),q(K,{key:1},{default:x(()=>[_(Q,null,{default:x(()=>[_(Z,null,{default:x(()=>a[5]||(a[5]=[m("Detection History")])),_:1})]),_:1}),_(tt,null,{default:x(()=>[t("div",Mt,[t("table",Pt,[a[6]||(a[6]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-3 py-2 text-left"},"Time"),t("th",{class:"px-3 py-2 text-left"},"Length (cm)"),t("th",{class:"px-3 py-2 text-left"},"Width (cm)"),t("th",{class:"px-3 py-2 text-left"},"Weight (g)"),t("th",{class:"px-3 py-2 text-left"},"Stage"),t("th",{class:"px-3 py-2 text-left"},"Confidence")])],-1)),t("tbody",null,[(k(!0),S(J,null,st(r.value,(c,F)=>(k(),S("tr",{key:F,class:"border-b border-gray-200 dark:border-gray-700"},[t("td",Et,s(new Date(c.timestamp).toLocaleTimeString()),1),t("td",jt,s(c.length.toFixed(1)),1),t("td",zt,s(c.width.toFixed(1)),1),t("td",Gt,s(c.weight.toFixed(1)),1),t("td",Ht,[t("span",{class:N(`${W[c.stage].border} ${W[c.stage].text} border px-2 py-0.5 rounded text-xs`)},s(c.stage),3)]),t("td",Ot,s((c.confidence*100).toFixed(0))+"%",1)]))),128))])])])]),_:1})]),_:1})):P("",!0)]))}}),Vt=nt(Ut,[["__scopeId","data-v-3a74c9b3"]]),Xt={class:"flex flex-col gap-6 p-4 max-w-6xl mx-auto"},qt={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-4"},Yt={class:"text-sm text-muted-foreground"},Jt={class:"font-medium"},Kt={class:"text-sm text-muted-foreground"},Qt={class:"font-medium"},Zt={class:"text-sm text-muted-foreground"},te={class:"font-medium"},ee={class:"text-sm text-muted-foreground"},se={class:"font-medium"},oe={key:0,class:"text-sm text-muted-foreground mt-2"},ae={key:1,class:"text-sm text-muted-foreground"},le={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 bg-white dark:bg-gray-900 mb-6"},ie={class:"flex gap-2"},ne={class:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},re={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},de={class:"text-lg font-bold text-blue-900 dark:text-blue-100"},ce={key:0},ue={class:"text-lg font-bold text-blue-900 dark:text-blue-100"},ge={key:1},pe={class:"text-lg font-bold text-blue-900 dark:text-blue-100"},me={class:"text-lg font-bold text-blue-900 dark:text-blue-100"},he={key:0,class:"mb-6 p-4 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800"},xe={class:"flex items-center justify-between mb-3"},ve={class:"text-xs text-purple-700 dark:text-purple-300"},fe={class:"grid grid-cols-2 md:grid-cols-3 gap-4"},ye={class:"text-lg font-bold text-purple-900 dark:text-purple-100"},be={class:"text-lg font-bold text-purple-900 dark:text-purple-100"},_e={class:"text-lg font-bold text-purple-900 dark:text-purple-100"},we={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 bg-white dark:bg-gray-900 mb-6"},ke={class:"min-w-full text-xs md:text-sm"},We={class:"px-4 py-2"},Fe={class:"px-4 py-2"},De={class:"px-4 py-2"},Ce={class:"px-4 py-2"},Se={class:"px-4 py-2"},$e={class:"px-4 py-2"},Ae={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},Le={class:"text-sm space-y-1"},Te={class:"font-medium"},Re={class:"font-medium"},Be={class:"font-medium"},Ne={class:"font-medium"},Ie={class:"font-medium"},Me={class:"font-medium"},Pe={class:"font-medium"},Ee={class:"font-medium"},je={class:"font-medium"},ze={class:"font-medium"},Ge={class:"font-medium"},He={class:"font-medium"},Oe={class:"font-medium"},Ue={class:"font-medium"},Ve={class:"font-medium"},Xe={class:"flex flex-col items-center justify-center"},qe={class:"w-full space-y-4"},Ye={class:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg"},Je={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Ke={class:"text-sm text-blue-700 dark:text-blue-300"},Qe={key:0,class:"bg-green-50 dark:bg-green-900/20 p-4 rounded-lg"},Ze={class:"text-lg font-bold text-green-600 dark:text-green-400"},ts={class:"text-sm text-green-700 dark:text-green-300"},es={class:"bg-purple-50 dark:bg-purple-900/20 p-4 rounded-lg"},ss={class:"text-lg font-bold text-purple-600 dark:text-purple-400"},os={class:"mt-8"},as={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 bg-white dark:bg-gray-900"},ls={class:"min-w-full text-xs md:text-sm"},is={class:"px-2 py-1"},ns={class:"px-2 py-1"},rs={class:"px-2 py-1"},ds={class:"px-2 py-1"},cs={class:"px-2 py-1"},us={class:"px-2 py-1"},gs={class:"px-2 py-1"},ps={class:"px-2 py-1"},ms={class:"px-2 py-1"},hs={class:"px-2 py-1"},xs={class:"px-2 py-1"},vs={class:"px-2 py-1"},fs={class:"px-2 py-1"},ys=it({__name:"SamplingReport",props:{sampling:{},cageEntry:{},samples:{},totals:{},history:{}},setup(v){var C,T,R,j;const l=v,f=o=>I(o),i=A({date:((C=l.sampling)==null?void 0:C.date)||"",investor:((T=l.sampling)==null?void 0:T.investor)||"",cageNo:((R=l.sampling)==null?void 0:R.cageNo)||"",doc:((j=l.sampling)==null?void 0:j.doc)||"",samples:l.samples||[],totals:l.totals||{totalWeight:0,totalSamples:0,avgWeight:0,totalStocks:0,mortality:0,presentStocks:0,biomass:0,feedingRate:0,dailyFeedRation:0,feedConsumption:0,prevABW:0,prevBiomass:0,totalWtGained:0,dailyWtGained:0,fcr:0},history:l.history||[]}),w=A(!1),u=A(null),p=A([]),h=o=>{if(o==null||o==="")return 0;const e=typeof o=="string"?parseFloat(o):o;return isNaN(e)?0:Math.round(e*10)/10},I=o=>{if(!o)return"-";try{const e=new Date(o);if(isNaN(e.getTime()))return"-";const a={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return e.toLocaleString("en-US",a)}catch{return"-"}},E=U(()=>[...i.value.samples||[]].sort((a,c)=>(a.sample_no||0)-(c.sample_no||0)).map(a=>({no:a.sample_no||"",weight:h(a.weight),length:a.length?h(a.length):null,width:a.width?h(a.width):null,type:r.value.type,testedAt:I(a.created_at)}))),L=U(()=>{const o=i.value.totals,e=o.avgWeight||0,a=o.prevBiomass>0?(o.biomass-o.prevBiomass)/o.prevBiomass*100:0;return{biomassPerFish:h(e).toFixed(1),biomassGrowthRate:a.toFixed(1),biomassEfficiency:o.avgWeight>0?(o.biomass/o.avgWeight*1e3).toFixed(2):"0.00"}});U(()=>{if(!l.cageEntry)return"";const o=[`No. ${l.cageEntry.cageNo}`,`weight ${l.cageEntry.weight} kg`];return l.cageEntry.length&&o.push(`length ${l.cageEntry.length} cm`),l.cageEntry.width&&o.push(`width ${l.cageEntry.width} cm`),o.push(`type: ${l.cageEntry.type||"N/A"}`),`(${o.join(", ")})`});const r=U(()=>{var H,O;const o=i.value.samples||[];if(o.length===0)return{avgWeight:0,avgLength:null,avgWidth:null,type:((H=l.cageEntry)==null?void 0:H.type)||"N/A"};const e=o.reduce((M,X)=>M+(X.weight||0),0),a=o.length>0?e/o.length:0,c=o.filter(M=>M.length!=null),F=c.length>0?c.reduce((M,X)=>M+(X.length||0),0)/c.length:null,B=o.filter(M=>M.width!=null),d=B.length>0?B.reduce((M,X)=>M+(X.width||0),0)/B.length:null;return{avgWeight:h(a),avgLength:F?h(F):null,avgWidth:d?h(d):null,type:((O=l.cageEntry)==null?void 0:O.type)||"N/A"}}),D=[{title:"Dashboard",href:"/dashboard"},{title:"Samplings",href:"/samplings"},{title:"Sampling Report",href:"/samplings/report"}],g=()=>{window.print()},$=()=>{var e;const o=(e=l.sampling)==null?void 0:e.id;o?window.open(route("samplings.export-report",o),"_blank"):window.open(route("samplings.export-report"),"_blank")},n=o=>{console.log("Fish detected:",o),p.value.unshift({length:o.length,width:o.width,weight:o.weight,stage:o.stage,timestamp:o.timestamp}),p.value.length>5&&p.value.pop()},W=o=>{console.error("Detection error:",o)},y=()=>{w.value=!0},b=U(()=>{if(p.value.length===0)return null;const o=p.value.reduce((a,c)=>({length:a.length+c.length,width:a.width+c.width,weight:a.weight+c.weight}),{length:0,width:0,weight:0}),e=p.value.length;return{length:(o.length/e).toFixed(1),width:(o.width/e).toFixed(1),weight:(o.weight/e).toFixed(1),count:e}});return(o,e)=>(k(),S(J,null,[_(et(pt),{title:"Sampling Report"}),_(dt,{breadcrumbs:D},{default:x(()=>[t("div",Xt,[_(K,{class:"p-6"},{default:x(()=>{var a,c,F,B;return[t("div",qt,[t("div",null,[e[7]||(e[7]=t("h2",{class:"text-2xl font-bold mb-1"},"Sampling Report",-1)),t("div",Yt,[e[1]||(e[1]=m("Date: ")),t("span",Jt,s(i.value.date),1)]),t("div",Kt,[e[2]||(e[2]=m("Investor: ")),t("span",Qt,s(i.value.investor),1)]),t("div",Zt,[e[3]||(e[3]=m("Cage No: ")),t("span",te,s(i.value.cageNo),1)]),t("div",ee,[e[4]||(e[4]=m("DOC: ")),t("span",se,s(i.value.doc),1)]),(a=l.sampling)!=null&&a.created_at?(k(),S("div",oe,[e[5]||(e[5]=t("span",{class:"font-medium"},"Data Entered:",-1)),m(" "+s(f(l.sampling.created_at)),1)])):P("",!0),(c=l.sampling)!=null&&c.updated_at&&((F=l.sampling)==null?void 0:F.updated_at)!==((B=l.sampling)==null?void 0:B.created_at)?(k(),S("div",ae,[e[6]||(e[6]=t("span",{class:"font-medium"},"Last Updated:",-1)),m(" "+s(f(l.sampling.updated_at)),1)])):P("",!0)])]),t("div",le,[t("div",ie,[_(V,{variant:"outline",onClick:g},{default:x(()=>e[8]||(e[8]=[m("ðŸ–¨ï¸ Print Report")])),_:1}),_(V,{variant:"secondary",onClick:$},{default:x(()=>e[9]||(e[9]=[m("ðŸ“Š Export to Excel")])),_:1}),_(yt,{open:w.value,"onUpdate:open":e[0]||(e[0]=d=>w.value=d)},{default:x(()=>[_(kt,{"as-child":""},{default:x(()=>[_(V,{variant:"default",onClick:y},{default:x(()=>e[10]||(e[10]=[m("ðŸ¤– AI Fish Detection")])),_:1})]),_:1}),_(bt,{class:"max-w-5xl max-h-[90vh] overflow-y-auto"},{default:x(()=>{var d;return[_(_t,null,{default:x(()=>[_(wt,null,{default:x(()=>e[11]||(e[11]=[m("AI-Powered Fish Detection")])),_:1})]),_:1}),_(Vt,{ref_key:"cameraRef",ref:u,"sampling-id":(d=l.sampling)==null?void 0:d.id,doc:i.value.doc,"auto-detect":!0,onDetection:n,onError:W},null,8,["sampling-id","doc"])]}),_:1})]),_:1},8,["open"])])]),t("div",ne,[e[16]||(e[16]=t("h3",{class:"font-semibold mb-3 text-blue-900 dark:text-blue-100"},"Average Data",-1)),t("div",re,[t("div",null,[e[12]||(e[12]=t("div",{class:"text-sm text-blue-700 dark:text-blue-300"},"Weight",-1)),t("div",de,s(r.value.avgWeight.toFixed(1))+" g",1)]),r.value.avgLength?(k(),S("div",ce,[e[13]||(e[13]=t("div",{class:"text-sm text-blue-700 dark:text-blue-300"},"Length",-1)),t("div",ue,s(r.value.avgLength.toFixed(1))+" cm",1)])):P("",!0),r.value.avgWidth?(k(),S("div",ge,[e[14]||(e[14]=t("div",{class:"text-sm text-blue-700 dark:text-blue-300"},"Width",-1)),t("div",pe,s(r.value.avgWidth.toFixed(1))+" cm",1)])):P("",!0),t("div",null,[e[15]||(e[15]=t("div",{class:"text-sm text-blue-700 dark:text-blue-300"},"Type",-1)),t("div",me,s(r.value.type),1)])])]),b.value?(k(),S("div",he,[t("div",xe,[e[17]||(e[17]=t("h3",{class:"font-semibold text-purple-900 dark:text-purple-100"},"ðŸ¤– AI-Predicted Averages",-1)),t("span",ve,"Based on "+s(b.value.count)+" detection(s)",1)]),t("div",fe,[t("div",null,[e[18]||(e[18]=t("div",{class:"text-sm text-purple-700 dark:text-purple-300"},"Avg Length",-1)),t("div",ye,s(b.value.length)+" cm",1)]),t("div",null,[e[19]||(e[19]=t("div",{class:"text-sm text-purple-700 dark:text-purple-300"},"Avg Width",-1)),t("div",be,s(b.value.width)+" cm",1)]),t("div",null,[e[20]||(e[20]=t("div",{class:"text-sm text-purple-700 dark:text-purple-300"},"Avg Weight",-1)),t("div",_e,s(b.value.weight)+" g",1)])])])):P("",!0),t("div",we,[t("table",ke,[e[21]||(e[21]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"No."),t("th",{class:"px-4 py-2 text-left"},"Weight (g)"),t("th",{class:"px-4 py-2 text-left"},"Length (cm)"),t("th",{class:"px-4 py-2 text-left"},"Width (cm)"),t("th",{class:"px-4 py-2 text-left"},"Type"),t("th",{class:"px-4 py-2 text-left"},"Tested At")])],-1)),t("tbody",null,[(k(!0),S(J,null,st(E.value,d=>(k(),S("tr",{key:d.no,class:"border-b border-gray-200 dark:border-gray-700"},[t("td",We,s(d.no),1),t("td",Fe,s(d.weight?d.weight.toFixed(1):""),1),t("td",De,s(d.length?d.length.toFixed(1):"-"),1),t("td",Ce,s(d.width?d.width.toFixed(1):"-"),1),t("td",Se,s(d.type),1),t("td",$e,s(d.testedAt),1)]))),128))])])]),t("div",Ae,[t("div",null,[e[37]||(e[37]=t("h3",{class:"font-semibold mb-2"},"Summary",-1)),t("ul",Le,[t("li",null,[e[22]||(e[22]=m("Total w.t. of samples: ")),t("span",Te,s(h(i.value.totals.totalWeight).toFixed(1))+" grams",1)]),t("li",null,[e[23]||(e[23]=m("Total # of samples: ")),t("span",Re,s(i.value.totals.totalSamples)+" pcs",1)]),t("li",null,[e[24]||(e[24]=m("Avg. Body Weight: ")),t("span",Be,s(h(i.value.totals.avgWeight).toFixed(1))+" grams",1)]),t("li",null,[e[25]||(e[25]=m("Total Stocks: ")),t("span",Ne,s(i.value.totals.totalStocks)+" pcs",1)]),t("li",null,[e[26]||(e[26]=m("Mortality to date: ")),t("span",Ie,s(i.value.totals.mortality)+" pcs",1)]),t("li",null,[e[27]||(e[27]=m("Present Stocks: ")),t("span",Me,s(i.value.totals.presentStocks)+" pcs",1)]),t("li",null,[e[28]||(e[28]=m("Biomass: ")),t("span",Pe,s(i.value.totals.biomass)+" kgs",1)]),t("li",null,[e[29]||(e[29]=m("Feeding Rate: ")),t("span",Ee,s(i.value.totals.feedingRate)+"%",1)]),t("li",null,[e[30]||(e[30]=m("Daily Feed Ration: ")),t("span",je,s(i.value.totals.dailyFeedRation)+" kgs",1)]),t("li",null,[e[31]||(e[31]=m("Feed Consumption: ")),t("span",ze,s(i.value.totals.feedConsumption)+" kgs",1)]),t("li",null,[e[32]||(e[32]=m("Previous ABW: ")),t("span",Ge,s(i.value.totals.prevABW)+" grams",1)]),t("li",null,[e[33]||(e[33]=m("Previous biomass: ")),t("span",He,s(i.value.totals.prevBiomass)+" kgs",1)]),t("li",null,[e[34]||(e[34]=m("Total Wt. gained: ")),t("span",Oe,s(i.value.totals.totalWtGained)+" kgs",1)]),t("li",null,[e[35]||(e[35]=m("Daily weight gained: ")),t("span",Ue,s(i.value.totals.dailyWtGained)+" grams/day",1)]),t("li",null,[e[36]||(e[36]=m("Feed Conversion Ratio: ")),t("span",Ve,s(i.value.totals.fcr),1)])])]),t("div",Xe,[e[42]||(e[42]=t("h3",{class:"font-semibold mb-2"},"Biomass Analysis",-1)),t("div",qe,[t("div",Ye,[e[38]||(e[38]=t("h4",{class:"font-medium text-blue-900 dark:text-blue-100 mb-2"},"Current Biomass",-1)),t("div",Je,s(i.value.totals.biomass)+" kg",1),t("div",Ke,s(i.value.totals.presentStocks)+" fish Ã— "+s(h(i.value.totals.avgWeight).toFixed(1))+"g avg weight ",1)]),i.value.totals.prevBiomass>0?(k(),S("div",Qe,[e[39]||(e[39]=t("h4",{class:"font-medium text-green-900 dark:text-green-100 mb-2"},"Biomass Growth",-1)),t("div",Ze," +"+s(i.value.totals.totalWtGained)+" kg ",1),t("div",ts,s(i.value.totals.dailyWtGained)+" kg/day average ",1)])):P("",!0),t("div",es,[e[40]||(e[40]=t("h4",{class:"font-medium text-purple-900 dark:text-purple-100 mb-2"},"Biomass per Fish",-1)),t("div",ss,s(L.value.biomassPerFish)+"g ",1),e[41]||(e[41]=t("div",{class:"text-sm text-purple-700 dark:text-purple-300"}," Average weight per fish ",-1))])])])]),t("div",os,[e[44]||(e[44]=t("h3",{class:"font-semibold mb-2"},"Historical Data",-1)),t("div",as,[t("table",ls,[e[43]||(e[43]=t("thead",{class:"bg-gray-50 dark:bg-gray-800"},[t("tr",null,[t("th",{class:"px-2 py-2"},"Date"),t("th",{class:"px-2 py-2"},"DOC (days)"),t("th",{class:"px-2 py-2"},"Total Stocks"),t("th",{class:"px-2 py-2"},"Mortality to date (pcs)"),t("th",{class:"px-2 py-2"},"Present Stocks (pcs)"),t("th",{class:"px-2 py-2"},"ABW (grams)"),t("th",{class:"px-2 py-2"},"Wt. Increment per day (grams)"),t("th",{class:"px-2 py-2"},"Biomass (kgs)"),t("th",{class:"px-2 py-2"},"Feeding Rate"),t("th",{class:"px-2 py-2"},"Daily Feed Ration (kgs)"),t("th",{class:"px-2 py-2"},"Feed Consumed (kgs)"),t("th",{class:"px-2 py-2"},"Total Wt. gained (kgs)"),t("th",{class:"px-2 py-2"},"FCR")])],-1)),t("tbody",null,[(k(!0),S(J,null,st(i.value.history,d=>(k(),S("tr",{key:d.date},[t("td",is,s(d.date),1),t("td",ns,s(d.doc),1),t("td",rs,s(d.stocks),1),t("td",ds,s(d.mortality),1),t("td",cs,s(d.present),1),t("td",us,s(d.abw),1),t("td",gs,s(d.wtInc),1),t("td",ps,s(d.biomass),1),t("td",ms,s(d.fr),1),t("td",hs,s(d.dfr),1),t("td",xs,s(d.feed),1),t("td",vs,s(d.totalGained),1),t("td",fs,s(d.fcr),1)]))),128))])])])])]}),_:1})])]),_:1})],64))}}),Ls=nt(ys,[["__scopeId","data-v-6b6eeb02"]]);export{Ls as default};
