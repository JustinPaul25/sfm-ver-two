import{L as me,r as x,p as M,d as fe,c as z,o as ge,a as m,b as p,e as a,u as ve,m as ce,w as i,f as l,g as Y,h as B,i as o,t as f,F as w,j as h,A as ye,k as Z,l as N,v as j,W as xe}from"./app-CE5zU-ad.js";import{_ as _e}from"./AppLayout.vue_vue_type_script_setup_true_lang-CzFhT2JJ.js";import{u as be,S as U}from"./sweetalert2.esm.all-42RuFS3C.js";import{u as we}from"./CageStore-CmrujDxS.js";import{_ as g}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Bhu0kRHH.js";import{_ as k}from"./Input.vue_vue_type_script_setup_true_lang-DI1twB9f.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-CG3lyaKX.js";import{_ as L,a as O,b as R,c as W,d as H}from"./DialogTitle.vue_vue_type_script_setup_true_lang-wnCB0a8O.js";import{_ as G}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CzbjqQo2.js";import"./useForwardExpose-CdU0PnZW.js";import"./RovingFocusGroup-DFEwQ4kQ.js";const Se=me("sampling",()=>{const b=x([]),v=x(!1),r=x(null),S=x({search:"",page:1});return{samplings:b,loading:v,error:r,filters:S,fetchSamplings:async()=>{v.value=!0,r.value=null;try{const u=await M.get(route("samplings.list"),{params:S.value});b.value=u.data.samplings}catch(u){r.value=u.message}finally{v.value=!1}},createSampling:async u=>{v.value=!0,r.value=null;try{return(await M.post(route("samplings.store"),u)).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},updateSampling:async(u,s)=>{v.value=!0,r.value=null;try{const y=await M.put(route("samplings.update",u),s);if(b.value&&b.value.data&&Array.isArray(b.value.data)){const D=b.value.data.findIndex(c=>c.id===u);D!==-1&&(b.value.data[D]=y.data.sampling)}return y.data}catch(y){throw r.value=y.message,y}finally{v.value=!1}},deleteSampling:async u=>{v.value=!0,r.value=null;try{return(await M.delete(route("samplings.destroy",u))).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},generateSamples:async u=>{v.value=!0,r.value=null;try{return(await M.post(route("samplings.generate-samples",u))).data}catch(s){throw r.value=s.message,s}finally{v.value=!1}},setFilters:u=>{S.value={...S.value,...u}}}}),ke={class:"flex flex-col gap-4 p-4"},Ce={class:"flex items-center justify-between gap-2"},Ve={class:"flex gap-2 items-center"},De={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},$e={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},he={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},Ue={key:0},Ie={key:1},Me={class:"px-6 py-4 whitespace-nowrap"},ze={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"px-6 py-4 whitespace-nowrap"},Ae={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},je={class:"px-6 py-4 whitespace-nowrap text-right"},qe={class:"flex gap-1"},Te={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Pe={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Be={class:"flex items-center space-x-2"},Le={class:"flex items-center space-x-1"},Oe={key:1,class:"px-2"},Re={class:"flex flex-col gap-2"},We=["value"],He={class:"flex flex-col gap-2"},Ge={class:"flex flex-col gap-2"},Je={class:"flex flex-col gap-2"},Ke=["value"],Qe={class:"flex flex-col gap-2"},Xe={class:"flex flex-col gap-2"},Ye=["value"],Ze={class:"flex flex-col gap-2"},et={class:"flex flex-col gap-2"},tt={class:"flex flex-col gap-2"},at=["value"],lt={class:"flex flex-col gap-2"},vt=fe({__name:"Index",setup(b){var Q;const v=[{title:"Dashboard",href:"/dashboard"},{title:"Samplings",href:"/samplings"}],r=Se(),S=be(),q=we(),E=x(""),F=z(()=>r.loading),C=x(!1),V=x(!1),I=x(null),u=x(!1),s=x(null),y=z(()=>S.investorsSelect),D=z(()=>{const n=q.cages;return(n==null?void 0:n.data)||[]}),c=x({investor_id:((Q=y.value[0])==null?void 0:Q.id)||3,date_sampling:"",doc:"",cage_no:0,mortality:0}),A=z(()=>{const n=r.samplings;return(n==null?void 0:n.data)||[]}),d=z(()=>{const n=r.samplings;return n!=null&&n.current_page?{current_page:n.current_page,last_page:n.last_page,per_page:n.per_page,total:n.total,from:n.from,to:n.to}:null});function J(){r.setFilters({search:E.value,page:1}),r.fetchSamplings()}let K;function ee(){clearTimeout(K),K=setTimeout(()=>{J()},300)}function T(n){r.setFilters({...r.filters,page:n}),r.fetchSamplings()}function te(){d.value&&d.value.current_page<d.value.last_page&&T(d.value.current_page+1)}function ae(){d.value&&d.value.current_page>1&&T(d.value.current_page-1)}function le(){var t,e;const n=((t=D.value[0])==null?void 0:t.id)??0;c.value={investor_id:((e=y.value[0])==null?void 0:e.id)||1,date_sampling:"",doc:"",cage_no:n,mortality:0},C.value=!0}async function ne(){try{await r.createSampling(c.value),await r.fetchSamplings(),C.value=!1,U.fire({icon:"success",title:"Sampling created successfully!"})}catch(n){U.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to create sampling."})}}function ie(n){I.value=n,V.value=!0}async function se(){if(I.value!==null)try{await r.deleteSampling(I.value),await r.fetchSamplings(),V.value=!1,I.value=null,U.fire({icon:"success",title:"Sampling deleted successfully!"})}catch(n){U.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to delete sampling."})}}function oe(n){s.value={...n},u.value=!0}async function re(){if(s.value&&s.value.id)try{await r.updateSampling(s.value.id,{investor_id:s.value.investor_id,date_sampling:s.value.date_sampling,cage_no:s.value.cage_no,mortality:s.value.mortality||0}),await r.fetchSamplings(),u.value=!1,s.value=null,U.fire({icon:"success",title:"Sampling updated successfully!"})}catch(n){U.fire({icon:"error",title:"Error",text:(n==null?void 0:n.message)||"Failed to update sampling."})}}function de(n){window.open(route("samplings.export-report",n),"_blank")}function ue(n){xe.visit(route("samplings.report",{sampling:n}))}function pe(n){window.open(route("samplings.report",{sampling:n}),"_blank")}return ge(()=>{r.fetchSamplings(),S.fetchInvestorsSelect(),q.fetchCages()}),(n,t)=>(p(),m(w,null,[a(ve(ce),{title:"Samplings"}),a(_e,{breadcrumbs:v},{default:i(()=>[l("div",ke,[l("div",Ce,[l("div",Ve,[a(k,{modelValue:E.value,"onUpdate:modelValue":t[0]||(t[0]=e=>E.value=e),placeholder:"Search samplings...",onInput:ee,class:"w-64"},null,8,["modelValue"]),a(g,{onClick:J,variant:"default",disabled:F.value},{default:i(()=>[o(f(F.value?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),a(g,{onClick:le,variant:"secondary"},{default:i(()=>t[16]||(t[16]=[o("Create Sampling")])),_:1})]),l("div",De,[l("table",$e,[t[24]||(t[24]=l("thead",{class:"bg-gray-50 dark:bg-gray-800"},[l("tr",null,[l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date Sampling"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"DOC"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage No"),l("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Samples"),l("th",{class:"px-6 py-3"})])],-1)),l("tbody",he,[F.value?(p(),m("tr",Ue,t[17]||(t[17]=[l("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"Loading samplings...",-1)]))):!A.value||!Array.isArray(A.value)||A.value.length===0?(p(),m("tr",Ie,t[18]||(t[18]=[l("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"No samplings found.",-1)]))):(p(!0),m(w,{key:2},h(A.value,e=>{var P,X;return p(),m("tr",{key:e==null?void 0:e.id},[l("td",Me,f(((P=e==null?void 0:e.investor)==null?void 0:P.name)||((X=y.value.find($=>$.id===(e==null?void 0:e.investor_id)))==null?void 0:X.name)||(e==null?void 0:e.investor_id)),1),l("td",ze,f(e==null?void 0:e.date_sampling),1),l("td",Ee,f(e==null?void 0:e.doc),1),l("td",Fe,f(e==null?void 0:e.cage_no),1),l("td",Ae,[l("span",Ne,f((e==null?void 0:e.samples_count)||0)+" samples ",1)]),l("td",je,[l("div",qe,[a(g,{variant:"outline",size:"sm",onClick:$=>ue(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"View Sampling",class:"w-8 h-8 p-0"},{default:i(()=>t[19]||(t[19]=[o(" ðŸ‘ï¸ ")])),_:2},1032,["onClick","disabled"]),a(g,{variant:"outline",size:"sm",onClick:$=>pe(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Print Report",class:"w-8 h-8 p-0"},{default:i(()=>t[20]||(t[20]=[o(" ðŸ–¨ï¸ ")])),_:2},1032,["onClick","disabled"]),a(g,{variant:"outline",size:"sm",onClick:$=>de(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Export to Excel",class:"w-8 h-8 p-0"},{default:i(()=>t[21]||(t[21]=[o(" ðŸ“„ ")])),_:2},1032,["onClick","disabled"]),a(g,{variant:"secondary",size:"sm",onClick:$=>oe(e),disabled:!(e!=null&&e.id),title:"Update",class:"w-8 h-8 p-0"},{default:i(()=>t[22]||(t[22]=[o(" âœï¸ ")])),_:2},1032,["onClick","disabled"]),a(g,{variant:"destructive",size:"sm",onClick:$=>ie(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Delete",class:"w-8 h-8 p-0"},{default:i(()=>t[23]||(t[23]=[o(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"])])])])}),128))])])]),d.value?(p(),m("div",Te,[l("div",Pe,[l("span",null,"Showing "+f(d.value.from)+" to "+f(d.value.to)+" of "+f(d.value.total)+" results",1)]),l("div",Be,[a(g,{variant:"outline",size:"sm",onClick:ae,disabled:d.value.current_page===1},{default:i(()=>t[25]||(t[25]=[o(" Previous ")])),_:1},8,["disabled"]),l("div",Le,[(p(!0),m(w,null,h(Math.min(5,d.value.last_page),e=>(p(),m(w,{key:e},[e===1||e===d.value.last_page||e>=d.value.current_page-2&&e<=d.value.current_page+2?(p(),Y(g,{key:0,variant:"outline",size:"sm",onClick:P=>T(e),class:ye(e===d.value.current_page?"bg-primary text-primary-foreground":"")},{default:i(()=>[o(f(e),1)]),_:2},1032,["onClick","class"])):e===d.value.current_page-3||e===d.value.current_page+3?(p(),m("span",Oe,"...")):B("",!0)],64))),128))]),a(g,{variant:"outline",size:"sm",onClick:te,disabled:d.value.current_page===d.value.last_page},{default:i(()=>t[26]||(t[26]=[o(" Next ")])),_:1},8,["disabled"])])])):B("",!0)]),a(L,{open:C.value,"onUpdate:open":t[6]||(t[6]=e=>C.value=e)},{default:i(()=>[a(G,{"as-child":""}),a(O,null,{default:i(()=>[a(R,null,{default:i(()=>[a(W,null,{default:i(()=>t[27]||(t[27]=[o("Create Sampling")])),_:1})]),_:1}),l("form",{onSubmit:Z(ne,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l("div",Re,[a(_,{for:"create-investor"},{default:i(()=>t[28]||(t[28]=[o("Investor")])),_:1}),N(l("select",{id:"create-investor","onUpdate:modelValue":t[1]||(t[1]=e=>c.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(p(!0),m(w,null,h(y.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},f(e.name),9,We))),128))],512),[[j,c.value.investor_id]])]),l("div",He,[a(_,{for:"create-date-sampling"},{default:i(()=>t[29]||(t[29]=[o("Date Sampling")])),_:1}),a(k,{id:"create-date-sampling",modelValue:c.value.date_sampling,"onUpdate:modelValue":t[2]||(t[2]=e=>c.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),l("div",Ge,[a(_,{for:"create-doc"},{default:i(()=>t[30]||(t[30]=[o("DOC")])),_:1}),a(k,{id:"create-doc",value:"Auto-generated on save",disabled:""})]),l("div",Je,[a(_,{for:"create-cage-no"},{default:i(()=>t[31]||(t[31]=[o("Cage")])),_:1}),N(l("select",{id:"create-cage-no","onUpdate:modelValue":t[3]||(t[3]=e=>c.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[32]||(t[32]=l("option",{value:"",disabled:""},"Select a cage",-1)),(p(!0),m(w,null,h(D.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+f(e.id)+" â€” "+f(e.number_of_fingerlings)+" fingerlings ",9,Ke))),128))],512),[[j,c.value.cage_no,void 0,{number:!0}]])]),l("div",Qe,[a(_,{for:"create-mortality"},{default:i(()=>t[33]||(t[33]=[o("Mortality")])),_:1}),a(k,{id:"create-mortality",modelValue:c.value.mortality,"onUpdate:modelValue":t[4]||(t[4]=e=>c.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(H,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(g,{type:"button",variant:"secondary",onClick:t[5]||(t[5]=e=>C.value=!1)},{default:i(()=>t[34]||(t[34]=[o("Cancel")])),_:1}),a(g,{type:"submit",variant:"default"},{default:i(()=>t[35]||(t[35]=[o("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(L,{open:V.value,"onUpdate:open":t[8]||(t[8]=e=>V.value=e)},{default:i(()=>[a(G,{"as-child":""}),a(O,null,{default:i(()=>[a(R,null,{default:i(()=>[a(W,null,{default:i(()=>t[36]||(t[36]=[o("Delete Sampling")])),_:1})]),_:1}),t[39]||(t[39]=l("div",{class:"mt-2"},"Are you sure you want to delete this sampling?",-1)),a(H,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(g,{type:"button",variant:"secondary",onClick:t[7]||(t[7]=e=>V.value=!1)},{default:i(()=>t[37]||(t[37]=[o("Cancel")])),_:1}),a(g,{type:"button",variant:"destructive",onClick:se},{default:i(()=>t[38]||(t[38]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),s.value?(p(),Y(L,{key:0,open:u.value,"onUpdate:open":t[15]||(t[15]=e=>u.value=e)},{default:i(()=>[a(G,{"as-child":""}),a(O,null,{default:i(()=>[a(R,null,{default:i(()=>[a(W,null,{default:i(()=>t[40]||(t[40]=[o("Edit Sampling")])),_:1})]),_:1}),l("form",{onSubmit:Z(re,["prevent"]),class:"flex flex-col gap-4 mt-2"},[l("div",Xe,[a(_,{for:"edit-investor"},{default:i(()=>t[41]||(t[41]=[o("Investor")])),_:1}),N(l("select",{id:"edit-investor","onUpdate:modelValue":t[9]||(t[9]=e=>s.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(p(!0),m(w,null,h(y.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},f(e.name),9,Ye))),128))],512),[[j,s.value.investor_id]])]),l("div",Ze,[a(_,{for:"edit-date-sampling"},{default:i(()=>t[42]||(t[42]=[o("Date Sampling")])),_:1}),a(k,{id:"edit-date-sampling",modelValue:s.value.date_sampling,"onUpdate:modelValue":t[10]||(t[10]=e=>s.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),l("div",et,[a(_,{for:"edit-doc"},{default:i(()=>t[43]||(t[43]=[o("DOC")])),_:1}),a(k,{id:"edit-doc",modelValue:s.value.doc,"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.doc=e),placeholder:"DOC",disabled:""},null,8,["modelValue"])]),l("div",tt,[a(_,{for:"edit-cage-no"},{default:i(()=>t[44]||(t[44]=[o("Cage")])),_:1}),N(l("select",{id:"edit-cage-no","onUpdate:modelValue":t[12]||(t[12]=e=>s.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[45]||(t[45]=l("option",{value:"",disabled:""},"Select a cage",-1)),(p(!0),m(w,null,h(D.value,e=>(p(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+f(e.id)+" â€” "+f(e.number_of_fingerlings)+" fingerlings ",9,at))),128))],512),[[j,s.value.cage_no,void 0,{number:!0}]])]),l("div",lt,[a(_,{for:"edit-mortality"},{default:i(()=>t[46]||(t[46]=[o("Mortality")])),_:1}),a(k,{id:"edit-mortality",modelValue:s.value.mortality,"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(H,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[a(g,{type:"button",variant:"secondary",onClick:t[14]||(t[14]=e=>u.value=!1)},{default:i(()=>t[47]||(t[47]=[o("Cancel")])),_:1}),a(g,{type:"submit",variant:"default"},{default:i(()=>t[48]||(t[48]=[o("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):B("",!0)]),_:1})],64))}});export{vt as default};
