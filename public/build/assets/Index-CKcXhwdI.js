import{G as ce,r as x,p as E,d as ye,B as xe,c as h,o as _e,a as m,b as s,e as n,u as be,m as we,w as i,f as a,g as F,h as D,i as o,t as f,F as V,j as I,A as Se,k as le,l as j,v as q,W as ke}from"./app-Py-KhCof.js";import{_ as Ce}from"./AppLayout.vue_vue_type_script_setup_true_lang-BxOgdMMd.js";import{u as Ve}from"./InvestorStore-B58BPw1g.js";import{u as he}from"./CageStore-pAxlXtPH.js";import{_ as v}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dn4fNI4e.js";import{_ as $}from"./Input.vue_vue_type_script_setup_true_lang--G0Q0eTO.js";import{_ as w}from"./Label.vue_vue_type_script_setup_true_lang-CYHA3nUU.js";import{_ as W,a as G,b as H,c as J}from"./DialogTitle.vue_vue_type_script_setup_true_lang-xkXlj1WN.js";import{_ as K}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CLfJ7BCe.js";import{_ as Q}from"./DialogFooter.vue_vue_type_script_setup_true_lang-zzOAfG-b.js";import{S as M}from"./sweetalert2.esm.all-odB5D8k1.js";import"./useForwardExpose-N3V696vC.js";import"./RovingFocusGroup-Cd9WNB1g.js";const De=ce("sampling",()=>{const S=x([]),c=x(!1),y=x(null),k=x({search:"",page:1});return{samplings:S,loading:c,error:y,filters:k,fetchSamplings:async()=>{c.value=!0,y.value=null;try{const u=await E.get(route("samplings.list"),{params:k.value});S.value=u.data.samplings}catch(u){y.value=u.message}finally{c.value=!1}},createSampling:async u=>{c.value=!0,y.value=null;try{return(await E.post(route("samplings.store"),u)).data}catch(p){throw y.value=p.message,p}finally{c.value=!1}},updateSampling:async(u,p)=>{c.value=!0,y.value=null;try{const _=await E.put(route("samplings.update",u),p);if(S.value&&S.value.data&&Array.isArray(S.value.data)){const C=S.value.data.findIndex(r=>r.id===u);C!==-1&&(S.value.data[C]=_.data.sampling)}return _.data}catch(_){throw y.value=_.message,_}finally{c.value=!1}},deleteSampling:async u=>{c.value=!0,y.value=null;try{return(await E.delete(route("samplings.destroy",u))).data}catch(p){throw y.value=p.message,p}finally{c.value=!1}},generateSamples:async u=>{c.value=!0,y.value=null;try{return(await E.post(route("samplings.generate-samples",u))).data}catch(p){throw y.value=p.message,p}finally{c.value=!1}},setFilters:u=>{k.value={...k.value,...u}}}}),$e={class:"flex flex-col gap-4 p-4"},Ue={class:"flex items-center justify-between gap-2"},Ie={class:"flex gap-2 items-center"},Me={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},ze={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ee={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},Fe={key:0},Ne={key:1},Te={class:"px-6 py-4 whitespace-nowrap"},Ae={class:"px-6 py-4 whitespace-nowrap"},je={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 whitespace-nowrap"},Be={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Le={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-600 dark:text-gray-400"},Oe={class:"flex flex-col"},Re={key:0,class:"text-xs text-gray-500 dark:text-gray-500 mt-1"},We={class:"px-6 py-4 whitespace-nowrap text-right"},Ge={class:"flex gap-1"},He={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Je={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Ke={class:"flex items-center space-x-2"},Qe={class:"flex items-center space-x-1"},Xe={key:1,class:"px-2"},Ye={class:"flex flex-col gap-2"},Ze=["value"],et={class:"flex flex-col gap-2"},tt={class:"flex flex-col gap-2"},at={class:"flex flex-col gap-2"},lt=["value"],nt={class:"flex flex-col gap-2"},it={class:"flex flex-col gap-2"},ot=["value"],st={class:"flex flex-col gap-2"},rt={class:"flex flex-col gap-2"},dt={class:"flex flex-col gap-2"},ut=["value"],pt={class:"flex flex-col gap-2"},Vt=ye({__name:"Index",setup(S){var te;const c=xe(),y=h(()=>{var l,t;return((t=(l=c.props.auth)==null?void 0:l.user)==null?void 0:t.role)||"farmer"}),k=h(()=>y.value==="investor"),X=[{title:"Dashboard",href:"/dashboard"},{title:"Samplings",href:"/samplings"}],g=De(),B=Ve(),P=he(),N=x(""),T=h(()=>g.loading),u=x(!1),p=x(!1),_=x(null),C=x(!1),r=x(null),z=h(()=>B.investorsSelect),L=h(()=>{const l=P.cages;return(l==null?void 0:l.data)||[]}),b=x({investor_id:((te=z.value[0])==null?void 0:te.id)||3,date_sampling:"",doc:"",cage_no:0,mortality:0}),A=h(()=>{const l=g.samplings;return(l==null?void 0:l.data)||[]}),d=h(()=>{const l=g.samplings;return l!=null&&l.current_page?{current_page:l.current_page,last_page:l.last_page,per_page:l.per_page,total:l.total,from:l.from,to:l.to}:null});function Y(){g.setFilters({search:N.value,page:1}),g.fetchSamplings()}let Z;function ne(){clearTimeout(Z),Z=setTimeout(()=>{Y()},300)}function O(l){g.setFilters({...g.filters,page:l}),g.fetchSamplings()}function ie(){d.value&&d.value.current_page<d.value.last_page&&O(d.value.current_page+1)}function oe(){d.value&&d.value.current_page>1&&O(d.value.current_page-1)}function se(){var t,e;const l=((t=L.value[0])==null?void 0:t.id)??0;b.value={investor_id:((e=z.value[0])==null?void 0:e.id)||1,date_sampling:"",doc:"",cage_no:l,mortality:0},u.value=!0}async function re(){try{await g.createSampling(b.value),await g.fetchSamplings(),u.value=!1,M.fire({icon:"success",title:"Sampling created successfully!"})}catch(l){M.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to create sampling."})}}function de(l){_.value=l,p.value=!0}async function ue(){if(_.value!==null)try{await g.deleteSampling(_.value),await g.fetchSamplings(),p.value=!1,_.value=null,M.fire({icon:"success",title:"Sampling deleted successfully!"})}catch(l){M.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to delete sampling."})}}function pe(l){r.value={...l},C.value=!0}async function me(){if(r.value&&r.value.id)try{await g.updateSampling(r.value.id,{investor_id:r.value.investor_id,date_sampling:r.value.date_sampling,cage_no:r.value.cage_no,mortality:r.value.mortality||0}),await g.fetchSamplings(),C.value=!1,r.value=null,M.fire({icon:"success",title:"Sampling updated successfully!"})}catch(l){M.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to update sampling."})}}function fe(l){window.open(route("samplings.export-report",l),"_blank")}function ge(l){ke.visit(route("samplings.report",{sampling:l}))}function ve(l){window.open(route("samplings.report",{sampling:l}),"_blank")}function ee(l){if(!l)return"-";try{const t=new Date(l);if(isNaN(t.getTime()))return"-";const e={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"2-digit",hour12:!0};return t.toLocaleString("en-US",e)}catch{return"-"}}return _e(()=>{g.fetchSamplings(),B.fetchInvestorsSelect(),P.fetchCages()}),(l,t)=>(s(),m(V,null,[n(be(we),{title:"Samplings"}),n(Ce,{breadcrumbs:X},{default:i(()=>[a("div",$e,[a("div",Ue,[a("div",Ie,[n($,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),placeholder:"Search samplings...",onInput:ne,class:"w-64"},null,8,["modelValue"]),n(v,{onClick:Y,variant:"default",disabled:T.value},{default:i(()=>[o(f(T.value?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),k.value?D("",!0):(s(),F(v,{key:0,onClick:se,variant:"secondary"},{default:i(()=>t[16]||(t[16]=[o("Create Sampling")])),_:1}))]),a("div",Me,[a("table",ze,[t[25]||(t[25]=a("thead",{class:"bg-gray-50 dark:bg-gray-800"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date Sampling"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"DOC"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage No"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Samples"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Timestamp"),a("th",{class:"px-6 py-3"})])],-1)),a("tbody",Ee,[T.value?(s(),m("tr",Fe,t[17]||(t[17]=[a("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-500"},"Loading samplings...",-1)]))):!A.value||!Array.isArray(A.value)||A.value.length===0?(s(),m("tr",Ne,t[18]||(t[18]=[a("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-500"},"No samplings found.",-1)]))):(s(!0),m(V,{key:2},I(A.value,e=>{var R,ae;return s(),m("tr",{key:e==null?void 0:e.id},[a("td",Te,f(((R=e==null?void 0:e.investor)==null?void 0:R.name)||((ae=z.value.find(U=>U.id===(e==null?void 0:e.investor_id)))==null?void 0:ae.name)||(e==null?void 0:e.investor_id)),1),a("td",Ae,f(e==null?void 0:e.date_sampling),1),a("td",je,f(e==null?void 0:e.doc),1),a("td",qe,f(e==null?void 0:e.cage_no),1),a("td",Be,[a("span",Pe,f((e==null?void 0:e.samples_count)||0)+" samples ",1)]),a("td",Le,[a("div",Oe,[t[19]||(t[19]=a("span",{class:"font-medium"},"Created:",-1)),a("span",null,f(ee(e==null?void 0:e.created_at)),1),e!=null&&e.updated_at&&(e==null?void 0:e.updated_at)!==(e==null?void 0:e.created_at)?(s(),m("span",Re," Updated: "+f(ee(e==null?void 0:e.updated_at)),1)):D("",!0)])]),a("td",We,[a("div",Ge,[n(v,{variant:"outline",size:"sm",onClick:U=>ge(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"View Sampling",class:"w-8 h-8 p-0"},{default:i(()=>t[20]||(t[20]=[o(" ðŸ‘ï¸ ")])),_:2},1032,["onClick","disabled"]),n(v,{variant:"outline",size:"sm",onClick:U=>ve(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Print Report",class:"w-8 h-8 p-0"},{default:i(()=>t[21]||(t[21]=[o(" ðŸ–¨ï¸ ")])),_:2},1032,["onClick","disabled"]),n(v,{variant:"outline",size:"sm",onClick:U=>fe(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Export to Excel",class:"w-8 h-8 p-0"},{default:i(()=>t[22]||(t[22]=[o(" ðŸ“„ ")])),_:2},1032,["onClick","disabled"]),k.value?D("",!0):(s(),F(v,{key:0,variant:"secondary",size:"sm",onClick:U=>pe(e),disabled:!(e!=null&&e.id),title:"Update",class:"w-8 h-8 p-0"},{default:i(()=>t[23]||(t[23]=[o(" âœï¸ ")])),_:2},1032,["onClick","disabled"])),k.value?D("",!0):(s(),F(v,{key:1,variant:"destructive",size:"sm",onClick:U=>de(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Delete",class:"w-8 h-8 p-0"},{default:i(()=>t[24]||(t[24]=[o(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"]))])])])}),128))])])]),d.value?(s(),m("div",He,[a("div",Je,[a("span",null,"Showing "+f(d.value.from)+" to "+f(d.value.to)+" of "+f(d.value.total)+" results",1)]),a("div",Ke,[n(v,{variant:"outline",size:"sm",onClick:oe,disabled:d.value.current_page===1},{default:i(()=>t[26]||(t[26]=[o(" Previous ")])),_:1},8,["disabled"]),a("div",Qe,[(s(!0),m(V,null,I(Math.min(5,d.value.last_page),e=>(s(),m(V,{key:e},[e===1||e===d.value.last_page||e>=d.value.current_page-2&&e<=d.value.current_page+2?(s(),F(v,{key:0,variant:"outline",size:"sm",onClick:R=>O(e),class:Se(e===d.value.current_page?"bg-primary text-primary-foreground":"")},{default:i(()=>[o(f(e),1)]),_:2},1032,["onClick","class"])):e===d.value.current_page-3||e===d.value.current_page+3?(s(),m("span",Xe,"...")):D("",!0)],64))),128))]),n(v,{variant:"outline",size:"sm",onClick:ie,disabled:d.value.current_page===d.value.last_page},{default:i(()=>t[27]||(t[27]=[o(" Next ")])),_:1},8,["disabled"])])])):D("",!0)]),n(W,{open:u.value,"onUpdate:open":t[6]||(t[6]=e=>u.value=e)},{default:i(()=>[n(K,{"as-child":""}),n(G,null,{default:i(()=>[n(H,null,{default:i(()=>[n(J,null,{default:i(()=>t[28]||(t[28]=[o("Create Sampling")])),_:1})]),_:1}),a("form",{onSubmit:le(re,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",Ye,[n(w,{for:"create-investor"},{default:i(()=>t[29]||(t[29]=[o("Investor")])),_:1}),j(a("select",{id:"create-investor","onUpdate:modelValue":t[1]||(t[1]=e=>b.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(s(!0),m(V,null,I(z.value,e=>(s(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},f(e.name),9,Ze))),128))],512),[[q,b.value.investor_id]])]),a("div",et,[n(w,{for:"create-date-sampling"},{default:i(()=>t[30]||(t[30]=[o("Date Sampling")])),_:1}),n($,{id:"create-date-sampling",modelValue:b.value.date_sampling,"onUpdate:modelValue":t[2]||(t[2]=e=>b.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),a("div",tt,[n(w,{for:"create-doc"},{default:i(()=>t[31]||(t[31]=[o("DOC")])),_:1}),n($,{id:"create-doc",value:"Auto-generated on save",disabled:""})]),a("div",at,[n(w,{for:"create-cage-no"},{default:i(()=>t[32]||(t[32]=[o("Cage")])),_:1}),j(a("select",{id:"create-cage-no","onUpdate:modelValue":t[3]||(t[3]=e=>b.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[33]||(t[33]=a("option",{value:"",disabled:""},"Select a cage",-1)),(s(!0),m(V,null,I(L.value,e=>(s(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+f(e.id)+" â€” "+f(e.number_of_fingerlings)+" fingerlings ",9,lt))),128))],512),[[q,b.value.cage_no,void 0,{number:!0}]])]),a("div",nt,[n(w,{for:"create-mortality"},{default:i(()=>t[34]||(t[34]=[o("Mortality")])),_:1}),n($,{id:"create-mortality",modelValue:b.value.mortality,"onUpdate:modelValue":t[4]||(t[4]=e=>b.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),n(Q,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[n(v,{type:"button",variant:"secondary",onClick:t[5]||(t[5]=e=>u.value=!1)},{default:i(()=>t[35]||(t[35]=[o("Cancel")])),_:1}),n(v,{type:"submit",variant:"default"},{default:i(()=>t[36]||(t[36]=[o("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),n(W,{open:p.value,"onUpdate:open":t[8]||(t[8]=e=>p.value=e)},{default:i(()=>[n(K,{"as-child":""}),n(G,null,{default:i(()=>[n(H,null,{default:i(()=>[n(J,null,{default:i(()=>t[37]||(t[37]=[o("Delete Sampling")])),_:1})]),_:1}),t[40]||(t[40]=a("div",{class:"mt-2"},"Are you sure you want to delete this sampling?",-1)),n(Q,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[n(v,{type:"button",variant:"secondary",onClick:t[7]||(t[7]=e=>p.value=!1)},{default:i(()=>t[38]||(t[38]=[o("Cancel")])),_:1}),n(v,{type:"button",variant:"destructive",onClick:ue},{default:i(()=>t[39]||(t[39]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),r.value?(s(),F(W,{key:0,open:C.value,"onUpdate:open":t[15]||(t[15]=e=>C.value=e)},{default:i(()=>[n(K,{"as-child":""}),n(G,null,{default:i(()=>[n(H,null,{default:i(()=>[n(J,null,{default:i(()=>t[41]||(t[41]=[o("Edit Sampling")])),_:1})]),_:1}),a("form",{onSubmit:le(me,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",it,[n(w,{for:"edit-investor"},{default:i(()=>t[42]||(t[42]=[o("Investor")])),_:1}),j(a("select",{id:"edit-investor","onUpdate:modelValue":t[9]||(t[9]=e=>r.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(s(!0),m(V,null,I(z.value,e=>(s(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},f(e.name),9,ot))),128))],512),[[q,r.value.investor_id]])]),a("div",st,[n(w,{for:"edit-date-sampling"},{default:i(()=>t[43]||(t[43]=[o("Date Sampling")])),_:1}),n($,{id:"edit-date-sampling",modelValue:r.value.date_sampling,"onUpdate:modelValue":t[10]||(t[10]=e=>r.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),a("div",rt,[n(w,{for:"edit-doc"},{default:i(()=>t[44]||(t[44]=[o("DOC")])),_:1}),n($,{id:"edit-doc",modelValue:r.value.doc,"onUpdate:modelValue":t[11]||(t[11]=e=>r.value.doc=e),placeholder:"DOC",disabled:""},null,8,["modelValue"])]),a("div",dt,[n(w,{for:"edit-cage-no"},{default:i(()=>t[45]||(t[45]=[o("Cage")])),_:1}),j(a("select",{id:"edit-cage-no","onUpdate:modelValue":t[12]||(t[12]=e=>r.value.cage_no=e),class:"input w-full rounded border p-2",required:""},[t[46]||(t[46]=a("option",{value:"",disabled:""},"Select a cage",-1)),(s(!0),m(V,null,I(L.value,e=>(s(),m("option",{key:e.id,value:e.id,class:"bg-background text-foreground"}," Cage #"+f(e.id)+" â€” "+f(e.number_of_fingerlings)+" fingerlings ",9,ut))),128))],512),[[q,r.value.cage_no,void 0,{number:!0}]])]),a("div",pt,[n(w,{for:"edit-mortality"},{default:i(()=>t[47]||(t[47]=[o("Mortality")])),_:1}),n($,{id:"edit-mortality",modelValue:r.value.mortality,"onUpdate:modelValue":t[13]||(t[13]=e=>r.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),n(Q,{class:"flex justify-end gap-2 mt-4"},{default:i(()=>[n(v,{type:"button",variant:"secondary",onClick:t[14]||(t[14]=e=>C.value=!1)},{default:i(()=>t[48]||(t[48]=[o("Cancel")])),_:1}),n(v,{type:"submit",variant:"default"},{default:i(()=>t[49]||(t[49]=[o("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):D("",!0)]),_:1})],64))}});export{Vt as default};
