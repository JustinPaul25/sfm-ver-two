import{d as oe,r as h,c as H,o as se,a as p,b as m,e as s,u as R,m as ie,w as i,f as t,g as q,h as D,t as d,W as N,i as u,F as x,j,k as de,l as Y,v as ue,n as re,p as A}from"./app-Py-KhCof.js";import{_ as me}from"./AppLayout.vue_vue_type_script_setup_true_lang-BxOgdMMd.js";import{_ as M}from"./Card.vue_vue_type_script_setup_true_lang-GpF-q2cn.js";import{_}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-Dn4fNI4e.js";import{_ as U}from"./Input.vue_vue_type_script_setup_true_lang--G0Q0eTO.js";import{_ as V}from"./Label.vue_vue_type_script_setup_true_lang-CYHA3nUU.js";import"./useForwardExpose-N3V696vC.js";import"./RovingFocusGroup-Cd9WNB1g.js";const fe={class:"flex flex-col gap-6 p-4 max-w-6xl mx-auto"},_e={class:"flex flex-col md:flex-row md:items-center md:justify-between gap-4"},ge={class:"text-sm text-muted-foreground"},ce={class:"text-sm text-muted-foreground"},ve={class:"flex gap-2"},pe={class:"flex items-start justify-between mb-4"},ye={class:"text-xl font-semibold mb-1"},he={class:"flex gap-2 flex-wrap"},be={class:"grid grid-cols-1 md:grid-cols-2 gap-6"},xe={class:"space-y-2"},Se={class:"text-muted-foreground"},we={class:"font-mono font-medium"},ke={class:"space-y-2"},$e={class:"text-muted-foreground"},Fe={class:"font-medium"},Ce={class:"border-t pt-2 mt-2"},Te={class:"flex justify-between font-semibold"},De={key:0,class:"mt-4 p-3 bg-gray-50 rounded-lg"},Ne={class:"text-sm text-muted-foreground"},je={class:"flex items-center justify-between mb-6"},Ae={class:"text-xl font-semibold"},Ve={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},qe=["value"],Me={class:"space-y-4"},Ee={class:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"},Ue={class:"p-4 bg-blue-50 rounded-lg"},We={class:"flex justify-between items-center"},ze={class:"text-xl font-bold text-blue-600"},Be={class:"flex gap-2 justify-end"},Le={class:"space-y-3"},Pe={class:"font-medium"},Ge={class:"text-sm text-muted-foreground"},Oe={class:"flex gap-2"},Ze=oe({__name:"FeedingSchedule",props:{cage:{},schedules:{},activeSchedule:{}},setup(I){var P,G;const E=I,y=h(E.cage),W=h(E.schedules||[]),c=h(E.activeSchedule),v=h(!1),S=h(!1),b=h(null),n=h({schedule_name:"",feeding_time_1:"",feeding_time_2:"",feeding_time_3:"",feeding_time_4:"",feeding_amount_1:"",feeding_amount_2:"",feeding_amount_3:"",feeding_amount_4:"",frequency:"daily",notes:""}),J=[{value:"daily",label:"Once Daily"},{value:"twice_daily",label:"Twice Daily"},{value:"thrice_daily",label:"Three Times Daily"},{value:"four_times_daily",label:"Four Times Daily"}],K=[{title:"Dashboard",href:"/dashboard"},{title:"Cages",href:"/cages"},{title:"Feeding Schedules",href:"/cages/feeding-schedules"},{title:((G=(P=y.value)==null?void 0:P.investor)==null?void 0:G.name)||"Cage Schedule",href:"#"}],Q=H(()=>[parseFloat(n.value.feeding_amount_1)||0,parseFloat(n.value.feeding_amount_2)||0,parseFloat(n.value.feeding_amount_3)||0,parseFloat(n.value.feeding_amount_4)||0].reduce((e,f)=>e+f,0).toFixed(2)),z=H(()=>n.value.schedule_name.trim()!==""&&(n.value.feeding_time_1||n.value.feeding_time_2||n.value.feeding_time_3||n.value.feeding_time_4)),B=()=>{n.value={schedule_name:"",feeding_time_1:"",feeding_time_2:"",feeding_time_3:"",feeding_time_4:"",feeding_amount_1:"",feeding_amount_2:"",feeding_amount_3:"",feeding_amount_4:"",frequency:"daily",notes:""},b.value=null},w=(a=null)=>{var e,f,r,l;a?(b.value=a,n.value={schedule_name:a.schedule_name,feeding_time_1:a.feeding_time_1||"",feeding_time_2:a.feeding_time_2||"",feeding_time_3:a.feeding_time_3||"",feeding_time_4:a.feeding_time_4||"",feeding_amount_1:((e=a.feeding_amount_1)==null?void 0:e.toString())||"",feeding_amount_2:((f=a.feeding_amount_2)==null?void 0:f.toString())||"",feeding_amount_3:((r=a.feeding_amount_3)==null?void 0:r.toString())||"",feeding_amount_4:((l=a.feeding_amount_4)==null?void 0:l.toString())||"",frequency:a.frequency,notes:a.notes||""}):B(),S.value=!0},L=()=>{S.value=!1,B()},X=async()=>{if(z.value){v.value=!0;try{const a={cage_id:y.value.id,...n.value,feeding_amount_1:parseFloat(n.value.feeding_amount_1)||0,feeding_amount_2:parseFloat(n.value.feeding_amount_2)||0,feeding_amount_3:parseFloat(n.value.feeding_amount_3)||0,feeding_amount_4:parseFloat(n.value.feeding_amount_4)||0};b.value?await A.put(`/cages/feeding-schedules/${b.value.id}`,a):await A.post("/cages/feeding-schedules",a),N.reload()}catch(a){console.error("Error saving schedule:",a)}finally{v.value=!1}}},Z=async a=>{if(confirm("Are you sure you want to delete this schedule?")){v.value=!0;try{await A.delete(`/cages/feeding-schedules/${a}`),N.reload()}catch(e){console.error("Error deleting schedule:",e)}finally{v.value=!1}}},ee=async a=>{v.value=!0;try{await A.post(`/cages/feeding-schedules/${a}/activate`),N.reload()}catch(e){console.error("Error activating schedule:",e)}finally{v.value=!1}},te=a=>{if(!a)return"â€“";const[e,f]=a.split(":").map(Number),r=e>=12?"PM":"AM";return`${e%12||12}:${f.toString().padStart(2,"0")} ${r}`},le=()=>{var k,$,F;const a=c.value,e=y.value;if(!a||!e)return;const r=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"].map(C=>`
    <tr>
      <td class="day">${C}</td>
      ${(a.feeding_times||[]).map((T,ae)=>{const O=(a.feeding_amounts||[])[ae];return`<td>${te(T)}</td><td>${O!=null?Number(O).toFixed(2):"0.00"} kg</td>`}).join("")}
      <td class="total">${Number(a.total_daily_amount||0).toFixed(2)} kg</td>
    </tr>`).join(""),l=(a.feeding_times||[]).map((C,T)=>`<th colspan="2">Feeding ${T+1}</th>`).join(""),o=`
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Weekly Feeding Schedule - Cage #${e.id}</title>
  <style>
    body { font-family: system-ui, sans-serif; padding: 24px; color: #111; max-width: 900px; margin: 0 auto; }
    h1 { font-size: 1.5rem; margin-bottom: 0.25rem; }
    .sub { color: #666; font-size: 0.9rem; margin-bottom: 1.5rem; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; }
    th, td { border: 1px solid #ccc; padding: 8px 10px; text-align: left; }
    th { background: #f5f5f5; font-weight: 600; }
    .day { font-weight: 500; width: 120px; }
    .total { font-weight: 600; background: #f0f9ff; }
    td:not(.day):not(.total) { text-align: center; }
  </style>
</head>
<body>
  <h1>Weekly Feeding Schedule</h1>
  <p class="sub">${((k=e.investor)==null?void 0:k.name)||"Cage"} â€“ Cage #${e.id} â€¢ ${($=e.number_of_fingerlings)==null?void 0:$.toLocaleString()} fish â€¢ ${((F=e.feedType)==null?void 0:F.feed_type)||"N/A"}</p>
  <p class="sub"><strong>Schedule:</strong> ${a.schedule_name} â€¢ Total daily: ${Number(a.total_daily_amount||0).toFixed(2)} kg</p>
  <table>
    <thead>
      <tr>
        <th>Day</th>
        ${l}
        <th>Total (kg)</th>
      </tr>
    </thead>
    <tbody>
      ${r}
    </tbody>
  </table>
  <p style="margin-top: 1.5rem; font-size: 0.85rem; color: #666;">Generated on ${new Date().toLocaleString()} â€¢ Smart Fish Morphometrics</p>
</body>
</html>`,g=window.open("","_blank");g&&(g.document.write(o),g.document.close(),g.focus(),g.onload=()=>{g.print(),g.onafterprint=()=>g.close()})},ne=async()=>{var a,e,f;if(confirm("This will replace the current schedule with an auto-generated one. Continue?")){v.value=!0;try{const r=await A.post("/cages/feeding-schedules/auto-generate",{cage_ids:[(a=y.value)==null?void 0:a.id],overwrite_existing:!0});r.data.generated_schedules.length>0?(alert("Schedule auto-generated successfully!"),N.reload()):alert("Failed to generate schedule: "+r.data.errors.join(", "))}catch(r){console.error("Auto-generation failed:",r),alert("Failed to auto-generate schedule: "+(((f=(e=r.response)==null?void 0:e.data)==null?void 0:f.message)||r.message))}finally{v.value=!1}}};return se(()=>{c.value||w()}),(a,e)=>{var f,r;return m(),p(x,null,[s(R(ie),{title:`Feeding Schedule - ${((r=(f=y.value)==null?void 0:f.investor)==null?void 0:r.name)||"Cage"}`},null,8,["title"]),s(me,{breadcrumbs:K},{default:i(()=>[t("div",fe,[s(M,{class:"p-6"},{default:i(()=>{var l,o,g,k,$,F,C;return[t("div",_e,[t("div",null,[e[7]||(e[7]=t("h2",{class:"text-2xl font-bold mb-1"},"Feeding Schedule",-1)),t("div",ge,d((o=(l=y.value)==null?void 0:l.investor)==null?void 0:o.name)+" - Cage #"+d((g=y.value)==null?void 0:g.id),1),t("div",ce,d(($=(k=y.value)==null?void 0:k.number_of_fingerlings)==null?void 0:$.toLocaleString())+" fish â€¢ "+d((C=(F=y.value)==null?void 0:F.feedType)==null?void 0:C.feed_type),1)]),t("div",ve,[s(_,{variant:"outline",onClick:e[0]||(e[0]=T=>R(N).visit("/cages/feeding-schedules"))},{default:i(()=>e[8]||(e[8]=[u(" â† Back to All Schedules ")])),_:1}),S.value?D("",!0):(m(),q(_,{key:0,onClick:e[1]||(e[1]=T=>w())},{default:i(()=>e[9]||(e[9]=[u(" âž• New Schedule ")])),_:1}))])])]}),_:1}),c.value&&!S.value?(m(),q(M,{key:0,class:"p-6"},{default:i(()=>[t("div",pe,[t("div",null,[t("h3",ye,d(c.value.schedule_name),1),e[10]||(e[10]=t("span",{class:"inline-block bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium"}," Active Schedule ",-1))]),t("div",he,[s(_,{variant:"outline",onClick:e[2]||(e[2]=l=>w(c.value))},{default:i(()=>e[11]||(e[11]=[u(" âœï¸ Edit ")])),_:1}),s(_,{variant:"outline",onClick:e[3]||(e[3]=l=>w())},{default:i(()=>e[12]||(e[12]=[u(" âž• New Schedule ")])),_:1}),s(_,{variant:"outline",onClick:le,class:"bg-amber-50 text-amber-800 hover:bg-amber-100"},{default:i(()=>e[13]||(e[13]=[u(" ðŸ–¨ï¸ Print Weekly Schedule ")])),_:1}),s(_,{variant:"outline",onClick:ne,class:"bg-blue-50 text-blue-700 hover:bg-blue-100"},{default:i(()=>e[14]||(e[14]=[u(" ðŸš€ Auto-Generate ")])),_:1})])]),t("div",be,[t("div",null,[e[15]||(e[15]=t("h4",{class:"font-medium mb-3"},"Feeding Times",-1)),t("div",xe,[(m(!0),p(x,null,j(c.value.feeding_times,(l,o)=>(m(),p("div",{key:o,class:"flex justify-between"},[t("span",Se,"Feeding "+d(o+1)+":",1),t("span",we,d(l),1)]))),128))])]),t("div",null,[e[17]||(e[17]=t("h4",{class:"font-medium mb-3"},"Feeding Amounts",-1)),t("div",ke,[(m(!0),p(x,null,j(c.value.feeding_amounts,(l,o)=>(m(),p("div",{key:o,class:"flex justify-between"},[t("span",$e,"Amount "+d(o+1)+":",1),t("span",Fe,d(l)+" kg",1)]))),128)),t("div",Ce,[t("div",Te,[e[16]||(e[16]=t("span",null,"Total Daily:",-1)),t("span",null,d(c.value.total_daily_amount)+" kg",1)])])])])]),c.value.notes?(m(),p("div",De,[e[18]||(e[18]=t("h4",{class:"font-medium mb-1"},"Notes",-1)),t("p",Ne,d(c.value.notes),1)])):D("",!0)]),_:1})):D("",!0),S.value?(m(),q(M,{key:1,class:"p-6"},{default:i(()=>[t("div",je,[t("h3",Ae,d(b.value?"Edit Schedule":"Create New Schedule"),1),s(_,{variant:"outline",onClick:L},{default:i(()=>e[19]||(e[19]=[u("âœ• Cancel")])),_:1})]),t("form",{onSubmit:de(X,["prevent"]),class:"space-y-6"},[t("div",Ve,[t("div",null,[s(V,{for:"schedule_name"},{default:i(()=>e[20]||(e[20]=[u("Schedule Name")])),_:1}),s(U,{id:"schedule_name",modelValue:n.value.schedule_name,"onUpdate:modelValue":e[4]||(e[4]=l=>n.value.schedule_name=l),placeholder:"e.g., Morning Schedule",required:""},null,8,["modelValue"])]),t("div",null,[s(V,{for:"frequency"},{default:i(()=>e[21]||(e[21]=[u("Frequency")])),_:1}),Y(t("select",{id:"frequency","onUpdate:modelValue":e[5]||(e[5]=l=>n.value.frequency=l),class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"},[(m(),p(x,null,j(J,l=>t("option",{key:l.value,value:l.value},d(l.label),9,qe)),64))],512),[[ue,n.value.frequency]])])]),t("div",Me,[e[23]||(e[23]=t("h4",{class:"font-medium"},"Feeding Schedule",-1)),t("div",Ee,[(m(),p(x,null,j(4,l=>t("div",{key:l,class:"space-y-2"},[s(V,{for:`feeding_time_${l}`},{default:i(()=>[u("Feeding "+d(l)+" Time",1)]),_:2},1032,["for"]),s(U,{id:`feeding_time_${l}`,"model-value":l===1?n.value.feeding_time_1:l===2?n.value.feeding_time_2:l===3?n.value.feeding_time_3:n.value.feeding_time_4,"onUpdate:modelValue":o=>{l===1?n.value.feeding_time_1=o:l===2?n.value.feeding_time_2=o:l===3?n.value.feeding_time_3=o:n.value.feeding_time_4=o},type:"time",placeholder:`${8+(l-1)*4}:00`},null,8,["id","model-value","onUpdate:modelValue","placeholder"]),s(V,{for:`feeding_amount_${l}`},{default:i(()=>e[22]||(e[22]=[u("Amount (kg)")])),_:2},1032,["for"]),s(U,{id:`feeding_amount_${l}`,"model-value":l===1?n.value.feeding_amount_1:l===2?n.value.feeding_amount_2:l===3?n.value.feeding_amount_3:n.value.feeding_amount_4,"onUpdate:modelValue":o=>{l===1?n.value.feeding_amount_1=o:l===2?n.value.feeding_amount_2=o:l===3?n.value.feeding_amount_3=o:n.value.feeding_amount_4=o},type:"number",step:"0.01",min:"0",placeholder:"0.00"},null,8,["id","model-value","onUpdate:modelValue"])])),64))])]),t("div",Ue,[t("div",We,[e[24]||(e[24]=t("span",{class:"font-medium"},"Total Daily Amount:",-1)),t("span",ze,d(Q.value)+" kg",1)])]),t("div",null,[s(V,{for:"notes"},{default:i(()=>e[25]||(e[25]=[u("Notes")])),_:1}),Y(t("textarea",{id:"notes","onUpdate:modelValue":e[6]||(e[6]=l=>n.value.notes=l),rows:"3",class:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Any additional notes about this feeding schedule..."},null,512),[[re,n.value.notes]])]),t("div",Be,[s(_,{type:"button",variant:"outline",onClick:L},{default:i(()=>e[26]||(e[26]=[u(" Cancel ")])),_:1}),s(_,{type:"submit",disabled:!z.value||v.value},{default:i(()=>[u(d(v.value?"Saving...":b.value?"Update Schedule":"Create Schedule"),1)]),_:1},8,["disabled"])])],32)]),_:1})):D("",!0),W.value.length>1?(m(),q(M,{key:2,class:"p-6"},{default:i(()=>[e[30]||(e[30]=t("h3",{class:"text-xl font-semibold mb-4"},"Schedule History",-1)),t("div",Le,[(m(!0),p(x,null,j(W.value.filter(l=>!l.is_active),l=>(m(),p("div",{key:l.id,class:"flex items-center justify-between p-4 border rounded-lg"},[t("div",null,[t("h4",Pe,d(l.schedule_name),1),t("p",Ge," Created "+d(new Date(l.created_at).toLocaleDateString()),1)]),t("div",Oe,[s(_,{variant:"outline",size:"sm",onClick:o=>ee(l.id)},{default:i(()=>e[27]||(e[27]=[u(" Activate ")])),_:2},1032,["onClick"]),s(_,{variant:"outline",size:"sm",onClick:o=>w(l)},{default:i(()=>e[28]||(e[28]=[u(" Edit ")])),_:2},1032,["onClick"]),s(_,{variant:"outline",size:"sm",onClick:o=>Z(l.id)},{default:i(()=>e[29]||(e[29]=[u(" Delete ")])),_:2},1032,["onClick"])])]))),128))])]),_:1})):D("",!0)])]),_:1})],64)}}});export{Ze as default};
