import{d as xe,B as ge,c as T,r as v,o as ye,a as x,b as p,e as l,u as _e,m as be,w as s,f as a,g as Y,h as F,i as n,t as d,l as B,C as we,v as M,F as I,j as L,A as K,k as Z,p as k}from"./app-CzhniAMT.js";import{_ as ke}from"./AppLayout.vue_vue_type_script_setup_true_lang-Cfv7ZBw5.js";import{_ as f}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-1iHGJxcY.js";import{_}from"./Input.vue_vue_type_script_setup_true_lang-DoOMrtD2.js";import{_ as G,a as H,b as J,c as O}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BHnP_P35.js";import{_ as Q}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-CODCzXzO.js";import{_ as W}from"./DialogFooter.vue_vue_type_script_setup_true_lang-DjHRfOq4.js";import{_ as C}from"./Card.vue_vue_type_script_setup_true_lang-aC5pJkwP.js";import{_ as U,a as V,b as $}from"./CardTitle.vue_vue_type_script_setup_true_lang-tScOHRnG.js";import{S as y}from"./sweetalert2.esm.all-odB5D8k1.js";import"./useForwardExpose-DEh402Yc.js";import"./RovingFocusGroup-Daz5GHfr.js";const Ce={class:"flex flex-col gap-4 p-4"},Ue={key:0,class:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4"},Ve={class:"text-2xl font-bold"},$e={class:"text-2xl font-bold text-green-600"},Ee={class:"text-2xl font-bold text-red-600"},Se={class:"text-2xl font-bold text-green-600"},De={class:"text-2xl font-bold text-blue-600"},Ae={class:"text-2xl font-bold text-red-600"},Fe={class:"flex items-center justify-between gap-2 flex-wrap"},Ie={class:"flex gap-2 items-center flex-wrap"},he={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},qe={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},Ne={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},je={key:0,class:"animate-pulse"},ze={key:1},Be={class:"px-6 py-4 whitespace-nowrap font-medium"},Me={class:"px-6 py-4 whitespace-nowrap"},Pe={class:"px-6 py-4 whitespace-nowrap"},Re=["value","onChange"],Te={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Le={class:"px-6 py-4 whitespace-nowrap"},Ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-500"},Ge={class:"px-6 py-4 whitespace-nowrap text-right"},He={class:"flex gap-1 justify-end"},Je={key:1,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Oe={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},Qe={class:"flex items-center space-x-2"},We={class:"flex items-center space-x-1"},Xe={class:"flex flex-col gap-1"},Ye={class:"flex flex-col gap-1"},Ze={class:"flex flex-col gap-1"},et={class:"flex flex-col gap-1"},tt={class:"flex flex-col gap-1"},at={key:1,class:"flex flex-col gap-1"},lt=["value"],st={class:"flex flex-col gap-1"},rt={class:"flex flex-col gap-1"},ot={class:"flex flex-col gap-1"},nt={class:"flex flex-col gap-1"},wt=xe({__name:"Index",setup(it){const ee=ge(),te=T(()=>{var r,e;return((e=(r=ee.props.auth)==null?void 0:r.user)==null?void 0:e.role)||"farmer"});T(()=>te.value==="admin");const ae=[{title:"Dashboard",href:"/dashboard"},{title:"User Management",href:"/users"}],m=v({data:[],current_page:1,last_page:1,per_page:10,total:0,from:null,to:null}),b=v(null),P=v(!1),h=v(""),q=v(""),N=v(""),E=v(!1),S=v(!1),D=v(!1),j=v(null),g=v(null),i=v({name:"",email:"",password:"",password_confirmation:"",role:"farmer",address:"",phone:"",investor_id:null}),X=v([]),u=T(()=>m.value?{current_page:m.value.current_page,last_page:m.value.last_page,per_page:m.value.per_page,total:m.value.total,from:m.value.from,to:m.value.to}:null),le=r=>{switch(r){case"admin":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case"investor":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";case"farmer":return"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-900/20 dark:text-gray-400"}},se=r=>r?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";async function w(){P.value=!0;try{const r=new URLSearchParams;h.value&&r.append("search",h.value),q.value&&r.append("role",q.value),N.value&&r.append("status",N.value),r.append("page",m.value.current_page.toString());const e=await k.get(`/users/list?${r.toString()}`);m.value=e.data.users}catch(r){console.error("Error fetching users:",r),y.fire({icon:"error",title:"Error",text:"Failed to load users."})}finally{P.value=!1}}async function A(){try{const r=await k.get("/users/statistics");b.value=r.data.statistics}catch(r){console.error("Error fetching statistics:",r)}}async function re(){try{const r=await k.get("/investors/select");X.value=r.data}catch(r){console.error("Error fetching investors:",r)}}function z(){m.value.current_page=1,w()}function R(r){m.value.current_page=r,w()}function oe(){if(!u.value)return[];const r=u.value.current_page,e=u.value.last_page,t=[];t.push(1);for(let o=Math.max(2,r-1);o<=Math.min(e-1,r+1);o++)o>1&&o<e&&t.push(o);return e>1&&t.push(e),[...new Set(t)].sort((o,c)=>o-c)}function ne(){i.value={name:"",email:"",password:"",password_confirmation:"",role:"farmer",address:"",phone:"",investor_id:null},E.value=!0}async function ie(){var r,e;try{await k.post("/users",i.value),await w(),await A(),E.value=!1,y.fire({icon:"success",title:"User created successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to create user.";y.fire({icon:"error",title:"Error",text:o})}}function de(r){g.value={...r},S.value=!0}async function ue(){var r,e;if(g.value)try{await k.put(`/users/${g.value.id}`,{name:g.value.name,email:g.value.email}),await w(),S.value=!1,g.value=null,y.fire({icon:"success",title:"User updated successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to update user.";y.fire({icon:"error",title:"Error",text:o})}}async function pe(r,e){var t,o;try{await k.put(`/users/${r.id}/role`,{role:e}),await w(),await A(),y.fire({icon:"success",title:"User role updated successfully!"})}catch(c){const ce=((o=(t=c==null?void 0:c.response)==null?void 0:t.data)==null?void 0:o.message)||"Failed to update user role.";y.fire({icon:"error",title:"Error",text:ce})}}async function fe(r){var e,t;try{await k.post(`/users/${r.id}/toggle-status`),await w(),await A();const o=r.is_active?"deactivated":"activated";y.fire({icon:"success",title:`User ${o} successfully!`})}catch(o){const c=((t=(e=o==null?void 0:o.response)==null?void 0:e.data)==null?void 0:t.message)||"Failed to toggle user status.";y.fire({icon:"error",title:"Error",text:c})}}function me(r){j.value=r,D.value=!0}async function ve(){var r,e;if(j.value!==null)try{await k.delete(`/users/${j.value}`),await w(),await A(),D.value=!1,j.value=null,y.fire({icon:"success",title:"User deleted successfully!"})}catch(t){const o=((e=(r=t==null?void 0:t.response)==null?void 0:r.data)==null?void 0:e.message)||"Failed to delete user.";y.fire({icon:"error",title:"Error",text:o})}}return ye(()=>{w(),A(),re()}),(r,e)=>(p(),x(I,null,[l(_e(be),{title:"User Management"}),l(ke,{breadcrumbs:ae},{default:s(()=>[a("div",Ce,[b.value?(p(),x("div",Ue,[l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[21]||(e[21]=[n("Total Users")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",Ve,d(b.value.total_users),1)]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[22]||(e[22]=[n("Active")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",$e,d(b.value.active_users),1)]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[23]||(e[23]=[n("Inactive")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",Ee,d(b.value.inactive_users),1)]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[24]||(e[24]=[n("Farmers")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",Se,d(b.value.farmers),1)]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[25]||(e[25]=[n("Investors")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",De,d(b.value.investors),1)]),_:1})]),_:1}),l(C,null,{default:s(()=>[l(U,{class:"pb-2"},{default:s(()=>[l(V,{class:"text-sm font-medium text-muted-foreground"},{default:s(()=>e[26]||(e[26]=[n("Admins")])),_:1})]),_:1}),l($,null,{default:s(()=>[a("div",Ae,d(b.value.admins),1)]),_:1})]),_:1})])):F("",!0),a("div",Fe,[a("div",Ie,[l(_,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),placeholder:"Search users...",onKeyup:we(z,["enter"]),class:"w-64"},null,8,["modelValue"]),B(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>q.value=t),onChange:z,class:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm"},e[27]||(e[27]=[a("option",{value:""},"All Roles",-1),a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),544),[[M,q.value]]),B(a("select",{"onUpdate:modelValue":e[2]||(e[2]=t=>N.value=t),onChange:z,class:"flex h-9 rounded-md border border-input bg-transparent px-3 py-1 text-sm"},e[28]||(e[28]=[a("option",{value:""},"All Status",-1),a("option",{value:"active"},"Active",-1),a("option",{value:"inactive"},"Inactive",-1)]),544),[[M,N.value]]),l(f,{onClick:z,variant:"default"},{default:s(()=>e[29]||(e[29]=[n("Search")])),_:1})]),l(f,{onClick:ne,variant:"secondary"},{default:s(()=>e[30]||(e[30]=[n("Create User")])),_:1})]),a("div",he,[a("table",qe,[e[36]||(e[36]=a("thead",{class:"bg-gray-50 dark:bg-gray-800"},[a("tr",null,[a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Name"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Email"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Role"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Status"),a("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Created"),a("th",{class:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider"},"Actions")])],-1)),a("tbody",Ne,[P.value?(p(),x("tr",je,e[31]||(e[31]=[a("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-500"},"Loading...",-1)]))):m.value.data.length===0?(p(),x("tr",ze,e[32]||(e[32]=[a("td",{colspan:"7",class:"px-6 py-4 text-center text-gray-500"},"No users found.",-1)]))):(p(!0),x(I,{key:2},L(m.value.data,t=>{var o;return p(),x("tr",{key:t.id},[a("td",Be,d(t.name),1),a("td",Me,d(t.email),1),a("td",Pe,[a("select",{value:t.role,onChange:c=>pe(t,c.target.value),class:K(["px-2 py-1 text-xs rounded-full font-semibold",le(t.role)])},e[33]||(e[33]=[a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),42,Re)]),a("td",Te,d(((o=t.investor)==null?void 0:o.name)||"-"),1),a("td",Le,[a("span",{class:K(["px-2 py-1 text-xs rounded-full font-semibold",se(t.is_active)])},d(t.is_active?"Active":"Inactive"),3)]),a("td",Ke,d(new Date(t.created_at).toLocaleDateString()),1),a("td",Ge,[a("div",He,[l(f,{variant:"outline",size:"sm",onClick:c=>de(t),title:"Edit",class:"w-8 h-8 p-0"},{default:s(()=>e[34]||(e[34]=[n(" âœï¸ ")])),_:2},1032,["onClick"]),l(f,{variant:t.is_active?"secondary":"default",size:"sm",onClick:c=>fe(t),title:t.is_active?"Deactivate":"Activate",class:"w-8 h-8 p-0"},{default:s(()=>[n(d(t.is_active?"ðŸ”’":"ðŸ”“"),1)]),_:2},1032,["variant","onClick","title"]),l(f,{variant:"destructive",size:"sm",onClick:c=>me(t.id),title:"Delete",class:"w-8 h-8 p-0"},{default:s(()=>e[35]||(e[35]=[n(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick"])])])])}),128))])])]),u.value&&u.value.total>0?(p(),x("div",Je,[a("div",Oe,[a("span",null,"Showing "+d(u.value.from)+" to "+d(u.value.to)+" of "+d(u.value.total)+" results",1)]),a("div",Qe,[l(f,{variant:"outline",size:"sm",disabled:u.value.current_page===1,onClick:e[3]||(e[3]=t=>R(u.value.current_page-1))},{default:s(()=>e[37]||(e[37]=[n(" Previous ")])),_:1},8,["disabled"]),a("div",We,[(p(!0),x(I,null,L(oe(),t=>(p(),Y(f,{key:t,variant:"outline",size:"sm",class:K(t===u.value.current_page?"bg-primary text-primary-foreground":""),onClick:o=>R(t)},{default:s(()=>[n(d(t),1)]),_:2},1032,["class","onClick"]))),128))]),l(f,{variant:"outline",size:"sm",disabled:u.value.current_page===u.value.last_page,onClick:e[4]||(e[4]=t=>R(u.value.current_page+1))},{default:s(()=>e[38]||(e[38]=[n(" Next ")])),_:1},8,["disabled"])])])):F("",!0)]),l(G,{open:E.value,"onUpdate:open":e[14]||(e[14]=t=>E.value=t)},{default:s(()=>[l(Q,{"as-child":""}),l(H,null,{default:s(()=>[l(J,null,{default:s(()=>[l(O,null,{default:s(()=>e[39]||(e[39]=[n("Create User")])),_:1})]),_:1}),a("form",{onSubmit:Z(ie,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",Xe,[e[40]||(e[40]=a("label",{for:"name",class:"text-sm font-medium"},"Name",-1)),l(_,{id:"name",modelValue:i.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>i.value.name=t),type:"text",placeholder:"Enter name",required:""},null,8,["modelValue"])]),a("div",Ye,[e[41]||(e[41]=a("label",{for:"email",class:"text-sm font-medium"},"Email",-1)),l(_,{id:"email",modelValue:i.value.email,"onUpdate:modelValue":e[6]||(e[6]=t=>i.value.email=t),type:"email",placeholder:"Enter email",required:""},null,8,["modelValue"])]),a("div",Ze,[e[43]||(e[43]=a("label",{for:"role",class:"text-sm font-medium"},"Role",-1)),B(a("select",{id:"role","onUpdate:modelValue":e[7]||(e[7]=t=>i.value.role=t),class:"input w-full rounded border p-2",required:""},e[42]||(e[42]=[a("option",{value:"farmer"},"Farmer",-1),a("option",{value:"investor"},"Investor",-1),a("option",{value:"admin"},"Admin",-1)]),512),[[M,i.value.role]])]),i.value.role==="investor"?(p(),x(I,{key:0},[a("div",et,[e[44]||(e[44]=a("label",{for:"address",class:"text-sm font-medium"},"Address",-1)),l(_,{id:"address",modelValue:i.value.address,"onUpdate:modelValue":e[8]||(e[8]=t=>i.value.address=t),type:"text",placeholder:"Enter address",required:""},null,8,["modelValue"])]),a("div",tt,[e[45]||(e[45]=a("label",{for:"phone",class:"text-sm font-medium"},"Phone",-1)),l(_,{id:"phone",modelValue:i.value.phone,"onUpdate:modelValue":e[9]||(e[9]=t=>i.value.phone=t),type:"text",placeholder:"Enter phone number",required:""},null,8,["modelValue"])])],64)):F("",!0),i.value.role==="farmer"?(p(),x("div",at,[e[47]||(e[47]=a("label",{for:"investor_id",class:"text-sm font-medium"},"Investor",-1)),B(a("select",{id:"investor_id","onUpdate:modelValue":e[10]||(e[10]=t=>i.value.investor_id=t),class:"input w-full rounded border p-2",required:""},[e[46]||(e[46]=a("option",{value:null,disabled:""},"Select an investor",-1)),(p(!0),x(I,null,L(X.value,t=>(p(),x("option",{key:t.id,value:t.id},d(t.name),9,lt))),128))],512),[[M,i.value.investor_id]])])):F("",!0),a("div",st,[e[48]||(e[48]=a("label",{for:"password",class:"text-sm font-medium"},"Password",-1)),l(_,{id:"password",modelValue:i.value.password,"onUpdate:modelValue":e[11]||(e[11]=t=>i.value.password=t),type:"password",placeholder:"Enter password",required:""},null,8,["modelValue"])]),a("div",rt,[e[49]||(e[49]=a("label",{for:"password_confirmation",class:"text-sm font-medium"},"Confirm Password",-1)),l(_,{id:"password_confirmation",modelValue:i.value.password_confirmation,"onUpdate:modelValue":e[12]||(e[12]=t=>i.value.password_confirmation=t),type:"password",placeholder:"Confirm password",required:""},null,8,["modelValue"])]),l(W,{class:"flex justify-end gap-2 mt-4"},{default:s(()=>[l(f,{type:"button",variant:"secondary",onClick:e[13]||(e[13]=t=>E.value=!1)},{default:s(()=>e[50]||(e[50]=[n("Cancel")])),_:1}),l(f,{type:"submit",variant:"default"},{default:s(()=>e[51]||(e[51]=[n("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),g.value?(p(),Y(G,{key:0,open:S.value,"onUpdate:open":e[18]||(e[18]=t=>S.value=t)},{default:s(()=>[l(Q,{"as-child":""}),l(H,null,{default:s(()=>[l(J,null,{default:s(()=>[l(O,null,{default:s(()=>e[52]||(e[52]=[n("Edit User")])),_:1})]),_:1}),a("form",{onSubmit:Z(ue,["prevent"]),class:"flex flex-col gap-4 mt-2"},[a("div",ot,[e[53]||(e[53]=a("label",{for:"edit_name",class:"text-sm font-medium"},"Name",-1)),l(_,{id:"edit_name",modelValue:g.value.name,"onUpdate:modelValue":e[15]||(e[15]=t=>g.value.name=t),type:"text",placeholder:"Enter name",required:""},null,8,["modelValue"])]),a("div",nt,[e[54]||(e[54]=a("label",{for:"edit_email",class:"text-sm font-medium"},"Email",-1)),l(_,{id:"edit_email",modelValue:g.value.email,"onUpdate:modelValue":e[16]||(e[16]=t=>g.value.email=t),type:"email",placeholder:"Enter email",required:""},null,8,["modelValue"])]),l(W,{class:"flex justify-end gap-2 mt-4"},{default:s(()=>[l(f,{type:"button",variant:"secondary",onClick:e[17]||(e[17]=t=>S.value=!1)},{default:s(()=>e[55]||(e[55]=[n("Cancel")])),_:1}),l(f,{type:"submit",variant:"default"},{default:s(()=>e[56]||(e[56]=[n("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):F("",!0),l(G,{open:D.value,"onUpdate:open":e[20]||(e[20]=t=>D.value=t)},{default:s(()=>[l(Q,{"as-child":""}),l(H,null,{default:s(()=>[l(J,null,{default:s(()=>[l(O,null,{default:s(()=>e[57]||(e[57]=[n("Delete User")])),_:1})]),_:1}),e[60]||(e[60]=a("div",{class:"mt-2"},"Are you sure you want to delete this user? This action cannot be undone.",-1)),l(W,{class:"flex justify-end gap-2 mt-4"},{default:s(()=>[l(f,{type:"button",variant:"secondary",onClick:e[19]||(e[19]=t=>D.value=!1)},{default:s(()=>e[58]||(e[58]=[n("Cancel")])),_:1}),l(f,{type:"button",variant:"destructive",onClick:ve},{default:s(()=>e[59]||(e[59]=[n("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]),_:1})],64))}});export{wt as default};
