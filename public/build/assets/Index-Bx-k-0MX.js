import{q as pe,r as y,p as E,d as me,c as z,o as fe,a as c,b as f,e as a,u as ge,m as ce,w as n,f as i,g as Y,h as T,i as o,t as v,F as $,j as F,x as ve,k as J,l as K,v as Q,W as ye}from"./app-cNF66rvG.js";import{_ as xe}from"./AppLayout.vue_vue_type_script_setup_true_lang-c3ekNZcC.js";import{u as _e,S as x}from"./sweetalert2.esm.all-C5Dkr4pP.js";import{_ as m}from"./AppLogoIcon.vue_vue_type_script_setup_true_lang-DhAhIzZw.js";import{_ as b}from"./Input.vue_vue_type_script_setup_true_lang-Dy719ZJG.js";import{_}from"./Label.vue_vue_type_script_setup_true_lang-BsVJL2mG.js";import{_ as B,a as j,b as A,c as O,d as P}from"./DialogTitle.vue_vue_type_script_setup_true_lang-BIUgyYKl.js";import{_ as G}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-BJe3iFxh.js";import"./useForwardExpose-eL8-binu.js";import"./RovingFocusGroup-B2hP9Xy7.js";const be=pe("sampling",()=>{const w=y([]),g=y(!1),r=y(null),S=y({search:"",page:1});return{samplings:w,loading:g,error:r,filters:S,fetchSamplings:async()=>{g.value=!0,r.value=null;try{const s=await E.get(route("samplings.list"),{params:S.value});w.value=s.data.samplings}catch(s){r.value=s.message}finally{g.value=!1}},createSampling:async s=>{g.value=!0,r.value=null;try{return(await E.post(route("samplings.store"),s)).data}catch(u){throw r.value=u.message,u}finally{g.value=!1}},updateSampling:async(s,u)=>{g.value=!0,r.value=null;try{const p=await E.put(route("samplings.update",s),u);if(w.value&&w.value.data&&Array.isArray(w.value.data)){const k=w.value.data.findIndex(d=>d.id===s);k!==-1&&(w.value.data[k]=p.data.sampling)}return p.data}catch(p){throw r.value=p.message,p}finally{g.value=!1}},deleteSampling:async s=>{g.value=!0,r.value=null;try{return(await E.delete(route("samplings.destroy",s))).data}catch(u){throw r.value=u.message,u}finally{g.value=!1}},generateSamples:async s=>{g.value=!0,r.value=null;try{return(await E.post(route("samplings.generate-samples",s))).data}catch(u){throw r.value=u.message,u}finally{g.value=!1}},setFilters:s=>{S.value={...S.value,...s}}}}),we={class:"flex flex-col gap-4 p-4"},Se={class:"flex items-center justify-between gap-2"},ke={class:"flex gap-2 items-center"},Ce={class:"overflow-x-auto rounded-xl border border-sidebar-border/70 dark:border-sidebar-border bg-white dark:bg-gray-900"},Ve={class:"min-w-full divide-y divide-gray-200 dark:divide-gray-700"},he={class:"bg-white dark:bg-gray-900 divide-y divide-gray-200 dark:divide-gray-700"},De={key:0},$e={key:1},Ue={class:"px-6 py-4 whitespace-nowrap"},Ee={class:"px-6 py-4 whitespace-nowrap"},Ne={class:"px-6 py-4 whitespace-nowrap"},qe={class:"px-6 py-4 whitespace-nowrap"},ze={class:"px-6 py-4 whitespace-nowrap"},Fe={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},Ie={class:"px-6 py-4 whitespace-nowrap text-right"},Me={class:"flex gap-1"},Te={key:0,class:"flex items-center justify-between px-4 py-3 bg-white dark:bg-gray-900 border-t border-gray-200 dark:border-gray-700"},Be={class:"flex items-center text-sm text-gray-700 dark:text-gray-300"},je={class:"flex items-center space-x-2"},Ae={class:"flex items-center space-x-1"},Oe={key:1,class:"px-2"},Pe={class:"flex flex-col gap-2"},Ge=["value"],Le={class:"flex flex-col gap-2"},Re={class:"flex flex-col gap-2"},We={class:"flex flex-col gap-2"},He={class:"flex flex-col gap-2"},Ye={class:"flex flex-col gap-2"},Je=["value"],Ke={class:"flex flex-col gap-2"},Qe={class:"flex flex-col gap-2"},Xe={class:"flex flex-col gap-2"},Ze={class:"flex flex-col gap-2"},ut=me({__name:"Index",setup(w){var W;const g=[{title:"Dashboard",href:"/dashboard"},{title:"Samplings",href:"/samplings"}],r=be(),S=_e(),N=y(""),q=z(()=>r.loading),V=y(!1),h=y(!1),U=y(null),D=y(!1),s=y(null),u=z(()=>S.investorsSelect),p=y({investor_id:((W=u.value[0])==null?void 0:W.id)||3,date_sampling:"",doc:"",cage_no:"",mortality:0}),k=z(()=>{const l=r.samplings;return(l==null?void 0:l.data)||[]}),d=z(()=>{const l=r.samplings;return l!=null&&l.current_page?{current_page:l.current_page,last_page:l.last_page,per_page:l.per_page,total:l.total,from:l.from,to:l.to}:null});function L(){r.setFilters({search:N.value,page:1}),r.fetchSamplings()}let R;function X(){clearTimeout(R),R=setTimeout(()=>{L()},300)}function I(l){r.setFilters({...r.filters,page:l}),r.fetchSamplings()}function Z(){d.value&&d.value.current_page<d.value.last_page&&I(d.value.current_page+1)}function ee(){d.value&&d.value.current_page>1&&I(d.value.current_page-1)}function te(){var l;p.value={investor_id:((l=u.value[0])==null?void 0:l.id)||1,date_sampling:"",doc:"",cage_no:"",mortality:0},V.value=!0}async function ae(){try{await r.createSampling(p.value),await r.fetchSamplings(),V.value=!1,x.fire({icon:"success",title:"Sampling created successfully!"})}catch(l){x.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to create sampling."})}}function le(l){U.value=l,h.value=!0}async function ne(){if(U.value!==null)try{await r.deleteSampling(U.value),await r.fetchSamplings(),h.value=!1,U.value=null,x.fire({icon:"success",title:"Sampling deleted successfully!"})}catch(l){x.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to delete sampling."})}}function ie(l){s.value={...l,cage_no:String(l.cage_no)},D.value=!0}async function se(){if(s.value&&s.value.id)try{await r.updateSampling(s.value.id,{investor_id:s.value.investor_id,date_sampling:s.value.date_sampling,doc:s.value.doc,cage_no:String(s.value.cage_no),mortality:s.value.mortality||0}),await r.fetchSamplings(),D.value=!1,s.value=null,x.fire({icon:"success",title:"Sampling updated successfully!"})}catch(l){x.fire({icon:"error",title:"Error",text:(l==null?void 0:l.message)||"Failed to update sampling."})}}async function oe(l){var t;try{(await x.fire({title:"Generate Samples?",text:"This will create 30 sample records for this sampling. Continue?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, Generate",cancelButtonText:"Cancel"})).isConfirmed&&(await r.generateSamples(l),await r.fetchSamplings(),x.fire({icon:"success",title:"Samples Generated!",text:"30 sample records have been created successfully."}))}catch(e){((t=e==null?void 0:e.response)==null?void 0:t.status)===400?x.fire({icon:"warning",title:"Samples Already Exist",text:e.response.data.message}):x.fire({icon:"error",title:"Error",text:(e==null?void 0:e.message)||"Failed to generate samples."})}}function re(l){window.open(route("samplings.export-report",l),"_blank")}function de(l){ye.visit(route("samplings.report",{sampling:l}))}function ue(l){window.open(route("samplings.report",{sampling:l}),"_blank")}return fe(()=>{r.fetchSamplings(),S.fetchInvestorsSelect()}),(l,t)=>(f(),c($,null,[a(ge(ce),{title:"Samplings"}),a(xe,{breadcrumbs:g},{default:n(()=>[i("div",we,[i("div",Se,[i("div",ke,[a(b,{modelValue:N.value,"onUpdate:modelValue":t[0]||(t[0]=e=>N.value=e),placeholder:"Search samplings...",onInput:X,class:"w-64"},null,8,["modelValue"]),a(m,{onClick:L,variant:"default",disabled:q.value},{default:n(()=>[o(v(q.value?"Searching...":"Search"),1)]),_:1},8,["disabled"])]),a(m,{onClick:te,variant:"secondary"},{default:n(()=>t[17]||(t[17]=[o("Create Sampling")])),_:1})]),i("div",Ce,[i("table",Ve,[t[26]||(t[26]=i("thead",{class:"bg-gray-50 dark:bg-gray-800"},[i("tr",null,[i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Investor"),i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Date Sampling"),i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"DOC"),i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Cage No"),i("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"},"Samples"),i("th",{class:"px-6 py-3"})])],-1)),i("tbody",he,[q.value?(f(),c("tr",De,t[18]||(t[18]=[i("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"Loading samplings...",-1)]))):!k.value||!Array.isArray(k.value)||k.value.length===0?(f(),c("tr",$e,t[19]||(t[19]=[i("td",{colspan:"6",class:"px-6 py-4 text-center text-gray-500"},"No samplings found.",-1)]))):(f(!0),c($,{key:2},F(k.value,e=>{var M,H;return f(),c("tr",{key:e==null?void 0:e.id},[i("td",Ue,v(((M=e==null?void 0:e.investor)==null?void 0:M.name)||((H=u.value.find(C=>C.id===(e==null?void 0:e.investor_id)))==null?void 0:H.name)||(e==null?void 0:e.investor_id)),1),i("td",Ee,v(e==null?void 0:e.date_sampling),1),i("td",Ne,v(e==null?void 0:e.doc),1),i("td",qe,v(e==null?void 0:e.cage_no),1),i("td",ze,[i("span",Fe,v((e==null?void 0:e.samples_count)||0)+" samples ",1)]),i("td",Ie,[i("div",Me,[a(m,{variant:"outline",size:"sm",onClick:C=>de(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"View Sampling",class:"w-8 h-8 p-0"},{default:n(()=>t[20]||(t[20]=[o(" ðŸ‘ï¸ ")])),_:2},1032,["onClick","disabled"]),a(m,{variant:"outline",size:"sm",onClick:C=>oe(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Generate Samples",class:"w-8 h-8 p-0"},{default:n(()=>t[21]||(t[21]=[o(" ðŸ“Š ")])),_:2},1032,["onClick","disabled"]),a(m,{variant:"outline",size:"sm",onClick:C=>ue(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Print Report",class:"w-8 h-8 p-0"},{default:n(()=>t[22]||(t[22]=[o(" ðŸ–¨ï¸ ")])),_:2},1032,["onClick","disabled"]),a(m,{variant:"outline",size:"sm",onClick:C=>re(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Export to Excel",class:"w-8 h-8 p-0"},{default:n(()=>t[23]||(t[23]=[o(" ðŸ“„ ")])),_:2},1032,["onClick","disabled"]),a(m,{variant:"secondary",size:"sm",onClick:C=>ie(e),disabled:!(e!=null&&e.id),title:"Update",class:"w-8 h-8 p-0"},{default:n(()=>t[24]||(t[24]=[o(" âœï¸ ")])),_:2},1032,["onClick","disabled"]),a(m,{variant:"destructive",size:"sm",onClick:C=>le(e==null?void 0:e.id),disabled:!(e!=null&&e.id),title:"Delete",class:"w-8 h-8 p-0"},{default:n(()=>t[25]||(t[25]=[o(" ðŸ—‘ï¸ ")])),_:2},1032,["onClick","disabled"])])])])}),128))])])]),d.value?(f(),c("div",Te,[i("div",Be,[i("span",null,"Showing "+v(d.value.from)+" to "+v(d.value.to)+" of "+v(d.value.total)+" results",1)]),i("div",je,[a(m,{variant:"outline",size:"sm",onClick:ee,disabled:d.value.current_page===1},{default:n(()=>t[27]||(t[27]=[o(" Previous ")])),_:1},8,["disabled"]),i("div",Ae,[(f(!0),c($,null,F(Math.min(5,d.value.last_page),e=>(f(),c($,{key:e},[e===1||e===d.value.last_page||e>=d.value.current_page-2&&e<=d.value.current_page+2?(f(),Y(m,{key:0,variant:"outline",size:"sm",onClick:M=>I(e),class:ve(e===d.value.current_page?"bg-primary text-primary-foreground":"")},{default:n(()=>[o(v(e),1)]),_:2},1032,["onClick","class"])):e===d.value.current_page-3||e===d.value.current_page+3?(f(),c("span",Oe,"...")):T("",!0)],64))),128))]),a(m,{variant:"outline",size:"sm",onClick:Z,disabled:d.value.current_page===d.value.last_page},{default:n(()=>t[28]||(t[28]=[o(" Next ")])),_:1},8,["disabled"])])])):T("",!0)]),a(B,{open:V.value,"onUpdate:open":t[7]||(t[7]=e=>V.value=e)},{default:n(()=>[a(G,{"as-child":""}),a(j,null,{default:n(()=>[a(A,null,{default:n(()=>[a(O,null,{default:n(()=>t[29]||(t[29]=[o("Create Sampling")])),_:1})]),_:1}),i("form",{onSubmit:J(ae,["prevent"]),class:"flex flex-col gap-4 mt-2"},[i("div",Pe,[a(_,{for:"create-investor"},{default:n(()=>t[30]||(t[30]=[o("Investor")])),_:1}),K(i("select",{id:"create-investor","onUpdate:modelValue":t[1]||(t[1]=e=>p.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(f(!0),c($,null,F(u.value,e=>(f(),c("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},v(e.name),9,Ge))),128))],512),[[Q,p.value.investor_id]])]),i("div",Le,[a(_,{for:"create-date-sampling"},{default:n(()=>t[31]||(t[31]=[o("Date Sampling")])),_:1}),a(b,{id:"create-date-sampling",modelValue:p.value.date_sampling,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),i("div",Re,[a(_,{for:"create-doc"},{default:n(()=>t[32]||(t[32]=[o("DOC")])),_:1}),a(b,{id:"create-doc",modelValue:p.value.doc,"onUpdate:modelValue":t[3]||(t[3]=e=>p.value.doc=e),placeholder:"DOC",required:""},null,8,["modelValue"])]),i("div",We,[a(_,{for:"create-cage-no"},{default:n(()=>t[33]||(t[33]=[o("Cage No")])),_:1}),a(b,{id:"create-cage-no",modelValue:p.value.cage_no,"onUpdate:modelValue":t[4]||(t[4]=e=>p.value.cage_no=e),placeholder:"Cage No",required:""},null,8,["modelValue"])]),i("div",He,[a(_,{for:"create-mortality"},{default:n(()=>t[34]||(t[34]=[o("Mortality")])),_:1}),a(b,{id:"create-mortality",modelValue:p.value.mortality,"onUpdate:modelValue":t[5]||(t[5]=e=>p.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(P,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[a(m,{type:"button",variant:"secondary",onClick:t[6]||(t[6]=e=>V.value=!1)},{default:n(()=>t[35]||(t[35]=[o("Cancel")])),_:1}),a(m,{type:"submit",variant:"default"},{default:n(()=>t[36]||(t[36]=[o("Create")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"]),a(B,{open:h.value,"onUpdate:open":t[9]||(t[9]=e=>h.value=e)},{default:n(()=>[a(G,{"as-child":""}),a(j,null,{default:n(()=>[a(A,null,{default:n(()=>[a(O,null,{default:n(()=>t[37]||(t[37]=[o("Delete Sampling")])),_:1})]),_:1}),t[40]||(t[40]=i("div",{class:"mt-2"},"Are you sure you want to delete this sampling?",-1)),a(P,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[a(m,{type:"button",variant:"secondary",onClick:t[8]||(t[8]=e=>h.value=!1)},{default:n(()=>t[38]||(t[38]=[o("Cancel")])),_:1}),a(m,{type:"button",variant:"destructive",onClick:ne},{default:n(()=>t[39]||(t[39]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"]),s.value?(f(),Y(B,{key:0,open:D.value,"onUpdate:open":t[16]||(t[16]=e=>D.value=e)},{default:n(()=>[a(G,{"as-child":""}),a(j,null,{default:n(()=>[a(A,null,{default:n(()=>[a(O,null,{default:n(()=>t[41]||(t[41]=[o("Edit Sampling")])),_:1})]),_:1}),i("form",{onSubmit:J(se,["prevent"]),class:"flex flex-col gap-4 mt-2"},[i("div",Ye,[a(_,{for:"edit-investor"},{default:n(()=>t[42]||(t[42]=[o("Investor")])),_:1}),K(i("select",{id:"edit-investor","onUpdate:modelValue":t[10]||(t[10]=e=>s.value.investor_id=e),class:"input w-full rounded border p-2",required:""},[(f(!0),c($,null,F(u.value,e=>(f(),c("option",{key:e.id,value:e.id,class:"bg-background text-foreground"},v(e.name),9,Je))),128))],512),[[Q,s.value.investor_id]])]),i("div",Ke,[a(_,{for:"edit-date-sampling"},{default:n(()=>t[43]||(t[43]=[o("Date Sampling")])),_:1}),a(b,{id:"edit-date-sampling",modelValue:s.value.date_sampling,"onUpdate:modelValue":t[11]||(t[11]=e=>s.value.date_sampling=e),type:"date",placeholder:"Date Sampling",required:""},null,8,["modelValue"])]),i("div",Qe,[a(_,{for:"edit-doc"},{default:n(()=>t[44]||(t[44]=[o("DOC")])),_:1}),a(b,{id:"edit-doc",modelValue:s.value.doc,"onUpdate:modelValue":t[12]||(t[12]=e=>s.value.doc=e),placeholder:"DOC",required:""},null,8,["modelValue"])]),i("div",Xe,[a(_,{for:"edit-cage-no"},{default:n(()=>t[45]||(t[45]=[o("Cage No")])),_:1}),a(b,{id:"edit-cage-no",modelValue:s.value.cage_no,"onUpdate:modelValue":t[13]||(t[13]=e=>s.value.cage_no=e),placeholder:"Cage No",required:""},null,8,["modelValue"])]),i("div",Ze,[a(_,{for:"edit-mortality"},{default:n(()=>t[46]||(t[46]=[o("Mortality")])),_:1}),a(b,{id:"edit-mortality",modelValue:s.value.mortality,"onUpdate:modelValue":t[14]||(t[14]=e=>s.value.mortality=e),modelModifiers:{number:!0},type:"number",placeholder:"Mortality",min:"0"},null,8,["modelValue"])]),a(P,{class:"flex justify-end gap-2 mt-4"},{default:n(()=>[a(m,{type:"button",variant:"secondary",onClick:t[15]||(t[15]=e=>D.value=!1)},{default:n(()=>t[47]||(t[47]=[o("Cancel")])),_:1}),a(m,{type:"submit",variant:"default"},{default:n(()=>t[48]||(t[48]=[o("Update")])),_:1})]),_:1})],32)]),_:1})]),_:1},8,["open"])):T("",!0)]),_:1})],64))}});export{ut as default};
